(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{CDsc:function(e,n,t){"use strict";t.r(n),t.d(n,"CareplanModule",function(){return qt});var i=t("rbUg"),r=t("ofXK"),a=t("UFn0"),s=t("SHZf"),c=t("3Pt+"),o=t("KZX/"),l=t("WoUL"),d=t("tyNb"),u=t("T5gh"),p=t("1G5W"),h=t("qQcL");class b{}class g{}class v{}class f{constructor(){}}var m=t("isHH"),I=t("igu/"),C=t("mfqL"),M=t("4RGM"),D=t("fXoL"),T=t("bNXi"),E=t("S5rh"),S=t("Szod"),O=t("B+r4"),y=t("MZxW"),A=t("VGjC"),z=t("nLCl"),X=t("PTRe"),k=t("zAKX"),N=t("TaO5"),W=t("dRHE");function R(e,n){1&e&&(D.Xb(0,"div",16),D.Xc(1),D.jc(2,"translate"),D.Wb()),2&e&&(D.Db(1),D.Zc(" ",D.kc(2,1,"COMMON.REQUIRED")," "))}function _(e,n){if(1&e){const e=D.Yb();D.Xb(0,"label",17),D.ec("ngModelChange",function(n){return D.Lc(e),D.ic().course.trackable=n}),D.Xc(1),D.jc(2,"translate"),D.Wb()}if(2&e){const e=D.ic();D.rc("nzDisabled",e.isEditDisabled)("ngModel",e.course.trackable),D.Db(1),D.Yc(D.kc(2,3,"COMMON.TRACKABLE"))}}function B(e,n){1&e&&(D.Sb(0,"nz-option",18),D.jc(1,"translate")),2&e&&D.sc("nzLabel",D.kc(1,1,"GENERAL_CARE_PLAN"))}function P(e,n){1&e&&(D.Sb(0,"nz-option",19),D.jc(1,"translate")),2&e&&D.sc("nzLabel",D.kc(1,1,"REMOTE_PATIENT_MONITORING"))}function L(e,n){1&e&&(D.Sb(0,"nz-option",20),D.jc(1,"translate")),2&e&&D.sc("nzLabel",D.kc(1,1,"CAREPLAN.HEALTH_SCORE"))}function w(e,n){1&e&&(D.Sb(0,"nz-option",21),D.jc(1,"translate")),2&e&&D.sc("nzLabel",D.kc(1,1,"CAREPLAN.CHRONIC_CARE_MANAGEMENT"))}function V(e,n){if(1&e&&D.Sb(0,"nz-option",22),2&e){const e=n.$implicit;D.rc("nzLabel",e)("nzValue",e)}}function U(e,n){1&e&&(D.Xb(0,"div",16),D.Xc(1),D.jc(2,"translate"),D.Wb()),2&e&&(D.Db(1),D.Zc(" ",D.kc(2,1,"COMMON.REQUIRED")," "))}function F(e,n){if(1&e&&D.Sb(0,"nz-option",22),2&e){const e=n.$implicit;D.uc("nzLabel","",e.firstName," ",e.lastName,""),D.rc("nzValue",e)}}function G(e,n){if(1&e){const e=D.Yb();D.Xb(0,"div",0),D.Xb(1,"div",1),D.Xb(2,"nz-select",23),D.ec("ngModelChange",function(n){return D.Lc(e),D.ic().selectedCaretaker=n})("ngModelChange",function(n){return D.Lc(e),D.ic().emitCaretaker(n)}),D.Vc(3,F,1,3,"nz-option",14),D.Wb(),D.Wb(),D.Wb()}if(2&e){const e=D.ic();D.Db(2),D.rc("ngModel",e.selectedCaretaker),D.Db(1),D.rc("ngForOf",e.caretakers)}}let x=(()=>{class e{constructor(e){this._userService=e,this.isEditDisabled=!1,this.showCaretakerAssigner=!1,this.autoCompleteTags=[],this.caretakers=[],this.caretakerEmitter=new D.n,this.caretakerAvailable=new D.n}ngOnInit(){this.showCaretakerAssigner&&this.getAllCaretakers()}getAllCaretakers(){this._userService.getCaretakerForPatient(this.patientId).subscribe(e=>{var n;this.caretakers=e;const t=localStorage.getItem("loggedInUserRole");if(z.a.MONITORING_STAFF===t){const e=localStorage.getItem("loggedInUser");this.caretakers=this.caretakers.filter(n=>e===n.id)}this.caretakers&&this.caretakers.length?this.caretakerAvailable.emit(this.showCaretakerAssigner):this.showCaretakerAssigner=!1,1===(null===(n=this.caretakers)||void 0===n?void 0:n.length)&&(this.selectedCaretaker=this.caretakers[0],this.emitCaretaker(this.selectedCaretaker))})}emitCaretakersAvailable(){}emitCaretaker(e){this.caretakerEmitter.emit(Object.assign(e,{}))}}return e.\u0275fac=function(n){return new(n||e)(D.Rb(A.a))},e.\u0275cmp=D.Lb({type:e,selectors:[["app-careplan-header"]],inputs:{isEditDisabled:"isEditDisabled",showCaretakerAssigner:"showCaretakerAssigner",course:"course",patientId:"patientId",generalEnabled:"generalEnabled",rpmEnabled:"rpmEnabled",riEnabled:"riEnabled",ccmEnabled:"ccmEnabled",validationErrors:"validationErrors",autoCompleteTags:"autoCompleteTags"},outputs:{caretakerEmitter:"caretakerEmitter",caretakerAvailable:"caretakerAvailable"},decls:26,vars:31,consts:[["nz-row","","nzGutter","16",1,"careplan-details-container"],["nz-col","","nzSpan","8"],["nz-input","","required","",3,"placeholder","ngClass","ngModel","disabled","ngModelChange"],["name","ngModel"],["class","error-text",4,"ngIf"],["nz-input","",3,"placeholder","ngModel","disabled","ngModelChange"],["nz-checkbox","",3,"nzDisabled","ngModel","ngModelChange",4,"ngIf"],["nzAllowClear","",3,"ngModel","nzPlaceHolder","nzDisabled","ngModelChange"],["nzValue","DEFAULT",3,"nzLabel",4,"ngIf"],["nzValue","REMOTE_PATIENT_MONITORING",3,"nzLabel",4,"ngIf"],["nzValue","HEALTH_SCORE",3,"nzLabel",4,"ngIf"],["nzValue","CHRONIC_CARE_MANAGEMENT",3,"nzLabel",4,"ngIf"],["required","","nzMode","tags",3,"nzPlaceHolder","ngClass","ngModel","nzDisabled","ngModelChange"],["tags","ngModel"],[3,"nzLabel","nzValue",4,"ngFor","ngForOf"],["nz-row","","nzGutter","16","class","careplan-details-container",4,"ngIf"],[1,"error-text"],["nz-checkbox","",3,"nzDisabled","ngModel","ngModelChange"],["nzValue","DEFAULT",3,"nzLabel"],["nzValue","REMOTE_PATIENT_MONITORING",3,"nzLabel"],["nzValue","HEALTH_SCORE",3,"nzLabel"],["nzValue","CHRONIC_CARE_MANAGEMENT",3,"nzLabel"],[3,"nzLabel","nzValue"],["nzShowSearch","","nzAllowClear","","nzPlaceHolder","Select Monitoring Staff",3,"ngModel","ngModelChange"]],template:function(e,n){if(1&e&&(D.Xb(0,"div",0),D.Xb(1,"div",1),D.Xb(2,"input",2,3),D.ec("ngModelChange",function(e){return n.course.name=e}),D.jc(4,"translate"),D.Wb(),D.Vc(5,R,3,3,"div",4),D.Wb(),D.Xb(6,"div",1),D.Xb(7,"input",5),D.ec("ngModelChange",function(e){return n.course.description=e}),D.jc(8,"translate"),D.Wb(),D.Wb(),D.Xb(9,"div",1),D.Vc(10,_,3,5,"label",6),D.Wb(),D.Wb(),D.Xb(11,"div",0),D.Xb(12,"div",1),D.Xb(13,"nz-select",7),D.ec("ngModelChange",function(e){return n.course.type=e}),D.jc(14,"translate"),D.Vc(15,B,2,3,"nz-option",8),D.Vc(16,P,2,3,"nz-option",9),D.Vc(17,L,2,3,"nz-option",10),D.Vc(18,w,2,3,"nz-option",11),D.Wb(),D.Wb(),D.Xb(19,"div",1),D.Xb(20,"nz-select",12,13),D.ec("ngModelChange",function(e){return n.course.tags=e}),D.jc(22,"translate"),D.Vc(23,V,1,2,"nz-option",14),D.Wb(),D.Vc(24,U,3,3,"div",4),D.Wb(),D.Wb(),D.Vc(25,G,4,2,"div",15)),2&e){const e=D.Ic(3),t=D.Ic(21);D.Db(2),D.sc("placeholder",D.kc(4,23,"COMMON.NAME")),D.rc("ngClass",(null==n.validationErrors?null:n.validationErrors.length)>0?"submitted":null)("ngModel",n.course.name)("disabled",n.isEditDisabled),D.Db(3),D.rc("ngIf",(null==e?null:e.invalid)&&((null==e?null:e.dirty)||(null==e?null:e.touched)||(null==n.validationErrors?null:n.validationErrors.length)>0)),D.Db(2),D.sc("placeholder",D.kc(8,25,"COMMON.DESCRIPTION")),D.rc("ngModel",n.course.description)("disabled",n.isEditDisabled),D.Db(3),D.rc("ngIf","REMOTE_PATIENT_MONITORING"!==(null==n.course?null:n.course.type)),D.Db(3),D.tc("nzPlaceHolder"," ",D.kc(14,27,"CAREPLAN.CHOOSE_CAREPLAN_TYPE")," "),D.rc("ngModel",n.course.type)("nzDisabled",n.isEditDisabled),D.Db(2),D.rc("ngIf",n.generalEnabled),D.Db(1),D.rc("ngIf",n.rpmEnabled),D.Db(1),D.rc("ngIf",n.riEnabled),D.Db(1),D.rc("ngIf",n.ccmEnabled),D.Db(2),D.sc("nzPlaceHolder",D.kc(22,29,"TITLE.TAG")),D.rc("ngClass",(null==n.validationErrors?null:n.validationErrors.length)>0?"submitted":null)("ngModel",n.course.tags)("nzDisabled",n.isEditDisabled),D.Db(3),D.rc("ngForOf",n.autoCompleteTags),D.Db(1),D.rc("ngIf",(null==t?null:t.invalid)&&((null==t?null:t.dirty)||(null==t?null:t.touched)||(null==n.validationErrors?null:n.validationErrors.length)>0)),D.Db(1),D.rc("ngIf",n.showCaretakerAssigner)}},directives:[O.c,O.a,X.b,c.d,c.C,r.o,c.u,c.x,r.q,k.d,r.p,N.a,k.a],pipes:[W.a],styles:[".careplan-details-container[_ngcontent-%COMP%]{padding:20px;background-color:var(--neutral-color)}.error-text[_ngcontent-%COMP%]{text-align:end;width:100%;color:#c81c1c}[_nghost-%COMP%]     .ng-invalid.ng-touched{border-color:#c81c1c}[_nghost-%COMP%]     nz-select.ng-invalid.ng-touched>nz-select-top-control{border-color:#c81c1c!important}[_nghost-%COMP%]     .ng-invalid.submitted{border-color:#c81c1c}[_nghost-%COMP%]     nz-select.ng-invalid.submitted>nz-select-top-control{border-color:#c81c1c!important}"]}),e})(),Y=(()=>{class e{constructor(e){this._notificationsService=e}validateCapabilities(e,n){if(!e||!e.length)return!0;if(n&&"VITAL"!=n.type)return!0;const t=e[0];let i=new Array;return H.forEach(e=>{e.find(e=>e===t.entityType)&&(i=[...i,...e])}),!(null==i?void 0:i.length)||-1!==i.indexOf(n.entityType)||(this._notificationsService.error("Interventions",`${n.name} is not compatible with already added interventions`),!1)}validateUniqueness(e,n){return!(e&&e.length&&(!n||"TODO"!==n.type&&"ACTIVITY"!==n.type&&"WEB_FORM"!==n.type)&&e.find(e=>e.entityType===n.entityType)&&(this._notificationsService.error("Interventions",`${n.name} is already part of the group`),1))}}return e.\u0275fac=function(n){return new(n||e)(D.bc(T.b))},e.\u0275prov=D.Nb({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();const H=[["BLOOD_PRESSURE","HEART_RATE","STRESS","IRREGULAR_HEARTBEAT","WELLNESS_SCORE","HEART_RATE_VARIABILITY","SPO2","RESPIRATION"],["BLOOD_GLUCOSE"],["WEIGHT"]];var j=t("cScM");class $ extends j.a{}class q{}class K extends j.a{}class J{}class Z{constructor(){this.guaridanNotificationEnabled=!1,this.caretakerNotificationEnabled=!1,this.patientNotificationEnabled=!1,this.reviewResponseEnabled=!1,this.schedules=[],this.childrens=[],this.isTemplateCreated=!0}}class Q{constructor(){this.ownerType="READWRITE"}}class ee{constructor(){}}var ne=function(e){return e.MORNING="MORNING",e.AFTERNOON="AFTERNOON",e.EVENING="EVENING",e.NIGHT="NIGHT",e}({});class te{constructor(){}getDaysActivated(e){const n=new Array;for(const t in e)e[t]&&n.push(t);return n}}var ie=t("w7IE"),re=t("gXqy"),ae=t("jKzE"),se=t("dEAy"),ce=t("JA5x"),oe=t("EGpF"),le=t("0lU3"),de=t("bE2y"),ue=t("z4wI"),pe=t("OzZK"),he=t("RwU8"),be=t("C2AL"),ge=t("5vDB");function ve(e,n){if(1&e){const e=D.Yb();D.Vb(0),D.Sb(1,"br"),D.Sb(2,"br"),D.Xb(3,"div",9),D.Xb(4,"div",19),D.Xb(5,"span"),D.Xc(6,"Repeat number of times"),D.Wb(),D.Wb(),D.Xb(7,"div",19),D.Xb(8,"nz-input-number",20),D.ec("ngModelChange",function(n){return D.Lc(e),D.ic(2).scheduling.repeat.frequency=n}),D.Wb(),D.Wb(),D.Wb(),D.Ub()}if(2&e){const e=D.ic(2);D.Db(8),D.rc("ngModel",e.scheduling.repeat.frequency)("nzMin",1)("nzStep",1)}}function fe(e,n){if(1&e){const e=D.Yb();D.Vb(0),D.Xb(1,"div",9),D.Xb(2,"div",10),D.Xb(3,"nz-checkbox-group",4),D.ec("ngModelChange",function(n){return D.Lc(e),D.ic(2).weekdays=n}),D.Wb(),D.Wb(),D.Wb(),D.Sb(4,"br"),D.Sb(5,"br"),D.Ub()}if(2&e){const e=D.ic(2);D.Db(3),D.rc("ngModel",e.weekdays)}}function me(e,n){if(1&e){const e=D.Yb();D.Vb(0),D.Xb(1,"div",9),D.Xb(2,"div",2),D.Xb(3,"nz-radio-group",4),D.ec("ngModelChange",function(n){return D.Lc(e),D.ic().scheduling.repeat.type=n}),D.Xb(4,"label",17),D.Xb(5,"span"),D.Xc(6,"Days"),D.Wb(),D.Wb(),D.Xb(7,"label",18),D.Xb(8,"span"),D.Xc(9,"Weeks"),D.Wb(),D.Wb(),D.Wb(),D.Wb(),D.Xb(10,"div",3),D.Xb(11,"div",1),D.Xb(12,"div",6),D.Xb(13,"span"),D.Xc(14,"Till care plan end"),D.Wb(),D.Wb(),D.Xb(15,"div",5),D.Xb(16,"nz-switch",4),D.ec("ngModelChange",function(n){return D.Lc(e),D.ic().scheduling.repeat.tillCarePlanEnd=n}),D.Wb(),D.Wb(),D.Wb(),D.Wb(),D.Wb(),D.Vc(17,ve,9,3,"ng-container",8),D.Vb(18),D.Sb(19,"br"),D.Sb(20,"br"),D.Xb(21,"div",9),D.Xb(22,"div",19),D.Xb(23,"span"),D.Xc(24,"Repeats Every"),D.Wb(),D.Wb(),D.Xb(25,"div",19),D.Xb(26,"nz-input-number",20),D.ec("ngModelChange",function(n){return D.Lc(e),D.ic().scheduling.repeat.repeatsEvery=n}),D.Wb(),D.Wb(),D.Wb(),D.Ub(),D.Sb(27,"br"),D.Sb(28,"br"),D.Vc(29,fe,6,1,"ng-container",8),D.Ub()}if(2&e){const e=D.ic();D.Db(3),D.rc("ngModel",e.scheduling.repeat.type),D.Db(13),D.rc("ngModel",e.scheduling.repeat.tillCarePlanEnd),D.Db(1),D.rc("ngIf",!e.scheduling.repeat.tillCarePlanEnd),D.Db(9),D.rc("ngModel",e.scheduling.repeat.repeatsEvery)("nzMin",1)("nzStep",1),D.Db(3),D.rc("ngIf","WEEKLY"===(null==e.scheduling||null==e.scheduling.repeat?null:e.scheduling.repeat.type))}}function Ie(e,n){if(1&e){const e=D.Yb();D.Xb(0,"button",21),D.ec("click",function(){return D.Lc(e),D.ic().saveSchedule()}),D.Xc(1,"Save"),D.Wb(),D.Sb(2,"nz-divider",22),D.Xb(3,"button",23),D.ec("click",function(){return D.Lc(e),D.ic().close()}),D.Xc(4,"Cancel"),D.Wb()}}let Ce=(()=>{class e{constructor(e,n,t){this._modelRef=e,this._datePipe=n,this._route=t,this.weekdays=[{label:"Sunday",value:"SUNDAY",checked:!0},{label:"Monday",value:"MONDAY",checked:!0},{label:"Tuesday",value:"TUESDAY",checked:!0},{label:"Wednesday",value:"WEDNESDAY",checked:!0},{label:"Thursday",value:"THURSDAY",checked:!0},{label:"Friday",value:"FRIDAY",checked:!0},{label:"Saturday",value:"SATURDAY",checked:!0}],this.disabledStartDate=e=>Object(re.a)(new Date(this.startDate).setHours(0,0,0,0),e)>0||Object(re.a)(new Date(this.endDate),e)<0}ngOnInit(){this._route.queryParams.subscribe(e=>{const n=e.episodeStartDate||(new Date).toISOString().split("T")[0];this.startDate=new Date((new Date).setHours(0,0,0,0)),n&&new Date(new Date(n).setHours(0,0,0,0))>=this.startDate&&(this.startDate=this.dateParser(n.toString())),this.endDate=Object(ae.a)(new Date);const t=e.episodeEndDate;t&&(this.endDate=new Date(t))}).unsubscribe()}checkIfDaysEnabled(){this.weekdays.forEach(e=>{this.scheduling.repeat.repeatOn[e.value.toLowerCase()]=e.checked})}saveSchedule(){this.checkIfDaysEnabled(),this.scheduling.startDate=this.startDate.getTime(),this.scheduling.startsOn=this._datePipe.transform(this.scheduling.startDate,"yyyy-MM-dd"),this._modelRef.close(this.scheduling)}close(){this._modelRef.close(null)}dateParser(e){const n=e.split("-");return new Date(+n[0],+n[1]-1,+n[2])}}return e.\u0275fac=function(n){return new(n||e)(D.Rb(se.e),D.Rb(r.e),D.Rb(d.a))},e.\u0275cmp=D.Lb({type:e,selectors:[["app-scheduling-dialog"]],inputs:{scheduling:"scheduling",schedulingmode:"schedulingmode"},features:[D.Cb([r.e])],decls:43,vars:12,consts:[["nzTitle","Schedule",3,"nzBordered","nzExtra"],["nz-row",""],["nz-col","","nzSpan","10"],["nz-col","","nzSpan","14"],[3,"ngModel","ngModelChange"],["nz-col","","nzSpan","6"],["nz-col","","nzSpan","18"],[3,"ngModel","nzFormat","nzDisabledDate","nzPlaceHolder","nzAllowClear","ngModelChange"],[4,"ngIf"],["nz-row","",1,"text-center"],["nz-col","","nzSpan","24"],[3,"ngModel","nzButtonStyle","ngModelChange"],["nz-radio-button","","nzValue","MORNING"],["nz-radio-button","","nzValue","AFTERNOON"],["nz-radio-button","","nzValue","EVENING"],["nz-radio-button","","nzValue","NIGHT"],["actions",""],["nz-radio-button","","nzValue","DAILY"],["nz-radio-button","","nzValue","WEEKLY"],["nz-col","","nzSpan","12"],[3,"ngModel","nzMin","nzStep","ngModelChange"],["nz-button","","nzType","primary",3,"click"],["nzType","vertical"],["nz-button","","nzType","danger",3,"click"]],template:function(e,n){if(1&e&&(D.Xb(0,"nz-card",0),D.Xb(1,"div",1),D.Xb(2,"div",2),D.Xb(3,"span"),D.Xc(4,"Roll Over To Next Day"),D.Wb(),D.Wb(),D.Xb(5,"div",3),D.Xb(6,"nz-switch",4),D.ec("ngModelChange",function(e){return n.scheduling.scheduleRollOver=e}),D.Wb(),D.Wb(),D.Wb(),D.Sb(7,"br"),D.Sb(8,"br"),D.Xb(9,"div",1),D.Xb(10,"div",2),D.Xb(11,"span"),D.Xc(12,"Recurring"),D.Wb(),D.Wb(),D.Xb(13,"div",3),D.Xb(14,"nz-switch",4),D.ec("ngModelChange",function(e){return n.scheduling.repeatedEvent=e}),D.Wb(),D.Wb(),D.Wb(),D.Sb(15,"br"),D.Sb(16,"br"),D.Xb(17,"div",1),D.Xb(18,"div",5),D.Xb(19,"span"),D.Xc(20,"Start On"),D.Wb(),D.Wb(),D.Xb(21,"div",6),D.Xb(22,"nz-date-picker",7),D.ec("ngModelChange",function(e){return n.startDate=e}),D.Wb(),D.Wb(),D.Wb(),D.Sb(23,"br"),D.Sb(24,"br"),D.Vc(25,me,30,7,"ng-container",8),D.Xb(26,"div",9),D.Xb(27,"div",10),D.Xb(28,"nz-radio-group",11),D.ec("ngModelChange",function(e){return n.scheduling.timeSlot=e}),D.Xb(29,"label",12),D.Xb(30,"span"),D.Xc(31,"Morning"),D.Wb(),D.Wb(),D.Xb(32,"label",13),D.Xb(33,"span"),D.Xc(34,"Afternoon"),D.Wb(),D.Wb(),D.Xb(35,"label",14),D.Xb(36,"span"),D.Xc(37,"Evening"),D.Wb(),D.Wb(),D.Xb(38,"label",15),D.Xb(39,"span"),D.Xc(40,"Night"),D.Wb(),D.Wb(),D.Wb(),D.Wb(),D.Wb(),D.Wb(),D.Vc(41,Ie,5,0,"ng-template",null,16,D.Wc)),2&e){const e=D.Ic(42);D.rc("nzBordered",!1)("nzExtra",e),D.Db(6),D.rc("ngModel",n.scheduling.scheduleRollOver),D.Db(8),D.rc("ngModel",n.scheduling.repeatedEvent),D.Db(8),D.rc("ngModel",n.startDate)("nzFormat","mediumDate")("nzDisabledDate",n.disabledStartDate)("nzPlaceHolder","Today Set By Default")("nzAllowClear",!1),D.Db(3),D.rc("ngIf",null==n.scheduling?null:n.scheduling.repeatedEvent),D.Db(3),D.rc("ngModel",n.scheduling.timeSlot)("nzButtonStyle","solid")}},directives:[ce.a,O.c,O.a,oe.a,c.u,c.x,le.a,r.q,de.c,de.b,de.a,ue.a,N.b,pe.a,he.a,be.a,ge.a],styles:[".text-center[_ngcontent-%COMP%]{text-align:center}"]}),e})();const Me=[[["entity-actions"]],[["entity-listing"]]],De=["entity-actions","entity-listing"];let Te=(()=>{class e{constructor(){}ngOnInit(){}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=D.Lb({type:e,selectors:[["entity-manager"]],inputs:{name:"name"},ngContentSelectors:De,decls:8,vars:1,consts:[[1,"container"],[1,"container-header"],[1,"container-title"],[1,"spacer"]],template:function(e,n){1&e&&(D.qc(Me),D.Xb(0,"div",0),D.Xb(1,"div",1),D.Xb(2,"div",2),D.Xc(3),D.Wb(),D.Sb(4,"div",3),D.pc(5),D.Wb(),D.Sb(6,"nz-divider"),D.pc(7,1),D.Wb()),2&e&&(D.Db(3),D.Yc(n.name))},directives:[ge.a],styles:[".container-header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center}.container-title[_ngcontent-%COMP%]{font-size:1.6em;margin:0}.spacer[_ngcontent-%COMP%]{flex:1 1 auto}"]}),e})();const Ee=["*"];let Se=(()=>{class e{constructor(){}ngOnInit(){}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=D.Lb({type:e,selectors:[["entity-actions"]],ngContentSelectors:Ee,decls:1,vars:0,template:function(e,n){1&e&&(D.qc(),D.pc(0))},styles:[""]}),e})();const Oe=["*"];let ye=(()=>{class e{constructor(){}ngOnInit(){}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=D.Lb({type:e,selectors:[["entity-listing"]],ngContentSelectors:Oe,decls:1,vars:0,template:function(e,n){1&e&&(D.qc(),D.pc(0))},styles:[""]}),e})();var Ae=t("QlLE");const ze=["*",[["entity-item-actions"]]],Xe=function(e){return{"background-color":e}},ke=["*","entity-item-actions"];let Ne=(()=>{class e{constructor(){this.selected=!1,this.title="",this.description=""}ngOnInit(){}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=D.Lb({type:e,selectors:[["entity-item"]],inputs:{selected:"selected",title:"title",description:"description"},ngContentSelectors:ke,decls:11,vars:5,consts:[[1,"entity-item",2,"border-radius","10px",3,"ngStyle"],[1,"entity-info"],[1,"title"],[1,"description"],[1,"content"],[1,"spacer"]],template:function(e,n){1&e&&(D.qc(ze),D.Xb(0,"div",0),D.Xb(1,"div",1),D.Xb(2,"div",2),D.Xc(3),D.Wb(),D.Xb(4,"div",3),D.Xc(5),D.Wb(),D.Wb(),D.Xb(6,"div",4),D.pc(7),D.Wb(),D.Sb(8,"div",5),D.Xb(9,"div"),D.pc(10,1),D.Wb(),D.Wb()),2&e&&(D.rc("ngStyle",D.yc(3,Xe,n.selected?"#a7c853":"white")),D.Db(3),D.Zc(" ",n.title," "),D.Db(2),D.Zc(" ",n.description," "))},directives:[r.r],styles:[".entity-item[_ngcontent-%COMP%]{display:flex;padding:20px;cursor:pointer}.entity-info[_ngcontent-%COMP%]{z-index:0}.content[_ngcontent-%COMP%]{margin-left:30px}.title[_ngcontent-%COMP%]{font-size:12px;margin-bottom:5px}.description[_ngcontent-%COMP%]{font-size:12px;font-weight:700}.spacer[_ngcontent-%COMP%]{flex:1 1 auto}"]}),e})();const We=["*"];let Re=(()=>{class e{constructor(){}ngOnInit(){}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=D.Lb({type:e,selectors:[["entity-item-actions"]],ngContentSelectors:We,decls:1,vars:0,template:function(e,n){1&e&&(D.qc(),D.pc(0))},styles:[""]}),e})();var _e=t("glKu");function Be(e,n){1&e&&D.Sb(0,"nz-empty",4)}function Pe(e,n){if(1&e){const e=D.Yb();D.Xb(0,"div"),D.Xb(1,"entity-item",5),D.Xb(2,"entity-item-actions"),D.Xb(3,"button",6),D.ec("click",function(){D.Lc(e);const t=n.$implicit;return D.ic().removeSchedule(t)}),D.Sb(4,"app-icons",7),D.Xc(5,"\xa0\xa0 Delete "),D.Wb(),D.Wb(),D.Wb(),D.Wb()}if(2&e){const e=n.$implicit,t=D.ic();D.Db(1),D.rc("title",null==e||null==e.repeat?null:e.repeat.summary)("description",null!=e&&e.scheduleRollOver?"Rollover pending task to next day: Yes":"Rollover pending task to next day: No"),D.Db(2),D.rc("nzSize",t.small)}}let Le=(()=>{class e extends h.a{constructor(e,n){super(),this._modalService=e,this._datePipe=n,this.schedulesChange=new D.n}ngOnInit(){null==this.schedules&&(this.schedules=[]),this.setScheduleSummary()}removeSchedule(e){this.schedules=this.schedules.filter(n=>n!=e),this.schedulesChange.next(this.schedules)}addSchedule(){const e=new ie.a;e.startDate=new Date((new Date).setHours(0,0,0,0)).getTime(),e.startsOn=this._datePipe.transform(e.startDate,"yyyy-MM-dd"),e.repeatedEvent=!0,e.repeat=new ee,e.repeat.type="DAILY",e.repeat.frequency=1,e.repeat.repeatsEvery=1,e.repeat.repeatOn=new te,e.repeat.tillCarePlanEnd=!0,e.timeSlot=ne.MORNING,this._modalService.create({nzContent:Ce,nzComponentParams:{schedulingmode:"ADD",scheduling:e},nzClosable:!1,nzFooter:null}).afterClose.pipe(Object(p.a)(this.unsubscribed)).subscribe(e=>{null!=e&&(null==this.schedules&&(this.schedules=[]),this.schedules.push(e),this.setScheduleSummary(),this.schedulesChange.next(this.schedules))})}setScheduleSummary(){this.schedules.forEach(e=>{var n,t;const i=this._datePipe.transform((null==e?void 0:e.startsOn)||Date.now(),"MMMM d, yyyy");e.repeatedEvent||(e.repeat.summary=`One time event: ${null==e?void 0:e.timeSlot} - ${i}`),"DAILY"===(null===(n=null==e?void 0:e.repeat)||void 0===n?void 0:n.type)&&this.getSummaryForDailyInterventions(e),"WEEKLY"===(null===(t=null==e?void 0:e.repeat)||void 0===t?void 0:t.type)&&this.getSummaryForWeeklyInterventions(e)})}getSummaryForDailyInterventions(e){var n,t,i,r;const a=this._datePipe.transform((null==e?void 0:e.startsOn)||Date.now(),"MMMM d, yyyy");e.repeat.summary=(null===(n=null==e?void 0:e.repeat)||void 0===n?void 0:n.repeatsEvery)>1?`Repeats every ${null===(t=null==e?void 0:e.repeat)||void 0===t?void 0:t.repeatsEvery} days ${null==e?void 0:e.timeSlot}, ends after ${e.repeat.frequency} times, from ${a}`:`Repeats daily ${null==e?void 0:e.timeSlot}, ends after ${e.repeat.frequency} times, from ${a}`,e.repeat.tillCarePlanEnd&&(e.repeat.summary=(null===(i=null==e?void 0:e.repeat)||void 0===i?void 0:i.repeatsEvery)>1?`Repeats every ${null===(r=null==e?void 0:e.repeat)||void 0===r?void 0:r.repeatsEvery} days\n\t\t\t\t${null==e?void 0:e.timeSlot}, till end of care plan, from ${a}`:`Repeats daily ${null==e?void 0:e.timeSlot}, till end of care plan, from ${a}`)}getSummaryForWeeklyInterventions(e){var n,t,i,r,a,s,c,o,l;const d=this._datePipe.transform((null==e?void 0:e.startsOn)||Date.now(),"MMMM d, yyyy");e.repeat.summary=(null===(n=null==e?void 0:e.repeat)||void 0===n?void 0:n.repeatsEvery)>1?`Repeats every ${null===(t=null==e?void 0:e.repeat)||void 0===t?void 0:t.repeatsEvery} weeks,\n\t\t\t${null==e?void 0:e.timeSlot}, ${this.getSelectedDays(null===(i=null==e?void 0:e.repeat)||void 0===i?void 0:i.repeatOn)}\n\t\t\tends after ${e.repeat.frequency} times, from ${d}`:`Repeats every week ${null==e?void 0:e.timeSlot}, ${this.getSelectedDays(null===(r=null==e?void 0:e.repeat)||void 0===r?void 0:r.repeatOn)}, ends after \n\t\t\t\t${e.repeat.frequency} times, from ${d}`,e.repeat.tillCarePlanEnd&&(null===(a=null==e?void 0:e.repeat)||void 0===a?void 0:a.repeatsEvery)>1?e.repeat.summary=`Repeats every ${null===(s=null==e?void 0:e.repeat)||void 0===s?void 0:s.repeatsEvery} weeks\n\t\t\t ${this.getSelectedDays(null===(c=null==e?void 0:e.repeat)||void 0===c?void 0:c.repeatOn)} ${e.timeSlot}, \n\t\t\ttill end of care plan, from ${d}`:e.repeat.tillCarePlanEnd&&1===(null===(o=null==e?void 0:e.repeat)||void 0===o?void 0:o.repeatsEvery)&&(e.repeat.summary=`Repeats every week ${this.getSelectedDays(null===(l=null==e?void 0:e.repeat)||void 0===l?void 0:l.repeatOn)} ${e.timeSlot}, till end of care plan, from ${d}`)}getSelectedDays(e){let n=0,t="on ";return Object.keys(e).forEach(i=>{e[i]&&(t+=i+", ",n+=1)}),7===n?"":t}}return e.\u0275fac=function(n){return new(n||e)(D.Rb(se.f),D.Rb(r.e))},e.\u0275cmp=D.Lb({type:e,selectors:[["app-intervention-schedule"]],inputs:{schedules:"schedules"},outputs:{schedulesChange:"schedulesChange"},features:[D.Cb([r.e]),D.Ab],decls:7,vars:2,consts:[["name","Schedules"],["nz-button","","nzType","primary",3,"click"],["nzNotFoundContent","No Schedules",4,"ngIf"],[4,"ngFor","ngForOf"],["nzNotFoundContent","No Schedules"],[3,"title","description"],["nz-button","","nzType","danger",3,"nzSize","click"],["size","11px","color","red","name","delete"]],template:function(e,n){1&e&&(D.Xb(0,"entity-manager",0),D.Xb(1,"entity-actions"),D.Xb(2,"button",1),D.ec("click",function(){return n.addSchedule()}),D.Xc(3,"Add schedule"),D.Wb(),D.Wb(),D.Xb(4,"entity-listing"),D.Vc(5,Be,1,0,"nz-empty",2),D.Vc(6,Pe,6,3,"div",3),D.Wb(),D.Wb()),2&e&&(D.Db(5),D.rc("ngIf",0==(null==n.schedules?null:n.schedules.length)),D.Db(1),D.rc("ngForOf",n.schedules))},directives:[Te,Se,pe.a,he.a,be.a,ye,r.q,r.p,Ae.b,Ne,Re,_e.a],styles:[".container-header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center}.container-title[_ngcontent-%COMP%]{font-size:1.6em;margin:0}"]}),e})();var we=t("rMZv");function Ve(e,n){if(1&e&&(D.Xb(0,"tr"),D.Xb(1,"td"),D.Xc(2),D.Wb(),D.Xb(3,"td"),D.Xc(4),D.Wb(),D.Wb()),2&e){const e=n.$implicit;D.Db(2),D.Yc(null==e?null:e.label),D.Db(2),D.Yc(null==e?null:e.unit)}}function Ue(e,n){if(1&e&&(D.Xb(0,"entity-manager",1),D.jc(1,"translate"),D.Xb(2,"entity-listing"),D.Xb(3,"nz-table",2),D.Xb(4,"thead"),D.Xb(5,"tr"),D.Xb(6,"th"),D.Xc(7),D.jc(8,"translate"),D.Wb(),D.Xb(9,"th"),D.Xc(10),D.jc(11,"translate"),D.Wb(),D.Wb(),D.Wb(),D.Xb(12,"tbody"),D.Vc(13,Ve,5,2,"tr",3),D.Wb(),D.Wb(),D.Wb(),D.Wb()),2&e){const e=D.ic();D.sc("name",D.kc(1,4,"VITAL.PARAMETERS")),D.Db(7),D.Yc(D.kc(8,6,"VITAL")),D.Db(3),D.Yc(D.kc(11,8,"TABLEHEADER.UNIT")),D.Db(3),D.rc("ngForOf",e.vitalParams)}}function Fe(e,n){if(1&e){const e=D.Yb();D.Xb(0,"entity-manager",1),D.jc(1,"translate"),D.Xb(2,"entity-listing"),D.Xb(3,"div"),D.Xb(4,"input",4),D.ec("ngModelChange",function(n){return D.Lc(e),D.ic().parameters.instruction=n})("ngModelChange",function(){return D.Lc(e),D.ic().updateParameters()}),D.jc(5,"translate"),D.Wb(),D.Wb(),D.Wb(),D.Wb()}if(2&e){const e=D.ic();D.sc("name",D.kc(1,3,"COMMON.INSTRUCTION")),D.Db(4),D.sc("placeholder",D.kc(5,5,"COMMON.INSTRUCTION")),D.rc("ngModel",e.parameters.instruction)}}let Ge=(()=>{class e{constructor(){}ngOnInit(){try{this.parameters=JSON.parse(this.intervention.parameters)}catch(e){}this.parameters||(this.parameters=new Q),this.intervention&&"VITAL"===this.intervention.type&&(this.vitalParams=this.parameters.parameters)}updateParameters(){this.intervention.parameters=JSON.stringify(this.parameters)}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=D.Lb({type:e,selectors:[["app-intervention-fields"]],inputs:{intervention:"intervention"},decls:2,vars:2,consts:[[3,"name",4,"ngIf"],[3,"name"],["nzTemplateMode","true"],[4,"ngFor","ngForOf"],["nz-input","",3,"placeholder","ngModel","ngModelChange"]],template:function(e,n){1&e&&(D.Vc(0,Ue,14,10,"entity-manager",0),D.Vc(1,Fe,6,7,"entity-manager",0)),2&e&&(D.rc("ngIf","VITAL"===n.intervention.type),D.Db(1),D.rc("ngIf","VITAL"!==n.intervention.type))},directives:[r.q,Te,ye,we.f,we.n,we.o,we.e,we.l,we.i,r.p,X.b,c.d,c.u,c.x],pipes:[W.a],styles:["tr[_ngcontent-%COMP%]{cursor:default}i[_ngcontent-%COMP%]{cursor:pointer}.diet-input[_ngcontent-%COMP%]{margin:0 0 2%}"]}),e})();var xe=t("ZFQP");function Ye(e,n){if(1&e&&(D.Xb(0,"label",12),D.Xc(1),D.jc(2,"translate"),D.Wb()),2&e){const e=n.$implicit;D.rc("nzValue",e.id),D.Db(1),D.Yc(D.kc(2,2,e.name))}}let He=(()=>{class e{constructor(e){this._modalRef=e,this.feedBackTemplate=new xe.a,this.feedbackTypes=[{name:"BOOLEAN",id:"Boolean"},{name:"TEXT",id:"Text"}]}ngOnInit(){}saveFeedback(){this._modalRef.close(this.feedBackTemplate)}cancel(){this._modalRef.close()}}return e.\u0275fac=function(n){return new(n||e)(D.Rb(se.e))},e.\u0275cmp=D.Lb({type:e,selectors:[["app-feedback-dialog"]],decls:33,vars:27,consts:[[3,"nzText"],[2,"margin-top","20px",3,"nzAddOnBefore"],["type","text","nz-input","",3,"ngModel","ngModelChange"],[2,"margin-top","20px"],["id","feedBackType",3,"ngModel","ngModelChange"],["nz-radio","","style","margin-right:20px;",3,"nzValue",4,"ngFor","ngForOf"],["nz-checkbox","","id","caretakerfeedbackAlert",3,"ngModel","ngModelChange"],["nz-checkbox","","id","patientfeedbackAlert",3,"ngModel","ngModelChange"],["nz-checkbox","","id","guradianfeedbackAlert",3,"ngModel","ngModelChange"],[2,"margin-top","20px","margin-bottom","20px"],["nz-button","",3,"click"],["nz-button","","nzType","primary",3,"click"],["nz-radio","",2,"margin-right","20px",3,"nzValue"]],template:function(e,n){1&e&&(D.Xb(0,"div"),D.Sb(1,"nz-divider",0),D.jc(2,"translate"),D.Xb(3,"nz-input-group",1),D.jc(4,"translate"),D.Xb(5,"input",2),D.ec("ngModelChange",function(e){return n.feedBackTemplate.label=e}),D.Wb(),D.Wb(),D.Xb(6,"div",3),D.Xc(7),D.jc(8,"translate"),D.Wb(),D.Xb(9,"div"),D.Xb(10,"nz-radio-group",4),D.ec("ngModelChange",function(e){return n.feedBackTemplate.type=e}),D.Vc(11,Ye,3,4,"label",5),D.Wb(),D.Wb(),D.Xb(12,"div",3),D.Xc(13),D.jc(14,"translate"),D.Wb(),D.Xb(15,"div"),D.Xb(16,"div"),D.Xb(17,"label",6),D.ec("ngModelChange",function(e){return n.feedBackTemplate.caretakerAlert=e}),D.Xc(18),D.jc(19,"translate"),D.Wb(),D.Wb(),D.Xb(20,"div"),D.Xb(21,"label",7),D.ec("ngModelChange",function(e){return n.feedBackTemplate.patientAlert=e}),D.Xc(22),D.jc(23,"translate"),D.Wb(),D.Wb(),D.Xb(24,"div"),D.Xb(25,"label",8),D.ec("ngModelChange",function(e){return n.feedBackTemplate.guardianAlert=e}),D.Xc(26),D.jc(27,"translate"),D.Wb(),D.Wb(),D.Wb(),D.Xb(28,"nz-button-group",9),D.Xb(29,"button",10),D.ec("click",function(){return n.cancel()}),D.Xc(30,"Cancel"),D.Wb(),D.Xb(31,"button",11),D.ec("click",function(){return n.saveFeedback()}),D.Xc(32,"OK"),D.Wb(),D.Wb(),D.Wb()),2&e&&(D.Db(1),D.sc("nzText",D.kc(2,13,"COMMON.ADDFEEDBACK")),D.Db(2),D.sc("nzAddOnBefore",D.kc(4,15,"COMMON.FEEDBACKPROMPT")),D.Db(2),D.rc("ngModel",n.feedBackTemplate.label),D.Db(2),D.Yc(D.kc(8,17,"COMMON.ANSWERTITLE")),D.Db(3),D.rc("ngModel",n.feedBackTemplate.type),D.Db(1),D.rc("ngForOf",n.feedbackTypes),D.Db(2),D.Yc(D.kc(14,19,"COMMON.FEEDBACKRESPONSIBILITY")),D.Db(4),D.rc("ngModel",n.feedBackTemplate.caretakerAlert),D.Db(1),D.Zc(" ",D.kc(19,21,"TITLE.CARETAKERS")," "),D.Db(3),D.rc("ngModel",n.feedBackTemplate.patientAlert),D.Db(1),D.Zc(" ",D.kc(23,23,"FORM.PATIENTS")," "),D.Db(3),D.rc("ngModel",n.feedBackTemplate.guardianAlert),D.Db(1),D.Zc(" ",D.kc(27,25,"COMMON.GUARDIAN")," "))},directives:[ge.a,be.a,X.c,X.b,c.d,c.u,c.x,de.c,r.p,N.a,pe.b,pe.a,he.a,de.b],pipes:[W.a],styles:[""]}),e})();var je=t("ZyQt");function $e(e,n){1&e&&D.Sb(0,"nz-empty",4)}function qe(e,n){if(1&e){const e=D.Yb();D.Xb(0,"div"),D.Xb(1,"entity-item",5),D.Xb(2,"nz-tag",6),D.Xc(3),D.jc(4,"translate"),D.Wb(),D.Xb(5,"entity-item-actions"),D.Xb(6,"button",7),D.ec("click",function(){D.Lc(e);const t=n.$implicit;return D.ic().removeFeedback(t)}),D.Sb(7,"app-icons",8),D.Xc(8," Delete"),D.Wb(),D.Wb(),D.Wb(),D.Wb()}if(2&e){const e=n.$implicit,t=D.ic();D.Db(1),D.rc("title",e.label),D.Db(1),D.rc("nzColor","BOOLEAN"==(null==e||null==e.type?null:e.type.toUpperCase())?"geekblue":"purple"),D.Db(1),D.Zc(" ",D.kc(4,4,null==e||null==e.type?null:e.type.toUpperCase())," "),D.Db(3),D.rc("nzSize",t.small)}}let Ke=(()=>{class e{constructor(e){this._modalService=e,this.feedbackInput=[],this.feedbackInputChange=new D.n}ngOnInit(){try{this.parameters=JSON.parse(this.intervention.parameters)}catch(e){this.parameters=new Q}this.parameters&&this.parameters.feedBackInput&&(this.feedbackInput=this.parameters.feedBackInput),void 0===this.feedbackInput&&(this.feedbackInput=[])}showFeedbackDialog(){null==this.feedbackInput&&(this.feedbackInput=[]),this._modalService.create({nzContent:He}).afterClose.subscribe(e=>{null!=e&&(this.feedbackInput.push(e),this.feedbackInputChange.next(this.feedbackInput),this.parameters.feedBackInput=this.feedbackInput,this.intervention.parameters=JSON.stringify(this.parameters))})}removeFeedback(e){this.feedbackInput=this.feedbackInput.filter(n=>n!=e),this.feedbackInputChange.next(this.feedbackInput),this.parameters.feedBackInput=this.feedbackInput,this.intervention.parameters=JSON.stringify(this.parameters)}}return e.\u0275fac=function(n){return new(n||e)(D.Rb(se.f))},e.\u0275cmp=D.Lb({type:e,selectors:[["app-intervention-feedback"]],inputs:{intervention:"intervention"},outputs:{feedbackInputChange:"feedbackInputChange"},decls:7,vars:2,consts:[["name","Feedback"],["nz-button","","nzType","primary",3,"click"],["nzNotFoundContent","No feedbacks",4,"ngIf"],[4,"ngFor","ngForOf"],["nzNotFoundContent","No feedbacks"],[3,"title","description"],[3,"nzColor"],["nz-button","","nzType","danger",3,"nzSize","click"],["name","delete"]],template:function(e,n){1&e&&(D.Xb(0,"entity-manager",0),D.Xb(1,"entity-actions"),D.Xb(2,"button",1),D.ec("click",function(){return n.showFeedbackDialog()}),D.Xc(3,"Add Feedback"),D.Wb(),D.Wb(),D.Xb(4,"entity-listing"),D.Vc(5,$e,1,0,"nz-empty",2),D.Vc(6,qe,9,6,"div",3),D.Wb(),D.Wb()),2&e&&(D.Db(5),D.rc("ngIf",0==n.feedbackInput.length),D.Db(1),D.rc("ngForOf",n.feedbackInput))},directives:[Te,Se,pe.a,he.a,be.a,ye,r.q,r.p,Ae.b,Ne,je.a,Re,_e.a],pipes:[W.a],styles:[""]}),e})();class Je{constructor(){}}class Ze{constructor(){}}let Qe=(()=>{class e{constructor(e){this.route=e,this.accessPermission=new Je,this.accessPermission.caretaker=new Ze,this.accessPermission.patient=new Ze,this.accessPermission.guardian=new Ze}ngOnInit(){this.route.params.forEach(e=>{this.careplanBlueprintId=e.id}),this.permissions=this.intervention.permissions,this.changePermission(),this.initAccessPermissions()}changePermission(){"HEALTH_SCORE"!==this.intervention.type&&(this.careplanBlueprintId||(this.permissions="REMOTE_PATIENT_MONITORING"!==this.careplanType?"666":"464"))}initAccessPermissions(){if(this.permissions){let e=parseInt(this.permissions.substr(0,1)),n=parseInt(this.permissions.substr(1,1)),t=parseInt(this.permissions.substr(2,3));e-4>=0&&(e-=4,this.accessPermission.caretaker.canRead=!0),e-2>=0&&(e-=2,this.accessPermission.caretaker.canWrite=!0),n-4>=0&&(n-=4,this.accessPermission.patient.canRead=!0),n-2>=0&&(n-=2,this.accessPermission.patient.canWrite=!0),t-4>=0&&(t-=4,this.accessPermission.guardian.canRead=!0),t-2>=0&&(t-=2,this.accessPermission.guardian.canWrite=!0)}else this.accessPermission.caretaker.canExecute=!1,this.accessPermission.patient.canExecute=!1,this.accessPermission.guardian.canExecute=!1,this.accessPermission.caretaker.canRead=!0,this.accessPermission.patient.canRead=!0,this.accessPermission.guardian.canRead=!0,this.accessPermission.caretaker.canWrite=!0,this.accessPermission.patient.canWrite=!0,this.accessPermission.guardian.canWrite=!0,this.permissions="666"}calc_chmod(){let e=0;e+=this.accessPermission.caretaker.canRead?4:0,e+=this.accessPermission.caretaker.canWrite?2:0;let n=0;n+=this.accessPermission.patient.canRead?4:0,n+=this.accessPermission.patient.canWrite?2:0;let t=0;t+=this.accessPermission.guardian.canRead?4:0,t+=this.accessPermission.guardian.canWrite?2:0,this.permissions=e+""+n+t,this.intervention.permissions=this.permissions}}return e.\u0275fac=function(n){return new(n||e)(D.Rb(d.a))},e.\u0275cmp=D.Lb({type:e,selectors:[["app-intervention-permissions"]],inputs:{intervention:"intervention",careplanType:"careplanType"},decls:32,vars:6,consts:[["name","Permissions"],["nzTemplateMode","true"],["nz-checkbox","",3,"ngModel","ngModelChange"]],template:function(e,n){1&e&&(D.Xb(0,"entity-manager",0),D.Xb(1,"entity-listing"),D.Xb(2,"nz-table",1),D.Xb(3,"thead"),D.Xb(4,"tr"),D.Xb(5,"th"),D.Xc(6,"Type"),D.Wb(),D.Xb(7,"th"),D.Xc(8,"Caretaker"),D.Wb(),D.Xb(9,"th"),D.Xc(10,"Patient"),D.Wb(),D.Xb(11,"th"),D.Xc(12,"Guardian"),D.Wb(),D.Wb(),D.Wb(),D.Xb(13,"tbody"),D.Xb(14,"tr"),D.Xb(15,"td"),D.Xc(16,"Read"),D.Wb(),D.Xb(17,"td"),D.Xb(18,"label",2),D.ec("ngModelChange",function(e){return n.accessPermission.caretaker.canRead=e})("ngModelChange",function(){return n.calc_chmod()}),D.Wb(),D.Wb(),D.Xb(19,"td"),D.Xb(20,"label",2),D.ec("ngModelChange",function(e){return n.accessPermission.patient.canRead=e})("ngModelChange",function(){return n.calc_chmod()}),D.Wb(),D.Wb(),D.Xb(21,"td"),D.Xb(22,"label",2),D.ec("ngModelChange",function(e){return n.accessPermission.guardian.canRead=e})("ngModelChange",function(){return n.calc_chmod()}),D.Wb(),D.Wb(),D.Wb(),D.Xb(23,"tr"),D.Xb(24,"td"),D.Xc(25,"Write"),D.Wb(),D.Xb(26,"td"),D.Xb(27,"label",2),D.ec("ngModelChange",function(e){return n.accessPermission.caretaker.canWrite=e})("ngModelChange",function(){return n.calc_chmod()}),D.Wb(),D.Wb(),D.Xb(28,"td"),D.Xb(29,"label",2),D.ec("ngModelChange",function(e){return n.accessPermission.patient.canWrite=e})("ngModelChange",function(){return n.calc_chmod()}),D.Wb(),D.Wb(),D.Xb(30,"td"),D.Xb(31,"label",2),D.ec("ngModelChange",function(e){return n.accessPermission.guardian.canWrite=e})("ngModelChange",function(){return n.calc_chmod()}),D.Wb(),D.Wb(),D.Wb(),D.Wb(),D.Wb(),D.Wb(),D.Wb()),2&e&&(D.Db(18),D.rc("ngModel",n.accessPermission.caretaker.canRead),D.Db(2),D.rc("ngModel",n.accessPermission.patient.canRead),D.Db(2),D.rc("ngModel",n.accessPermission.guardian.canRead),D.Db(5),D.rc("ngModel",n.accessPermission.caretaker.canWrite),D.Db(2),D.rc("ngModel",n.accessPermission.patient.canWrite),D.Db(2),D.rc("ngModel",n.accessPermission.guardian.canWrite))},directives:[Te,ye,we.f,we.n,we.o,we.e,we.l,we.i,N.a,c.u,c.x],styles:["[_nghost-%COMP%]     .ant-checkbox-inner{width:20px;height:20px;border:1px solid var(--grey);border-radius:5px;background-color:#fbfbfb}[_nghost-%COMP%]     .ant-checkbox-inner:after{top:-2px;left:2px;border:4px solid #2f4f4f;border-top:0;border-left:0;transform:rotate(45deg) scale(.5) translate(-50%,-50%)}"]}),e})();function en(e,n){if(1&e){const e=D.Yb();D.Xb(0,"app-intervention-permissions",4),D.ec("careplanTypeChange",function(n){return D.Lc(e),D.ic(2).careplanType=n})("interventionChange",function(n){return D.Lc(e),D.ic(2).interventionBlueprint=n}),D.Wb()}if(2&e){const e=D.ic(2);D.rc("careplanType",e.careplanType)("intervention",e.interventionBlueprint)}}function nn(e,n){if(1&e){const e=D.Yb();D.Vb(0),D.Xb(1,"app-intervention-schedule",1),D.ec("schedulesChange",function(n){return D.Lc(e),D.ic().interventionBlueprint.schedules=n}),D.Wb(),D.Xb(2,"app-intervention-fields",2),D.ec("interventionChange",function(n){return D.Lc(e),D.ic().interventionBlueprint=n}),D.Wb(),D.Vc(3,en,1,2,"app-intervention-permissions",3),D.Xb(4,"app-intervention-feedback",2),D.ec("interventionChange",function(n){return D.Lc(e),D.ic().interventionBlueprint=n}),D.Wb(),D.Ub()}if(2&e){const e=D.ic();D.Db(1),D.rc("schedules",e.interventionBlueprint.schedules),D.Db(1),D.rc("intervention",e.interventionBlueprint),D.Db(1),D.rc("ngIf","GROUP"!==e.interventionBlueprint.type),D.Db(1),D.rc("intervention",e.interventionBlueprint)}}let tn=(()=>{class e{constructor(){this.isReviewAndResponseEnabled=!1}ngOnInit(){"REMOTE_PATIENT_MONITORING"===this.careplanType&&(this.interventionBlueprint.reviewResponseEnabled=!0)}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=D.Lb({type:e,selectors:[["app-default-intervention"]],decls:1,vars:1,consts:[[4,"ngIf"],[3,"schedules","schedulesChange"],[3,"intervention","interventionChange"],[3,"careplanType","intervention","careplanTypeChange","interventionChange",4,"ngIf"],[3,"careplanType","intervention","careplanTypeChange","interventionChange"]],template:function(e,n){1&e&&D.Vc(0,nn,5,4,"ng-container",0),2&e&&D.rc("ngIf",n.interventionBlueprint)},directives:[r.q,Le,Ge,Ke,Qe],styles:[""]}),e})();var rn=t("sG7K"),an=t("Dwgb"),sn=t("3pGX"),cn=t("vRiJ"),on=t("pe0G");let ln=(()=>{class e{constructor(e){this.dataSharingService=e,this.healthScores=new Map,this.init()}init(){this.dataSharingService.tenantSettings.subscribe(e=>{this.tenantSettings=e,this.getEnabledHealthScores()})}getEnabledHealthScores(){if(null!=this.tenantSettings.healthScoreConfig||null!=this.tenantSettings.healthScoreConfig){const e=this.tenantSettings.healthScoreConfig;null!=e.healthScores&&null!=e.healthScores&&e.healthScores.forEach(e=>{e.enabled&&"WELLNESS_SCORE"!=e.healthScoreType&&this.healthScores.set(e.healthScoreType,e)})}}getHealthScoreInterventions(){const e=[];if(this.healthScores.has("ROTHMAN_INDEX")){const n=new Z;n.id="_"+Math.random().toString(36).substr(2,9),n.name="Health Score",n.type="HEALTH_SCORE",n.entityType="HEALTH_SCORE",n.permissions="460",e.push(n)}if(this.healthScores.has("WELLNESS_SCORE")){const n=new Z;n.id="_"+Math.random().toString(36).substr(2,9),n.name="Wellness Score",n.type="WELLNESS_SCORE",n.entityType="WELLNESS_SCORE",n.permissions="460",e.push(n)}return e}}return e.\u0275fac=function(n){return new(n||e)(D.bc(I.a))},e.\u0275prov=D.Nb({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();var dn=t("KCkQ"),un=t("tkii"),pn=t("Nq9W"),hn=t("oyxB"),bn=t("3/1E"),gn=t("qAZ0");function vn(e,n){if(1&e){const e=D.Yb();D.Xb(0,"div",14),D.ec("click",function(){return D.Lc(e),D.ic().closeDialog()}),D.Sb(1,"app-icons",15),D.Wb()}}function fn(e,n){1&e&&D.Sb(0,"nz-spin",17)}function mn(e,n){if(1&e){const e=D.Yb();D.Xb(0,"div"),D.Xb(1,"entity-item",20),D.Xb(2,"entity-item-actions"),D.Xb(3,"button",21),D.ec("click",function(){D.Lc(e);const t=n.$implicit;return D.ic(3).raiseAddInterventionEvent(t)}),D.Sb(4,"app-icons",22),D.Xc(5,"\xa0 Add"),D.Wb(),D.Wb(),D.Wb(),D.Wb()}if(2&e){const e=n.$implicit;D.Db(1),D.rc("title",e.name)}}function In(e,n){if(1&e&&(D.Xb(0,"div",18),D.Vc(1,mn,6,1,"div",19),D.Wb()),2&e){const e=D.ic(2);D.Db(1),D.rc("ngForOf",e.vitalInterventions)}}function Cn(e,n){if(1&e){const e=D.Yb();D.Xb(0,"nz-tab",16),D.ec("nzClick",function(){return D.Lc(e),D.ic().getVitalBlueprints()}),D.Vc(1,fn,1,0,"nz-spin",7),D.Vc(2,In,2,1,"div",8),D.Xb(3,"nz-pagination",10),D.ec("nzPageIndexChange",function(n){return D.Lc(e),D.ic().getVitalBlueprints(n)}),D.Wb(),D.Wb()}if(2&e){const e=D.ic();D.Db(1),D.rc("ngIf",e.loading),D.Db(1),D.rc("ngIf",!e.loading),D.Db(1),D.rc("nzTotal",e.totalVitalsCount)}}function Mn(e,n){1&e&&D.Sb(0,"nz-spin",17)}function Dn(e,n){if(1&e){const e=D.Yb();D.Xb(0,"div"),D.Xb(1,"entity-item",20),D.Xb(2,"entity-item-actions"),D.Xb(3,"button",21),D.ec("click",function(){D.Lc(e);const t=n.$implicit;return D.ic(3).raiseAddInterventionEvent(t)}),D.Sb(4,"app-icons",22),D.Xc(5," \xa0Add "),D.Wb(),D.Wb(),D.Wb(),D.Wb()}if(2&e){const e=n.$implicit;D.Db(1),D.rc("title",e.name)}}function Tn(e,n){if(1&e&&(D.Xb(0,"div",18),D.Vc(1,Dn,6,1,"div",19),D.Wb()),2&e){const e=D.ic(2);D.Db(1),D.rc("ngForOf",e.healthScoreInterventions)}}function En(e,n){if(1&e&&(D.Xb(0,"nz-tab",23),D.jc(1,"translate"),D.Vc(2,Mn,1,0,"nz-spin",7),D.Vc(3,Tn,2,1,"div",8),D.Wb()),2&e){const e=D.ic();D.tc("nzTitle"," ",D.kc(1,3,"HEALTHSCORE.TITLE")," "),D.Db(2),D.rc("ngIf",e.loading),D.Db(1),D.rc("ngIf",!e.loading)}}function Sn(e,n){1&e&&D.Sb(0,"nz-spin",17)}function On(e,n){if(1&e){const e=D.Yb();D.Xb(0,"div"),D.Xb(1,"entity-item",20),D.Xb(2,"entity-item-actions"),D.Xb(3,"button",21),D.ec("click",function(){D.Lc(e);const t=n.$implicit;return D.ic(3).raiseAddInterventionEvent(t)}),D.Sb(4,"app-icons",22),D.Xc(5," \xa0Add"),D.Wb(),D.Wb(),D.Wb(),D.Wb()}if(2&e){const e=n.$implicit;D.Db(1),D.rc("title",e.name)}}function yn(e,n){if(1&e&&(D.Xb(0,"div",18),D.Vc(1,On,6,1,"div",19),D.Wb()),2&e){const e=D.ic(2);D.Db(1),D.rc("ngForOf",e.courseInterventions)}}function An(e,n){if(1&e){const e=D.Yb();D.Xb(0,"nz-tab",24),D.ec("nzClick",function(){return D.Lc(e),D.ic().getCourses()}),D.Vc(1,Sn,1,0,"nz-spin",7),D.Vc(2,yn,2,1,"div",8),D.Xb(3,"nz-pagination",10),D.ec("nzPageIndexChange",function(n){return D.Lc(e),D.ic().getCourses(n)}),D.Wb(),D.Wb()}if(2&e){const e=D.ic();D.Db(1),D.rc("ngIf",e.loading),D.Db(1),D.rc("ngIf",!e.loading),D.Db(1),D.rc("nzTotal",e.totalCoursesCount)}}function zn(e,n){1&e&&D.Sb(0,"nz-spin",17)}function Xn(e,n){if(1&e){const e=D.Yb();D.Xb(0,"div"),D.Xb(1,"entity-item",20),D.Xb(2,"entity-item-actions"),D.Xb(3,"button",21),D.ec("click",function(){D.Lc(e);const t=n.$implicit;return D.ic(3).raiseAddInterventionEvent(t)}),D.Sb(4,"app-icons",22),D.Xc(5," \xa0Add"),D.Wb(),D.Wb(),D.Wb(),D.Wb()}if(2&e){const e=n.$implicit;D.Db(1),D.rc("title",e.name)}}function kn(e,n){if(1&e&&(D.Xb(0,"div",18),D.Vc(1,Xn,6,1,"div",19),D.Wb()),2&e){const e=D.ic(2);D.Db(1),D.rc("ngForOf",e.formInterventions)}}function Nn(e,n){if(1&e){const e=D.Yb();D.Xb(0,"nz-tab",25),D.ec("nzClick",function(){return D.Lc(e),D.ic().getForms()}),D.Vc(1,zn,1,0,"nz-spin",7),D.Vc(2,kn,2,1,"div",8),D.Xb(3,"nz-pagination",10),D.ec("nzPageIndexChange",function(n){return D.Lc(e),D.ic().getForms(n)}),D.Wb(),D.Wb()}if(2&e){const e=D.ic();D.Db(1),D.rc("ngIf",e.loading),D.Db(1),D.rc("ngIf",!e.loading),D.Db(1),D.rc("nzTotal",e.totalFormsCount)}}function Wn(e,n){1&e&&D.Sb(0,"nz-spin",17)}function Rn(e,n){if(1&e){const e=D.Yb();D.Xb(0,"div"),D.Xb(1,"entity-item",20),D.Xb(2,"entity-item-actions"),D.Xb(3,"button",21),D.ec("click",function(){D.Lc(e);const t=n.$implicit;return D.ic(2).raiseAddInterventionEvent(t)}),D.Sb(4,"app-icons",22),D.Xc(5," \xa0Add"),D.Wb(),D.Wb(),D.Wb(),D.Wb()}if(2&e){const e=n.$implicit;D.Db(1),D.rc("title",e.name)}}function _n(e,n){if(1&e&&(D.Xb(0,"div",18),D.Vc(1,Rn,6,1,"div",19),D.Wb()),2&e){const e=D.ic();D.Db(1),D.rc("ngForOf",e.medicineInterventions)}}function Bn(e,n){1&e&&D.Sb(0,"nz-spin",17)}function Pn(e,n){if(1&e){const e=D.Yb();D.Xb(0,"div"),D.Xb(1,"entity-item",20),D.Xb(2,"entity-item-actions"),D.Xb(3,"button",21),D.ec("click",function(){D.Lc(e);const t=n.$implicit;return D.ic(2).raiseAddInterventionEvent(t)}),D.Sb(4,"app-icons",22),D.Xc(5," \xa0Add"),D.Wb(),D.Wb(),D.Wb(),D.Wb()}if(2&e){const e=n.$implicit;D.Db(1),D.rc("title",e.name)}}function Ln(e,n){if(1&e&&(D.Xb(0,"div",18),D.Vc(1,Pn,6,1,"div",19),D.Wb()),2&e){const e=D.ic();D.Db(1),D.rc("ngForOf",e.todoInterventions)}}function wn(e,n){1&e&&D.Sb(0,"nz-spin",17)}function Vn(e,n){if(1&e){const e=D.Yb();D.Xb(0,"div"),D.Xb(1,"entity-item",20),D.Xb(2,"entity-item-actions"),D.Xb(3,"button",21),D.ec("click",function(){D.Lc(e);const t=n.$implicit;return D.ic(2).raiseAddInterventionEvent(t)}),D.Sb(4,"app-icons",22),D.Xc(5,"\xa0 Add"),D.Wb(),D.Wb(),D.Wb(),D.Wb()}if(2&e){const e=n.$implicit;D.Db(1),D.rc("title",e.name)}}function Un(e,n){if(1&e&&(D.Xb(0,"div",18),D.Vc(1,Vn,6,1,"div",19),D.Wb()),2&e){const e=D.ic();D.Db(1),D.rc("ngForOf",e.activityInterventions)}}let Fn=(()=>{class e{constructor(e,n,t,i,r,a,s,c,o){this._regimeService=e,this._courseService=n,this._formsService=t,this._partnerService=i,this._vitalBlueprintsService=r,this._modalRef=a,this._healthScoreInterventionService=s,this._dataSharingService=c,this._careplanEventLogger=o,this.vitalInterventions=[],this.healthScoreInterventions=[],this.activityInterventions=[],this.dietInterventions=[],this.todoInterventions=[],this.courseInterventions=[],this.formInterventions=[],this.medicineInterventions=[],this.interventionsAdded=new D.n,this.totalVitalsCount=0,this.totalFormsCount=0,this.totalDietsCount=0,this.totalCoursesCount=0,this.totalOthersCount=0,this.featureConfigs=new dn.a,this.tenantSettings=new un.a}ngOnInit(){this._careplanEventLogger.pageViewEvent(this.constructor.name,"intervention selection dialog"),this.getVitalBlueprints(),this.healthScoreInterventions=this._healthScoreInterventionService.getHealthScoreInterventions(),this.$featureConfigsObserver=this._dataSharingService.featureConfigs.subscribe(e=>{e&&(this.featureConfigs=e)}),this.getTenantSettings()}ngOnDestroy(){this._careplanEventLogger.pageDestroyEvent(this.constructor.name,"intervention selection dialog"),this.$featureConfigsObserver.unsubscribe()}getOffset(e){let n=1;return n=1!==e?10*(e-1):0,n}getTenantSettings(){this._dataSharingService.tenantSettings.subscribe(e=>{e&&(this.tenantSettings=e)})}getForms(e=1){this.loading=!0,this._formsService.getFormsWithBody({phq9:this.featureConfigs.phq9,gad7:this.featureConfigs.gad7,ri:this.featureConfigs.ri,covid:this.featureConfigs.covid,feveriq:this.featureConfigs.feverIq,smsAssessment:!1},e-1,10,"").subscribe(e=>{var n,t,i,r;this.totalFormsCount=e.data.forms.total,this.formInterventions=[],null===(r=null===(i=null===(t=null===(n=null==e?void 0:e.data)||void 0===n?void 0:n.forms)||void 0===t?void 0:t.obj)||void 0===i?void 0:i.filter(e=>"SCORED_ASSESSMENT"===e.type||"ASSESSMENT"===e.type))||void 0===r||r.forEach(e=>{const n=new Z;n.id="_"+Math.random().toString(36).substr(2,9),n.name=e.title,n.type="WEB_FORM",n.entityType=e.type;const t={};t.formBlueprintId=e._id,n.parameters=JSON.stringify(t),this.formInterventions.push(n)}),this.loading=!1})}getVitalBlueprints(e=1){this.loading=!0,this._vitalBlueprintsService.fetchVitalBlueprintsForTenant().subscribe(e=>{this.totalVitalsCount=e.length,this.vitalInterventions=[],e.forEach(e=>{if(!e.active)return;const n=new Z;n.id="_"+Math.random().toString(36).substr(2,9),n.name=e.label,n.type="VITAL",n.entityType=e.type,n.parameters=JSON.stringify(e),this.vitalInterventions.push(n)}),this.loading=!1})}getMedicineInterventions(){this.loading=!0,this.medicineInterventions=[];const e=new Z;e.id="_"+Math.random().toString(36).substr(2,9),e.name="Custom Medicine",e.type="MEDICINE",this.medicineInterventions.push(e),this.loading=!1}getOtherInterventions(e=1){this.loading=!0,this._regimeService.getInterventionBlueprint().subscribe(e=>{this.totalOthersCount=this._partnerService.getTotalCount(e.headers);const n=e.body;this.activityInterventions=[],this.todoInterventions=[],n.forEach(e=>{"ACTIVITY"===e.type&&null===e.parentId&&("Runnning"===e.name&&(e.name="Running"),this.activityInterventions.push(e)),"TODO"===e.type&&null===e.parentId&&this.todoInterventions.push(e)});const t=new Z;t.name="Custom Activity",t.type="ACTIVITY",t.isTemplateCreated=!1,t.id="_"+Math.random().toString(36).substr(2,9),this.activityInterventions.push(t);const i=new Z;i.name="Custom Todo",i.type="TODO",i.isTemplateCreated=!1,i.id="_"+Math.random().toString(36).substr(2,9),this.todoInterventions.push(i),this.loading=!1})}getCourses(e=1){this.loading=!0,this._courseService.fetchCourses(this.getOffset(e),10).subscribe(e=>{this.totalCoursesCount=e.totalCount;const n=e.result;this.courseInterventions=[],n.forEach(e=>{if("CONTENT AS SUGGESTION"===e.type)return;const n=new Z;n.id="_"+Math.random().toString(36).substr(2,9),n.name=e.name,n.type="COURSE",n.parameters=JSON.stringify(e),this.courseInterventions.push(n)}),this.loading=!1})}raiseAddInterventionEvent(e){this._careplanEventLogger.episodeCareplanActionEvent("","","","careplan_add_intervention");const n=Object.assign({},e);"Custom Medicine"===n.name||"Custom Activity"===n.name||"Custom Todo"===n.name?(this.customInterventionBlueprint=n,this.isAddCustomModalVisible=!0):(n.id="_"+Math.random().toString(36).substr(2,9),this.interventionsAdded.next(n))}addCustomIntervention(){const e=Object.assign({},this.customInterventionBlueprint);e.id="_"+Math.random().toString(36).substr(2,9),e.name=this.customInterventionName,this.interventionsAdded.next(e),this.closeModal()}closeModal(){this.isAddCustomModalVisible=!1,this.customInterventionName="",this.customInterventionBlueprint=new Z}closeDialog(){this._modalRef.close()}}return e.\u0275fac=function(n){return new(n||e)(D.Rb(sn.a),D.Rb(cn.a),D.Rb(on.a),D.Rb(an.a),D.Rb(rn.a),D.Rb(se.e),D.Rb(ln),D.Rb(I.a),D.Rb(pn.a))},e.\u0275cmp=D.Lb({type:e,selectors:[["app-intervention-selection-dialog"]],inputs:{interventionGroupId:"interventionGroupId"},features:[D.Cb([rn.a,sn.a])],decls:20,vars:15,consts:[["class","close",3,"click",4,"ngIf"],[1,"interventions-container"],["nzTitle","Vitals",3,"nzClick",4,"ngIf"],[3,"nzTitle",4,"ngIf"],["nzTitle","Contents",3,"nzClick",4,"ngIf"],["nzTitle","Forms",3,"nzClick",4,"ngIf"],["nzTitle","Medicines",3,"nzClick"],["class","spinner","nzSimple","",4,"ngIf"],["class","intervention-list",4,"ngIf"],["nzTitle","Todo's",3,"nzClick"],[3,"nzTotal","nzPageIndexChange"],["nzTitle","Activities",3,"nzClick"],["nzTitle","Please enter a name for this intervention",3,"nzVisible","nzVisibleChange","nzOnOk","nzOnCancel"],["nz-input","","placeholder","Please enter a name...",3,"ngModel","ngModelChange"],[1,"close",3,"click"],["name","close"],["nzTitle","Vitals",3,"nzClick"],["nzSimple","",1,"spinner"],[1,"intervention-list"],[4,"ngFor","ngForOf"],[3,"title","description"],["nz-button","","nzType","primary","nzShape","round",3,"click"],["size","12px","color","#ffffff","name","plusCircle"],[3,"nzTitle"],["nzTitle","Contents",3,"nzClick"],["nzTitle","Forms",3,"nzClick"]],template:function(e,n){1&e&&(D.Vc(0,vn,2,0,"div",0),D.Xb(1,"div",1),D.Xb(2,"nz-tabset"),D.Vc(3,Cn,4,3,"nz-tab",2),D.Vc(4,En,4,5,"nz-tab",3),D.Vc(5,An,4,3,"nz-tab",4),D.Vc(6,Nn,4,3,"nz-tab",5),D.Xb(7,"nz-tab",6),D.ec("nzClick",function(){return n.getMedicineInterventions()}),D.Vc(8,Wn,1,0,"nz-spin",7),D.Vc(9,_n,2,1,"div",8),D.Wb(),D.Xb(10,"nz-tab",9),D.ec("nzClick",function(){return n.getOtherInterventions()}),D.Vc(11,Bn,1,0,"nz-spin",7),D.Vc(12,Ln,2,1,"div",8),D.Xb(13,"nz-pagination",10),D.ec("nzPageIndexChange",function(e){return n.getOtherInterventions(e)}),D.Wb(),D.Wb(),D.Xb(14,"nz-tab",11),D.ec("nzClick",function(){return n.getOtherInterventions()}),D.Vc(15,wn,1,0,"nz-spin",7),D.Vc(16,Un,2,1,"div",8),D.Xb(17,"nz-pagination",10),D.ec("nzPageIndexChange",function(e){return n.getOtherInterventions(e)}),D.Wb(),D.Wb(),D.Wb(),D.Wb(),D.Xb(18,"nz-modal",12),D.ec("nzVisibleChange",function(e){return n.isAddCustomModalVisible=e})("nzOnOk",function(){return n.addCustomIntervention()})("nzOnCancel",function(){return n.closeModal()}),D.Xb(19,"input",13),D.ec("ngModelChange",function(e){return n.customInterventionName=e}),D.Wb(),D.Wb()),2&e&&(D.rc("ngIf",!n.loading),D.Db(3),D.rc("ngIf",null==n.tenantSettings||null==n.tenantSettings.vitalConfig?null:n.tenantSettings.vitalConfig.enabled),D.Db(1),D.rc("ngIf",null==n.tenantSettings||null==n.tenantSettings.healthScoreConfig?null:n.tenantSettings.healthScoreConfig.enabled),D.Db(1),D.rc("ngIf",null==n.tenantSettings||null==n.tenantSettings.contentConfig?null:n.tenantSettings.contentConfig.enabled),D.Db(1),D.rc("ngIf",null==n.featureConfigs?null:n.featureConfigs.formsEnabled),D.Db(2),D.rc("ngIf",n.loading),D.Db(1),D.rc("ngIf",!n.loading),D.Db(2),D.rc("ngIf",n.loading),D.Db(1),D.rc("ngIf",!n.loading),D.Db(1),D.rc("nzTotal",n.totalOthersCount),D.Db(2),D.rc("ngIf",n.loading),D.Db(1),D.rc("ngIf",!n.loading),D.Db(1),D.rc("nzTotal",n.totalOthersCount),D.Db(1),D.rc("nzVisible",n.isAddCustomModalVisible),D.Db(1),D.rc("ngModel",n.customInterventionName))},directives:[r.q,hn.d,hn.a,bn.a,se.a,X.b,c.d,c.u,c.x,_e.a,gn.a,r.p,Ne,Re,pe.a,he.a,be.a],pipes:[W.a],styles:[".intervention-list[_ngcontent-%COMP%]{max-height:500px;overflow-y:scroll}.close[_ngcontent-%COMP%]{float:right;cursor:pointer}.spinner[_ngcontent-%COMP%]{text-align:center}"]}),e})();const Gn=[{value:"TABLET",label:"Tablet",children:[{value:"MG",label:"MG",isLeaf:!0}]},{value:"CAPSULE",label:"Capsule",children:[{value:"NO UNITS",label:"No Units",isLeaf:!0}]},{value:"INJECTION",label:"Injection",children:[{value:"CC",label:"CC",isLeaf:!0}]},{value:"SYRUP",label:"Syrup",children:[{value:"TABLESPOON",label:"Tablespoon",isLeaf:!0},{value:"TEASPOON",label:"Teaspoon",isLeaf:!0},{value:"ML",label:"Ml",isLeaf:!0}]},{value:"CREAM",label:"Cream",children:[{value:"NO UNITS",label:"No Units",isLeaf:!0}]},{value:"SPRAY",label:"Spray",children:[{value:"NO UNITS",label:"No Units",isLeaf:!0}]}];var xn=t("jPNr"),Yn=t("OEtX"),Hn=t("Jioy"),jn=t("q0Us"),$n=t("ix5O");const qn=["interventionView"];function Kn(e,n){if(1&e){const e=D.Yb();D.Xb(0,"button",20),D.ec("click",function(){return D.Lc(e),D.ic().showAddGroupModal()}),D.Xc(1),D.jc(2,"translate"),D.Wb()}2&e&&(D.Db(1),D.Yc(D.kc(2,1,"COMMON.ADDGROUP")))}function Jn(e,n){if(1&e){const e=D.Yb();D.Xb(0,"button",20),D.ec("click",function(){return D.Lc(e),D.ic(3).showMedicinesDialog()}),D.Xc(1," Add Medicine "),D.Wb()}}function Zn(e,n){1&e&&D.Sb(0,"nz-empty",25)}function Qn(e,n){if(1&e&&(D.Xb(0,"span"),D.Xc(1),D.jc(2,"date"),D.Wb()),2&e){const e=D.ic().$implicit;D.Db(1),D.Zc(" ",D.lc(2,1,null==e?null:e.toBeTakenTill,"mediumDate")," ")}}function et(e,n){if(1&e){const e=D.Yb();D.Vb(0),D.Xb(1,"nz-tag",27),D.Xc(2),D.Wb(),D.Xb(3,"entity-item",28),D.Xb(4,"entity-item-actions"),D.Vc(5,Qn,3,4,"span",24),D.Xc(6," \xa0\xa0 "),D.Xb(7,"button",29),D.ec("click",function(){D.Lc(e);const t=n.index,i=n.$implicit;return D.ic(4).editMedicine(t,i)}),D.Sb(8,"app-icons",30),D.Wb(),D.Xc(9," \xa0 "),D.Xb(10,"app-icons",31),D.ec("click",function(){D.Lc(e);const t=n.index;return D.ic(4).removeMedicine(t)}),D.Wb(),D.Wb(),D.Wb(),D.Ub()}if(2&e){const e=n.$implicit;D.Db(1),D.rc("nzColor","orange"),D.Db(1),D.Zc("",e.prn?"PRN (As Required)":"Scheduled"," "),D.Db(1),D.rc("title",null==e?null:e.name)("description",null==e?null:e.instruction),D.Db(2),D.rc("ngIf",!(null!=e&&e.prn))}}function nt(e,n){if(1&e&&(D.Vb(0),D.Vc(1,et,11,5,"ng-container",26),D.Ub()),2&e){const e=D.ic(3);D.Db(1),D.rc("ngForOf",e.addedMedicines)}}function tt(e,n){if(1&e&&(D.Xb(0,"entity-manager",22),D.Xb(1,"entity-actions"),D.Vc(2,Jn,2,0,"button",3),D.Wb(),D.Xb(3,"entity-listing"),D.Vc(4,Zn,1,0,"nz-empty",23),D.Vc(5,nt,2,1,"ng-container",24),D.Wb(),D.Wb()),2&e){const e=D.ic(2);D.Db(2),D.rc("ngIf","VIEW"!==e.mode),D.Db(2),D.rc("ngIf",!(null!=e.addedMedicines&&e.addedMedicines.length)),D.Db(1),D.rc("ngIf",null==e.addedMedicines?null:e.addedMedicines.length)}}function it(e,n){if(1&e&&(D.Xb(0,"div",5),D.Vc(1,tt,6,3,"entity-manager",21),D.Wb()),2&e){const e=D.ic();D.Db(1),D.rc("ngIf",null==e.tenantSettings||null==e.tenantSettings.medicineSettings?null:e.tenantSettings.medicineSettings.medicineEnabled)}}function rt(e,n){if(1&e){const e=D.Yb();D.Xb(0,"button",20),D.ec("click",function(){D.Lc(e);const n=D.ic().$implicit;return D.ic().showAddInterventionDialogForGroup(n)}),D.Xc(1),D.jc(2,"translate"),D.Wb()}2&e&&(D.Db(1),D.Yc(D.kc(2,1,"COMMON.ADDINTERVENTION")))}function at(e,n){if(1&e){const e=D.Yb();D.Xb(0,"app-icons",31),D.ec("click",function(){D.Lc(e);const n=D.ic().$implicit;return D.ic().removeGroup(n)}),D.Wb()}}function st(e,n){1&e&&D.Sb(0,"nz-empty",37)}function ct(e,n){if(1&e&&(D.Xb(0,"nz-tag",27),D.Xc(1),D.Wb()),2&e){const e=D.ic().$implicit;D.rc("nzColor","orange"),D.Db(1),D.Zc(" ",e.type," ")}}function ot(e,n){1&e&&(D.Xb(0,"nz-tag",27),D.Xc(1," FORM "),D.Wb()),2&e&&D.rc("nzColor","orange")}function lt(e,n){if(1&e){const e=D.Yb();D.Xb(0,"app-icons",31),D.ec("click",function(){D.Lc(e);const n=D.ic().$implicit,t=D.ic().$implicit;return D.ic().removeIntervention(t,n)}),D.Wb()}}function dt(e,n){if(1&e){const e=D.Yb();D.Xb(0,"div",38),D.ec("click",function(){D.Lc(e);const t=n.$implicit;return D.ic(2).selectIntervention(t)}),D.Vc(1,ct,2,2,"nz-tag",39),D.Vc(2,ot,2,1,"nz-tag",39),D.Xb(3,"entity-item",40),D.Xb(4,"entity-item-actions"),D.Vc(5,lt,1,0,"app-icons",34),D.Wb(),D.Wb(),D.Wb()}if(2&e){const e=n.$implicit,t=D.ic(2);D.Db(1),D.rc("ngIf","FORM"!==e.type&&"WEB_FORM"!==e.type),D.Db(1),D.rc("ngIf","FORM"===e.type||"WEB_FORM"===e.type),D.Db(1),D.rc("title",e.name)("selected",(null==t.selectedInterventionBlueprint?null:t.selectedInterventionBlueprint.id)===e.id),D.Db(2),D.rc("ngIf","VIEW"!==t.mode)}}function ut(e,n){if(1&e&&(D.Xb(0,"div",32),D.Xb(1,"entity-manager",33),D.Xb(2,"entity-actions"),D.Vc(3,rt,3,3,"button",3),D.Xc(4," \xa0\xa0 "),D.Vc(5,at,1,0,"app-icons",34),D.Wb(),D.Xb(6,"entity-listing"),D.Vc(7,st,1,0,"nz-empty",35),D.Vc(8,dt,6,5,"div",36),D.Wb(),D.Wb(),D.Wb()),2&e){const e=n.$implicit,t=D.ic();D.Db(1),D.rc("name",t.getGroupInterventionName(e)),D.Db(2),D.rc("ngIf","VIEW"!==t.mode),D.Db(2),D.rc("ngIf","DEFAULT"!==e),D.Db(2),D.rc("ngIf",null==t.groupInterventionMap.get(e)||0==t.groupInterventionMap.get(e).length),D.Db(1),D.rc("ngForOf",t.groupInterventionMap.get(e))}}function pt(e,n){}function ht(e,n){if(1&e&&(D.Xb(0,"nz-auto-option",46),D.Xc(1),D.Wb()),2&e){const e=n.$implicit;D.rc("nzValue",e),D.Db(1),D.Zc(" ",e.name," ")}}function bt(e,n){if(1&e){const e=D.Yb();D.Xb(0,"div",41),D.Xb(1,"input",42),D.ec("ngModelChange",function(n){return D.Lc(e),D.ic().userSelectedMedicine=n})("input",function(n){return D.Lc(e),D.ic().searchMedicines(null==n.target?null:n.target.value)})("ngModelChange",function(n){return D.Lc(e),D.ic().setMedicine(n)}),D.Wb(),D.Xb(2,"nz-autocomplete",43,44),D.Vc(4,ht,2,2,"nz-auto-option",45),D.Wb(),D.Wb()}if(2&e){const e=D.Ic(3),n=D.ic();D.Db(1),D.rc("ngModel",n.userSelectedMedicine)("nzAutocomplete",e),D.Db(3),D.rc("ngForOf",n.medicines)}}function gt(e,n){if(1&e){const e=D.Yb();D.Xb(0,"div",57),D.Xb(1,"nz-date-picker",58),D.ec("ngModelChange",function(n){return D.Lc(e),D.ic(2).medicineEndDate=n})("ngModelChange",function(n){return D.Lc(e),D.ic(2).onMedicineEndDateChange(n)}),D.Wb(),D.Wb()}if(2&e){const e=D.ic(2);D.Db(1),D.rc("ngModel",e.medicineEndDate)("nzDisabledDate",e.disabledDate)}}function vt(e,n){1&e&&D.Sb(0,"app-icons",59)}function ft(e,n){if(1&e){const e=D.Yb();D.Xb(0,"nz-select",65),D.ec("ngModelChange",function(n){return D.Lc(e),D.ic().$implicit.schedule.repeat.tempType=n}),D.Sb(1,"nz-option",66),D.Sb(2,"nz-option",67),D.Sb(3,"nz-option",68),D.Sb(4,"nz-option",69),D.Sb(5,"nz-option",70),D.Sb(6,"nz-option",71),D.Wb()}if(2&e){const e=D.ic().$implicit;D.rc("ngModel",e.schedule.repeat.tempType)}}function mt(e,n){if(1&e){const e=D.Yb();D.Xb(0,"nz-select",72),D.ec("ngModelChange",function(n){return D.Lc(e),D.ic().$implicit.quantity=n}),D.Sb(1,"nz-option",73),D.Sb(2,"nz-option",74),D.Sb(3,"nz-option",75),D.Wb()}if(2&e){const e=D.ic().$implicit;D.rc("ngModel",e.quantity)}}function It(e,n){if(1&e){const e=D.Yb();D.Xb(0,"input",76),D.ec("change",function(){D.Lc(e);const n=D.ic().$implicit;return D.ic(2).isDosageValid(n.quantity)})("ngModelChange",function(n){return D.Lc(e),D.ic().$implicit.quantity=n}),D.Wb()}if(2&e){const e=D.ic().$implicit;D.rc("ngModel",e.quantity)}}function Ct(e,n){if(1&e){const e=D.Yb();D.Vb(0),D.Xb(1,"nz-time-picker",77),D.ec("ngModelChange",function(n){return D.Lc(e),D.ic().$implicit.schedule.tempOccuranceStartTime=n})("ngModelChange",function(){D.Lc(e);const n=D.ic().$implicit;return D.ic(2).onMedicineTimeChange(n,"START")}),D.jc(2,"translate"),D.Wb(),D.Ub()}if(2&e){const e=D.ic().$implicit;D.Db(1),D.sc("nzPlaceHolder",D.kc(2,2,"TABLEHEADER.STARTTIME")),D.rc("ngModel",e.schedule.tempOccuranceStartTime)}}function Mt(e,n){if(1&e){const e=D.Yb();D.Xb(0,"button",51),D.ec("click",function(){D.Lc(e);const n=D.ic().index;return D.ic(2).removeDose(n)}),D.Sb(1,"app-icons",78),D.Wb()}}function Dt(e,n){if(1&e&&(D.Xb(0,"div",79),D.Xb(1,"strong"),D.Xc(2),D.Wb(),D.Wb()),2&e){const e=D.ic().$implicit,n=D.ic(2);D.Db(2),D.Yc(n.getSummaryForSchedule(e))}}function Tt(e,n){if(1&e&&(D.Xb(0,"div"),D.Xb(1,"div",57),D.Vc(2,ft,7,1,"nz-select",60),D.Wb(),D.Vc(3,mt,4,1,"nz-select",61),D.Vc(4,It,1,1,"input",62),D.Vc(5,Ct,3,4,"ng-container",24),D.Vc(6,Mt,2,0,"button",63),D.Vc(7,Dt,3,1,"div",64),D.Sb(8,"nz-divider"),D.Wb()),2&e){const e=n.index,t=D.ic(2);D.Db(2),D.rc("ngIf",!1===t.userMedicineToBeAdded.prn),D.Db(1),D.rc("ngIf","CREAM"==t.selectedMedicineType||"SPRAY"==t.selectedMedicineType),D.Db(1),D.rc("ngIf",!("CREAM"==t.selectedMedicineType||"SPRAY"==t.selectedMedicineType)),D.Db(1),D.rc("ngIf",!1===t.userMedicineToBeAdded.prn),D.Db(1),D.rc("ngIf",e>0),D.Db(1),D.rc("ngIf",!1===t.userMedicineToBeAdded.prn)}}function Et(e,n){if(1&e){const e=D.Yb();D.Xb(0,"div",41),D.Xb(1,"div",47),D.Xb(2,"nz-radio-group",48),D.ec("ngModelChange",function(n){return D.Lc(e),D.ic().userMedicineToBeAdded.prn=n}),D.Xb(3,"label",49),D.Xc(4,"As Scheduled"),D.Wb(),D.Xb(5,"label",49),D.Xc(6,"PRN (As Needed)"),D.Wb(),D.Wb(),D.Wb(),D.Xb(7,"nz-cascader",50),D.ec("ngModelChange",function(n){return D.Lc(e),D.ic().selectedMedicineOption=n})("ngModelChange",function(n){return D.Lc(e),D.ic().onMedicineOptionChange(n)}),D.Wb(),D.Xb(8,"button",51),D.ec("click",function(){return D.Lc(e),D.ic().addNewDose()}),D.Sb(9,"app-icons",52),D.Wb(),D.Vc(10,gt,2,2,"div",53),D.Xb(11,"nz-input-group",54),D.Xb(12,"input",55),D.ec("ngModelChange",function(n){return D.Lc(e),D.ic().userMedicineToBeAdded.instruction=n}),D.Wb(),D.Wb(),D.Vc(13,vt,1,0,"ng-template",null,56,D.Wc),D.Vc(15,Tt,9,6,"div",26),D.Wb()}if(2&e){const e=D.Ic(14),n=D.ic();D.Db(2),D.rc("ngModel",n.userMedicineToBeAdded.prn)("nzButtonStyle","solid"),D.Db(1),D.rc("nzValue",!1),D.Db(2),D.rc("nzValue",!0),D.Db(2),D.rc("nzOptions",n.medicineOptions)("ngModel",n.selectedMedicineOption),D.Db(3),D.rc("ngIf",!1===n.userMedicineToBeAdded.prn),D.Db(1),D.rc("nzSuffix",e),D.Db(1),D.rc("ngModel",n.userMedicineToBeAdded.instruction),D.Db(3),D.rc("ngForOf",n.userMedicineToBeAdded.dosages)}}function St(e,n){if(1&e){const e=D.Yb();D.Xb(0,"button",80),D.ec("click",function(){return D.Lc(e),D.ic().pre()}),D.Xb(1,"span"),D.Xc(2,"Previous"),D.Wb(),D.Wb()}}function Ot(e,n){if(1&e){const e=D.Yb();D.Xb(0,"button",81),D.ec("click",function(){return D.Lc(e),D.ic().next()}),D.Xb(1,"span"),D.Xc(2,"Next"),D.Wb(),D.Wb()}if(2&e){const e=D.ic();D.rc("disabled",!(null!=e.selectedMedicine&&e.selectedMedicine.name))}}function yt(e,n){if(1&e){const e=D.Yb();D.Xb(0,"button",20),D.ec("click",function(){return D.Lc(e),D.ic().done()}),D.Xb(1,"span"),D.Xc(2,"Done"),D.Wb(),D.Wb()}}let At=(()=>{class e{constructor(e,n,t,i,r,a,s){this.factoryResolver=e,this._modalService=n,this._notificationsService=t,this.courseService=i,this.dataSharingService=r,this._groupInterventionsValidator=a,this._careplanEventLogger=s,this.isAddGroupModalVisible=!1,this.isMedicineDialogVisible=!1,this.medicineDialogContent="SEARCH",this.medicineDialogIndex=0,this.selectedMedicineOption=null,this.medicineOptions=Gn,this.selectedMedicineType="",this.emitUserMedicine=new D.n,this.emitRemovedUserMedicine=new D.n,this.disabledDate=e=>Object(re.a)(new Date,e)>0}ngOnInit(){void 0===this.careplanBlueprintDTO&&(this.careplanBlueprintDTO=new g),this.dataSharingService.tenantSettings.subscribe(e=>{this.tenantSettings=e})}appendToInterventionBlueprintGroup(e,n){let t=this.groupInterventionMap.get(e);void 0===t&&(t=[]),t.push(n),this.groupInterventionMap.set(e,t)}selectIntervention(e){this.selectedInterventionBlueprint=e,null==this.selectedInterventionBlueprint.paramName&&(this.selectedInterventionBlueprint.paramName=new Q);const n=this.factoryResolver.resolveComponentFactory(tn);this.viewContainerRef.clear();const t=this.viewContainerRef.createComponent(n);t.instance.interventionBlueprint=e,t.instance.careplanType=this.course.type}showAddInterventionDialogForGroup(e){this.course.type?this._modalService.create({nzContent:Fn,nzComponentParams:{interventionGroupId:e},nzWidth:600,nzCloseIcon:null}).componentInstance.interventionsAdded.subscribe(n=>{const t=JSON.parse(JSON.stringify(n));if("REMOTE_PATIENT_MONITORING"===this.course.type&&(t.permissions="464"),"DEFAULT"===e)this.appendToInterventionBlueprintGroup("DEFAULT",t);else{e&&10<e.length&&(t.parentId=e);let n=this.groupInterventionMap.get(e);if(null==n&&(n=[]),!this._groupInterventionsValidator.validateCapabilities(n,t))return;if(!this._groupInterventionsValidator.validateUniqueness(n,t))return;n.push(t)}this._notificationsService.success("Intervention Added","The selected intervention has been added.")}):this._notificationsService.error("Validation Error","Please Select Careplan Type First Before Proceeding!!")}removeGroup(e){var n;let t;this._careplanEventLogger.episodeCareplanActionEvent("",this.patientId,null===(n=this.course)||void 0===n?void 0:n.id,"careplan_remove_intervention_group"),this.groupInterventionMap.get(e).forEach(e=>{this.addToDeletedInterventions(e)}),this.groupInterventionMap.delete(e),this.interventionGroupIds.splice(this.interventionGroupIds.indexOf(e),1),this.groupInterventions.forEach(n=>{n.id===e&&(t=n)});const i=this.groupInterventions.splice(this.groupInterventions.indexOf(t),1);this.addToDeletedInterventions(i[0])}removeIntervention(e,n){var t;this._careplanEventLogger.episodeCareplanActionEvent("",this.patientId,null===(t=this.course)||void 0===t?void 0:t.id,"careplan_remove_intervention"),null!=this.selectedInterventionBlueprint&&this.selectedInterventionBlueprint.id===n.id&&(this.selectedInterventionBlueprint=null,this.viewContainerRef.clear());let i=this.groupInterventionMap.get(e);i=i.filter(e=>e.id!==n.id),this.groupInterventionMap.set(e,i),this.addToDeletedInterventions(n)}addToDeletedInterventions(e){"ADD"!==this.mode&&(this.careplanBlueprintDTO.deletedInterventions||(this.careplanBlueprintDTO.deletedInterventions=[]),e.id.length>15&&this.careplanBlueprintDTO.deletedInterventions.push(e.id))}getGroupInterventionName(e){if("DEFAULT"===e)return"Ungrouped";const n=this.groupInterventions.find(n=>n.id===e);return n?n.name:"Ungrouped"}showAddGroupModal(){this.groupName="",this.isAddGroupModalVisible=!0}closeAddGroupModal(){this.isAddGroupModalVisible=!1}addGroup(){var e;this._careplanEventLogger.episodeCareplanActionEvent("",this.patientId,null===(e=this.course)||void 0===e?void 0:e.id,"careplan_add_intervention_group"),this.groupName.trim()||(this.groupName="NEW GROUP"),this.isAddGroupModalVisible=!1;const n=new Z;n.type="GROUP",n.id="_"+Math.random().toString(36).substr(2,9),n.name=this.groupName,this.groupInterventions.push(n),this.interventionGroupIds.push(n.id),this.groupInterventionMap.set(n.id,[])}showMedicinesDialog(){this.userSelectedMedicine=null,this.isMedicineDialogVisible=!0}closeMedicinesDialog(){this.isMedicineDialogVisible=!1,this.userMedicineToBeAdded=null,this.selectedMedicine=null,this.medicineDialogContent="SEARCH",this.medicineDialogIndex=0,this.selectedMedicineOption=null,this.medicineEndDate=null,this.medicines=[],this.isEditingMedicine=!1,this.keyOfMedicineBeingEdited=null,this.medicineEndDate=null}pre(){this.medicineDialogIndex-=1,this.changeContent("SEARCH")}next(){this.medicineDialogIndex+=1,this.changeContent("SCHEDULE"),this.initializeNewMedicineObject()}done(){var e;this.validateUserMedicine()&&(this.userMedicineToBeAdded.prn&&this.userMedicineToBeAdded.dosages.forEach(e=>{delete e.schedule}),this._careplanEventLogger.episodeCareplanActionEvent("",this.patientId,null===(e=this.course)||void 0===e?void 0:e.id,"careplan_add_medicine"),this.addedMedicines||(this.addedMedicines=[]),this.isEditingMedicine?this.addedMedicines[this.keyOfMedicineBeingEdited]=this.userMedicineToBeAdded:this.addedMedicines.push(this.userMedicineToBeAdded),this.emitUserMedicine.emit(this.addedMedicines),this.closeMedicinesDialog())}validateUserMedicine(){let e=!0,n=!0,t="";return this.userMedicineToBeAdded.dosages.forEach(n=>{n.type&&n.unit||(t+="Medicine Type/Unit "),n.quantity||(t+="Medicine Quantity "),this.userMedicineToBeAdded.prn||(n.schedule.repeat.tempType||(t+="Medicine Recurrence "),n.schedule.occuranceStartTime||(t+="Medicine Start-Time ")),this.isDosageValid(n.quantity)||(e=!1),this.isDosageValid(n.quantity)||(e=!1)}),this.userMedicineToBeAdded.prn||this.userMedicineToBeAdded.toBeTakenTill||(t+="Medicine End-Date "),t.length&&(t+="Cannot Be Empty!",this._notificationsService.create("error","Validation Error!",t),n=!1),e||(this._notificationsService.create("error","Validation Error!","Dosage quantity should be a number!"),n=!1),n}changeContent(e){this.medicineDialogContent=e}initializeNewMedicineObject(){this.userMedicineToBeAdded=new $,this.course.id&&(this.userMedicineToBeAdded.careplanId=this.course.id),this.userMedicineToBeAdded.name=this.selectedMedicine.name,this.userMedicineToBeAdded.medicineId=this.selectedMedicine.id,this.userMedicineToBeAdded.prn=!1,this.userMedicineToBeAdded.addedOn=(new Date).getTime(),this.userMedicineToBeAdded.dosages=[],this.addNewDose(),this.userMedicineToBeAdded.assignerId=localStorage.getItem("loggedInUser"),this.userMedicineToBeAdded.tenantId=localStorage.getItem("loggedInTenant"),this.userMedicineToBeAdded.userId=this.patientId}addNewDose(){const e=new q;this.userMedicineToBeAdded.dosages.length&&this.userMedicineToBeAdded.dosages[0].type&&(e.type=this.userMedicineToBeAdded.dosages[0].type,e.unit=this.userMedicineToBeAdded.dosages[0].unit),e.schedule=new K,e.schedule.repeat=new J,e.schedule.repeat.type="DAILY",e.schedule.repeat.occuranceType="ON_DATE",e.schedule.startDate=(new Date).getTime(),e.schedule.endDate=this.userMedicineToBeAdded.toBeTakenTill,this.userMedicineToBeAdded.dosages.push(e)}removeDose(e){this.userMedicineToBeAdded.dosages.splice(e,1)}searchMedicines(e){e.length<3||this.courseService.searchMedicines(e).subscribe(e=>{this.medicines=e})}setMedicine(e){this.userSelectedMedicine=e.name,this.selectedMedicine=e}onMedicineOptionChange(e){const n=new Array;this.userMedicineToBeAdded.dosages.forEach(e=>{e.quantity=null,n.push(e)}),this.userMedicineToBeAdded.dosages=n,this.userMedicineToBeAdded.dosages.forEach(e=>{e.type=this.selectedMedicineOption[0],e.unit=this.selectedMedicineOption[1]}),this.selectedMedicineType=this.selectedMedicineOption[0]}onMedicineEndDateChange(e){this.userMedicineToBeAdded.toBeTakenTill=new Date(e).getTime(),this.userMedicineToBeAdded.prn||this.userMedicineToBeAdded.dosages.forEach(e=>{e.schedule.startDate=Date.now(),e.schedule.endDate=this.userMedicineToBeAdded.toBeTakenTill})}onMedicineTimeChange(e,n){if("START"===n&&e.schedule.tempOccuranceStartTime){const n=new Date(e.schedule.tempOccuranceStartTime);e.schedule.occuranceStartTime=n.getHours()+":"+n.getMinutes()}else if("END"===n&&e.schedule.tempOccuranceEndTime){const n=new Date(e.schedule.tempOccuranceEndTime);e.schedule.occuranceEndTime=n.getHours()+":"+n.getMinutes()}}getSummaryForSchedule(e){if(!(e.quantity&&e.unit&&e.type&&e.schedule.repeat.tempType&&e.schedule.occuranceStartTime))return;let n="";return n=(e.quantity||"")+" "+("NO UNITS"===e.unit?"":e.unit)+" "+(e.type||"")+", Every "+(e.schedule.repeat.tempType||"")+", At "+(e.schedule.occuranceStartTime||""),e.schedule.repeat.summary=n,e.schedule.repeat.occurances=this.userMedicineToBeAdded.dosages.length,e.schedule.repeat.frequency="Day"===e.schedule.repeat.tempType?1:parseInt(e.schedule.repeat.tempType.charAt(0)),n}editMedicine(e,n){var t;this._careplanEventLogger.episodeCareplanActionEvent("",this.patientId,null===(t=this.course)||void 0===t?void 0:t.id,"careplan_edit_medicine"),this.isEditingMedicine=!0,this.keyOfMedicineBeingEdited=e,this.userSelectedMedicine=n.name,n.toBeTakenTill&&(this.medicineEndDate=new Date(n.toBeTakenTill));const i=new Array;i.push(n.dosages[0].type),i.push(n.dosages[0].unit),this.selectedMedicineOption=i,this.userMedicineToBeAdded=n,this.medicineDialogIndex+=1,this.changeContent("SCHEDULE"),this.isMedicineDialogVisible=!0}removeMedicine(e){var n;this._careplanEventLogger.episodeCareplanActionEvent("",this.patientId,null===(n=this.course)||void 0===n?void 0:n.id,"careplan_remove_medicine"),this.addedMedicines[e].id&&this.emitRemovedUserMedicine.emit(this.addedMedicines[e].id),this.addedMedicines.splice(e,1)}isDosageValid(e){return"CREAM"==this.selectedMedicineType||"SPRAY"==this.selectedMedicineType?isNaN(e):!isNaN(Number(e))}}return e.\u0275fac=function(n){return new(n||e)(D.Rb(D.j),D.Rb(se.f),D.Rb(T.b),D.Rb(cn.a),D.Rb(I.a),D.Rb(Y),D.Rb(pn.a))},e.\u0275cmp=D.Lb({type:e,selectors:[["app-interventions-composer"]],viewQuery:function(e,n){if(1&e&&D.ed(qn,1,D.R),2&e){let e;D.Hc(e=D.fc())&&(n.viewContainerRef=e.first)}},inputs:{mode:"mode",course:"course",interventionGroupIds:"interventionGroupIds",groupInterventions:"groupInterventions",careplanBlueprintDTO:"careplanBlueprintDTO",interventionBluprints:"interventionBluprints",groupInterventionMap:"groupInterventionMap",selectedInterventionBlueprint:"selectedInterventionBlueprint",patientId:"patientId",addedMedicines:["medicinesAssigned","addedMedicines"]},outputs:{emitUserMedicine:"emitUserMedicine",emitRemovedUserMedicine:"emitRemovedUserMedicine"},decls:30,vars:17,consts:[[1,"composer-container"],[1,"interventions-container"],[1,"sub-headers"],["nz-button","","nzType","primary",3,"click",4,"ngIf"],["class","interventions-list",4,"ngIf"],[1,"interventions-list"],["class","intervention-group",4,"ngFor","ngForOf"],[1,"intervention-settings-container"],[1,"intervention-settings"],["interventionView",""],["nzTitle","Please Enter New Group Name",3,"nzVisible","nzVisibleChange","nzOnOk","nzOnCancel"],["nz-input","","placeholder","New Group Name",3,"ngModel","ngModelChange"],["nzTitle","Medicines",3,"nzVisible","nzFooter","nzVisibleChange","nzOnCancel"],[3,"nzCurrent"],["nzTitle","Select Medicine"],["nzTitle","Dosage & Schedule"],["class","steps-content",4,"ngIf"],[1,"steps-action"],["nz-button","","nzType","default",3,"click",4,"ngIf"],["nz-button","","nzType","default",3,"disabled","click",4,"ngIf"],["nz-button","","nzType","primary",3,"click"],["name","Medicines",4,"ngIf"],["name","Medicines"],["nzNotFoundContent","No Medicines",4,"ngIf"],[4,"ngIf"],["nzNotFoundContent","No Medicines"],[4,"ngFor","ngForOf"],[1,"course-type",3,"nzColor"],[3,"title","description"],["nz-button","","nzType","warn","nzShape","circle",3,"click"],["name","edit"],["name","delete",3,"click"],[1,"intervention-group"],[3,"name"],["name","delete",3,"click",4,"ngIf"],["nzNotFoundContent","No Interventions",4,"ngIf"],[3,"click",4,"ngFor","ngForOf"],["nzNotFoundContent","No Interventions"],[3,"click"],["class","course-type",3,"nzColor",4,"ngIf"],[3,"title","description","selected"],[1,"steps-content"],["placeholder","Search Medicine","nz-input","",3,"ngModel","nzAutocomplete","ngModelChange","input"],["nzBackfill","false"],["auto",""],[3,"nzValue",4,"ngFor","ngForOf"],[3,"nzValue"],[2,"margin","auto","width","fit-content"],[3,"ngModel","nzButtonStyle","ngModelChange"],["nz-radio-button","",3,"nzValue"],[2,"margin-top","5%","width","50%",3,"nzOptions","ngModel","ngModelChange"],["nz-button","","nzType","default","nzShape","circle",2,"margin-left","2%",3,"click"],["name","plus"],["style","margin-top: 5%;",4,"ngIf"],[2,"margin-top","5%",3,"nzSuffix"],["type","text","nz-input","","placeholder","Instructions",3,"ngModel","ngModelChange"],["suffixIconInstruction",""],[2,"margin-top","5%"],["nzFormat","mediumDate","nzPlaceHolder","To Be Taken Till",3,"ngModel","nzDisabledDate","ngModelChange"],["name","infoCircle"],["style","width: 35%;","nzPlaceHolder","Recurrence",3,"ngModel","ngModelChange",4,"ngIf"],["style","margin-top: 5%; width: 35%;","nzPlaceHolder","Dosage Quantity",3,"ngModel","ngModelChange",4,"ngIf"],["style","margin-top: 5%; width: 35%;","nz-input","","placeholder","Dosage Quantity",3,"ngModel","change","ngModelChange",4,"ngIf"],["style","margin-left: 2%;","nz-button","","nzType","default","nzShape","circle",3,"click",4,"ngIf"],["style","margin-top: 5%; text-align: center;",4,"ngIf"],["nzPlaceHolder","Recurrence",2,"width","35%",3,"ngModel","ngModelChange"],["nzValue","Day","nzLabel","Daily"],["nzValue","2 Days","nzLabel","Every 2 Days"],["nzValue","3 Days","nzLabel","Every 3 Days"],["nzValue","4 Days","nzLabel","Every 4 Days"],["nzValue","5 Days","nzLabel","Every 5 Days"],["nzValue","6 Days","nzLabel","Every 6 Days"],["nzPlaceHolder","Dosage Quantity",2,"margin-top","5%","width","35%",3,"ngModel","ngModelChange"],["nzValue","A small amount","nzLabel","A small amount"],["nzValue","A moderate amount","nzLabel","A moderate amount"],["nzValue","A heavy amount","nzLabel","A heavy amount"],["nz-input","","placeholder","Dosage Quantity",2,"margin-top","5%","width","35%",3,"ngModel","change","ngModelChange"],["nzFormat","HH:mm",2,"width","25%","; margin-left","1%",3,"nzPlaceHolder","ngModel","ngModelChange"],["name","minus"],[2,"margin-top","5%","text-align","center"],["nz-button","","nzType","default",3,"click"],["nz-button","","nzType","default",3,"disabled","click"]],template:function(e,n){1&e&&(D.Xb(0,"div",0),D.Xb(1,"div",1),D.Xb(2,"nz-page-header",2),D.Xb(3,"nz-page-header-title"),D.Xc(4),D.jc(5,"translate"),D.Wb(),D.Xb(6,"nz-page-header-extra"),D.Vc(7,Kn,3,3,"button",3),D.Wb(),D.Wb(),D.Vc(8,it,2,1,"div",4),D.Xb(9,"div",5),D.Vc(10,ut,9,5,"div",6),D.Wb(),D.Wb(),D.Xb(11,"div",7),D.Xb(12,"nz-page-header",2),D.Xb(13,"nz-page-header-title"),D.Xc(14),D.Wb(),D.Wb(),D.Xb(15,"div",8),D.Vc(16,pt,0,0,"ng-template",null,9,D.Wc),D.Wb(),D.Wb(),D.Wb(),D.Xb(18,"nz-modal",10),D.ec("nzVisibleChange",function(e){return n.isAddGroupModalVisible=e})("nzOnOk",function(){return n.addGroup()})("nzOnCancel",function(){return n.closeAddGroupModal()}),D.Xb(19,"input",11),D.ec("ngModelChange",function(e){return n.groupName=e}),D.Wb(),D.Wb(),D.Xb(20,"nz-modal",12),D.ec("nzVisibleChange",function(e){return n.isMedicineDialogVisible=e})("nzOnCancel",function(){return n.closeMedicinesDialog()}),D.Xb(21,"nz-steps",13),D.Sb(22,"nz-step",14),D.Sb(23,"nz-step",15),D.Wb(),D.Vc(24,bt,5,3,"div",16),D.Vc(25,Et,16,10,"div",16),D.Xb(26,"div",17),D.Vc(27,St,3,0,"button",18),D.Vc(28,Ot,3,1,"button",19),D.Vc(29,yt,3,0,"button",3),D.Wb(),D.Wb()),2&e&&(D.Db(4),D.Yc(D.kc(5,15,"COMMON.INTERVENTION")),D.Db(3),D.rc("ngIf","VIEW"!==n.mode),D.Db(1),D.rc("ngIf","ASSIGN"===n.mode||"EPISODE"===n.mode),D.Db(2),D.rc("ngForOf",n.interventionGroupIds),D.Db(4),D.Yc((null==n.selectedInterventionBlueprint?null:n.selectedInterventionBlueprint.name)||" "),D.Db(4),D.rc("nzVisible",n.isAddGroupModalVisible),D.Db(1),D.rc("ngModel",n.groupName),D.Db(1),D.rc("nzVisible",n.isMedicineDialogVisible)("nzFooter",null),D.Db(1),D.rc("nzCurrent",n.medicineDialogIndex),D.Db(3),D.rc("ngIf","SEARCH"===n.medicineDialogContent),D.Db(1),D.rc("ngIf","SCHEDULE"===n.medicineDialogContent),D.Db(2),D.rc("ngIf",n.medicineDialogIndex>0&&!n.isEditingMedicine),D.Db(1),D.rc("ngIf",n.medicineDialogIndex<1),D.Db(1),D.rc("ngIf",1===n.medicineDialogIndex))},directives:[xn.b,xn.g,xn.d,r.q,r.p,se.a,X.b,c.d,c.u,c.x,Yn.b,Yn.a,pe.a,he.a,be.a,Te,Se,ye,Ae.b,je.a,Ne,Re,_e.a,Hn.d,Hn.a,Hn.c,de.c,de.b,de.a,jn.a,X.c,X.d,le.a,ge.a,k.d,k.a,$n.a],pipes:[W.a,r.e],styles:[".composer-container[_ngcontent-%COMP%]{display:grid;width:100%;grid-template-columns:repeat(2,1fr);grid-template-rows:repeat(1,1fr);background-color:var(--neutral-color)}.steps-indicator-container[_ngcontent-%COMP%]{padding:20px;grid-column:1/3;grid-row:1}.interventions-container[_ngcontent-%COMP%]{grid-column:1;min-height:75vh;grid-row:2;background-color:var(--neutral-color);border-right:thin solid #ddd}.sub-headers[_ngcontent-%COMP%]{background:var(--neutral-color-dark);min-height:9.5vh}.interventions-list[_ngcontent-%COMP%]{padding:20px}.intervention-settings-container[_ngcontent-%COMP%]{grid-column:2;grid-row:2;background-color:var(--neutral-color)}.intervention-settings[_ngcontent-%COMP%]{padding:20px}.course-type[_ngcontent-%COMP%]{margin:10px 0 10px 20px}.steps-action[_ngcontent-%COMP%]{margin-top:5%}.steps-action[_ngcontent-%COMP%] > button[_ngcontent-%COMP%]{margin-right:1%}.steps-content[_ngcontent-%COMP%]{margin-top:5%}.spacer[_ngcontent-%COMP%]{flex:1 1 auto}"]}),e})();const zt=function(){return[16,48]};function Xt(e,n){if(1&e){const e=D.Yb();D.Xb(0,"div",3),D.Xb(1,"div",4),D.Xb(2,"sub-tenant-select",5),D.ec("onSubTenantSelected",function(n){return D.Lc(e),D.ic().onSubTenantChange(n)}),D.Wb(),D.Wb(),D.Wb()}if(2&e){const e=D.ic();D.rc("nzGutter",D.xc(4,zt)),D.Db(2),D.rc("selectedSubTenant",e.subTenantId)("showError",e.showSubTenantToggleError)("disabled","ADD"!=e.mode)}}function kt(e,n){if(1&e){const e=D.Yb();D.Vb(0),D.Xb(1,"app-careplan-header",6),D.ec("courseChange",function(n){return D.Lc(e),D.ic().course=n})("generalEnabledChange",function(n){return D.Lc(e),D.ic().generalEnabled=n})("rpmEnabledChange",function(n){return D.Lc(e),D.ic().rpmEnabled=n})("riEnabledChange",function(n){return D.Lc(e),D.ic().riEnabled=n})("ccmEnabledChange",function(n){return D.Lc(e),D.ic().ccmEnabled=n}),D.Wb(),D.Xb(2,"app-interventions-composer",7),D.ec("modeChange",function(n){return D.Lc(e),D.ic().mode=n})("interventionBluprintsChange",function(n){return D.Lc(e),D.ic().interventionBluprints=n})("groupInterventionsChange",function(n){return D.Lc(e),D.ic().groupInterventions=n})("groupInterventionMapChange",function(n){return D.Lc(e),D.ic().groupInterventionMap=n})("selectedInterventionBlueprintChange",function(n){return D.Lc(e),D.ic().selectedInterventionBlueprint=n})("interventionGroupIdsChange",function(n){return D.Lc(e),D.ic().interventionGroupIds=n})("courseChange",function(n){return D.Lc(e),D.ic().course=n})("careplanBlueprintDTOChange",function(n){return D.Lc(e),D.ic().careplanBlueprintDTO=n}),D.Wb(),D.Ub()}if(2&e){const e=D.ic();D.Db(1),D.rc("course",e.course)("generalEnabled",e.generalEnabled)("rpmEnabled",e.rpmEnabled)("riEnabled",e.riEnabled)("ccmEnabled",e.ccmEnabled)("isEditDisabled","VIEW"===e.mode)("validationErrors",e.validationErrors)("autoCompleteTags",e.autoCompleteTags),D.Db(1),D.rc("mode",e.mode)("interventionBluprints",e.interventionBluprints)("groupInterventions",e.groupInterventions)("groupInterventionMap",e.groupInterventionMap)("selectedInterventionBlueprint",e.selectedInterventionBlueprint)("interventionGroupIds",e.interventionGroupIds)("course",e.course)("careplanBlueprintDTO",e.careplanBlueprintDTO)}}let Nt=(()=>{class e extends h.a{constructor(e,n,t,i,r,a){super(),this._notificationsService=e,this._location=n,this._tagsService=t,this._dataSharingService=i,this._careplansService=r,this._activatedRoute=a,this.mode="ADD",this.interventionBluprints=[],this.groupInterventions=[],this.groupInterventionMap=new Map,this.interventionGroupIds=["DEFAULT"],this.loading=!0,this.course=new f,this.careplanBlueprintDTO=new g,this.caretakerAssignmentDTO=new b,this.generalEnabled=!1,this.rpmEnabled=!1,this.riEnabled=!1,this.ccmEnabled=!1,this.validationErrors=[],this.showSubTenantToggleError=!1,this.autoCompleteTags=new Array}init(){var e,n;if(null!=this.tenantSettings&&null!=this.tenantSettings.episodeBlueprints&&this.tenantSettings.episodeBlueprints.length>0){const e=this.tenantSettings.episodeBlueprints.filter(e=>null!=e&&!e.archived&&"RPM"==e.type);this.rpmEnabled=e.length>0;const n=this.tenantSettings.episodeBlueprints.filter(e=>null!=e&&!e.archived&&"HEALTH_SCORE"==e.type);this.riEnabled=n.length>0;const t=this.tenantSettings.episodeBlueprints.filter(e=>null!=e&&!e.archived&&"CCM"==e.type);this.ccmEnabled=t.length>0;const i=this.tenantSettings.episodeBlueprints.filter(e=>null!=e&&!e.archived&&"GENERAL"==e.type);this.generalEnabled=i.length>0||!this.tenantSettings.episodeBlueprints.length}(null===(n=null===(e=this.tenantSettings)||void 0===e?void 0:e.episodeBlueprints)||void 0===n?void 0:n.length)||(this.generalEnabled=!0)}ngOnInit(){this.loadingNewTenant=!0,this._activatedRoute.params.forEach(e=>{this.mode=e.mode.toUpperCase(),this.careplanBlueprintId=e.id}),this._dataSharingService.assignedTenantSettings.pipe(Object(p.a)(this.unsubscribed)).subscribe(e=>{this.tenantConfigMap=e,this.tenantConfigMap.forEach((e,n)=>{this.subTenantId=n}),this.onSubTenantChange(this.subTenantId),this.loadingNewTenant=!1}),this.careplanBlueprintId&&(this.getCareplanTemplateById(this.careplanBlueprintId),this.getInterventions(this.careplanBlueprintId)),this.init()}onSubTenantChange(e){this.loadingNewTenant=!0,e&&(localStorage.setItem(M.a.REQUEST_TENANT_IDS,e),this.showSubTenantToggleError=!1,this.subTenantId=e,this.tenantSettings=this.tenantConfigMap.get(this.subTenantId),console.log("HERE"),this.getAllTagsForDropdown(),this.init()),this.loadingNewTenant=!1}getAllTagsForDropdown(){this.autoCompleteTags=new Array,this._tagsService.getALLTags("PATIENT,CARE_TAKER,SURVEY,FORM").subscribe(e=>{e.forEach(e=>{this.autoCompleteTags.push(e.name)})})}getCareplanTemplateById(e){this._careplansService.getCourseById(e).subscribe(e=>{this.course=e,this.onSubTenantChange(this.course.tenantId),"CLONE"===this.mode&&(this.clonedCareplanName=this.course.name)})}getInterventions(e){this._careplansService.getInterventionBlueprintPerCarePlan(e).subscribe(e=>{this.interventionBluprints=e,this.groupInterventions=this.interventionBluprints.filter(e=>"GROUP"===e.type);for(const n of this.interventionBluprints)"GROUP"!==n.type&&this.appendToInterventionBlueprintGroup(null==n.parentId?"DEFAULT":n.parentId,n);this.groupInterventionMap.get("DEFAULT")||this.groupInterventionMap.set("DEFAULT",new Array),this.interventionGroupIds=Array.from(this.groupInterventionMap.keys())})}appendToInterventionBlueprintGroup(e,n){let t=this.groupInterventionMap.get(e);void 0===t&&(t=[]),t.push(n),this.groupInterventionMap.set(e,t)}validation(){let e=this._careplansService.validation(this.course,this.mode,null,this.validationErrors);return"CLONE"!==this.mode&&"ADD"!==this.mode||null!=this.subTenantId&&null!=this.subTenantId||(this.showSubTenantToggleError=!0,e=!1),"CLONE"===this.mode?this.clonedCareplanName===this.course.name&&(this._notificationsService.error("Error","Cloned Careplan Template Name Cannot Be Same As The Original One!"),e=!1):"ADD"!==this.mode&&"EDIT"!==this.mode||this.isInterventionsEmpty()&&(this._notificationsService.error("Error","A minimum of one intervention needs to be added to save this template"),e=!1),e}saveCareplan(){if(this.validation())switch(this.mode){case"ADD":this.createNewCareplan();break;case"EDIT":this.updateExistingCareplan();break;case"CLONE":this.cloneCurrentCareplan();break;default:this.goBack()}}isInterventionsEmpty(){return!this.groupInterventionMap||!this.groupInterventionMap.values()||Array.from(this.groupInterventionMap.values()).every(e=>0==(null==e?void 0:e.length))}isValidCareplanBlueprintDTO(e){var n,t,i,r;return e&&((null===(n=e.addedGroupedInterventions)||void 0===n?void 0:n.length)>0||(null===(t=e.addedInterventions)||void 0===t?void 0:t.length)>0||(null===(i=e.groupedInterventions)||void 0===i?void 0:i.length)>0||(null===(r=e.interventions)||void 0===r?void 0:r.length)>0)}createNewCareplan(){localStorage.setItem(M.a.REQUEST_TENANT_IDS,this.subTenantId),this._careplansService.createCourse(this.course).subscribe(e=>{this.createBlueprintDTOForNewCareplan(e.id),this._careplansService.createBulkInterventionsForNewCareplanBlueprint(this.careplanBlueprintDTO).subscribe(()=>{this._notificationsService.success("Success","Careplan Template Created Successfully!"),this.goBack()})}),localStorage.removeItem("carePlanTemplates")}updateExistingCareplan(){this.createBlueprintDTOForNewCareplan(this.careplanBlueprintId),this.createBlueprintDTOForUpdatingCareplan(),this._careplansService.updateCourse(this.course).subscribe(()=>{this._careplansService.updateBulkInterventionsForCareplanBlueprint(this.careplanBlueprintDTO).subscribe(()=>{this._notificationsService.success("Success","Careplan Template Updated Successfully!"),this.goBack()})}),localStorage.removeItem("carePlanTemplates")}cloneCurrentCareplan(){delete this.course.id,this._careplansService.createCourse(this.course).subscribe(e=>{this.createBlueprintDTOForNewCareplan(e.id),this.createBlueprintDTOForCloningCareplan(),this._careplansService.createBulkInterventionsForNewCareplanBlueprint(this.careplanBlueprintDTO).subscribe(()=>{this._notificationsService.success("Success","Careplan Template Created Successfully!"),this.goBack()})}),localStorage.removeItem("carePlanTemplates")}createBlueprintDTOForNewCareplan(e){this.careplanBlueprintDTO.interventions=[],this.careplanBlueprintDTO.groupedInterventions=[],this.groupInterventionMap.get("DEFAULT")&&this.groupInterventionMap.get("DEFAULT").forEach(n=>{const t=Object.assign({},n);t.id.length<=10&&!t.createdOn&&!t.updatedOn&&delete t.id,t.ownerId=e,t.careplanBluprintId=e,t.tenantId=this.subTenantId,"REMOTE_PATIENT_MONITORING"===this.course.type&&(t.reviewResponseEnabled=!0,"666"===t.permissions&&(t.permissions="464")),this.careplanBlueprintDTO.interventions.push(t)}),this.groupInterventions||(this.groupInterventions=[]),this.groupInterventions.forEach(n=>{if("DEFAULT"!==n.id){const t=new v;if(t.interventionBluPrintRequestDTO=Object.assign({},n),t.interventionBluPrintRequestDTO.insideGroupedIntervenions=[],!this.groupInterventionMap.get(n.id))return;this.groupInterventionMap.get(n.id).forEach(n=>{const i=Object.assign({},n);i.id.length<=10&&!i.createdOn&&!i.updatedOn&&delete i.id,i.tenantId=this.subTenantId,i.ownerId=e,i.careplanBluprintId=e,"REMOTE_PATIENT_MONITORING"===this.course.type&&(i.reviewResponseEnabled=!0,"666"===i.permissions&&(i.permissions="464")),t.interventionBluPrintRequestDTO.insideGroupedIntervenions.push(i)}),t.interventionBluPrintRequestDTO.id.length<=10&&!t.interventionBluPrintRequestDTO.updatedOn&&!t.interventionBluPrintRequestDTO.createdOn&&delete t.interventionBluPrintRequestDTO.id,t.interventionBluPrintRequestDTO.ownerId=e,t.interventionBluPrintRequestDTO.careplanBluprintId=e,t.interventionBluPrintRequestDTO.tenantId=this.subTenantId,this.careplanBlueprintDTO.groupedInterventions.push(t)}})}createBlueprintDTOForUpdatingCareplan(){this.careplanBlueprintDTO.addedGroupedInterventions=[],this.careplanBlueprintDTO.addedInterventions=[];const e=[],n=[];this.careplanBlueprintDTO.groupedInterventions.forEach(n=>{!n.interventionBluPrintRequestDTO.id||n.interventionBluPrintRequestDTO.id.length<=10&&!n.interventionBluPrintRequestDTO.createdOn&&!n.interventionBluPrintRequestDTO.updatedOn?this.careplanBlueprintDTO.addedGroupedInterventions.push(n):e.push(n)}),this.careplanBlueprintDTO.groupedInterventions=e,this.careplanBlueprintDTO.interventions.forEach(e=>{!e.id||e.id.length<=10&&!e.createdOn&&!e.updatedOn?this.careplanBlueprintDTO.addedInterventions.push(e):n.push(e)}),this.careplanBlueprintDTO.interventions=n}createBlueprintDTOForCloningCareplan(){this.careplanBlueprintDTO.interventions.forEach(e=>{delete e.id}),this.careplanBlueprintDTO.groupedInterventions.forEach(e=>{delete e.interventionBluPrintRequestDTO.id,e.interventionBluPrintRequestDTO.insideGroupedIntervenions.forEach(e=>{delete e.id})})}goBack(){this._location.back()}}return e.\u0275fac=function(n){return new(n||e)(D.Rb(T.b),D.Rb(r.l),D.Rb(C.a),D.Rb(I.a),D.Rb(m.a),D.Rb(d.a))},e.\u0275cmp=D.Lb({type:e,selectors:[["app-careplan-blueprint-composer"]],features:[D.Ab],decls:5,vars:9,consts:[["title","careplans","subProperty","templates","prefix","Assign",3,"defaultTitle","isSearchEnabled","isActionEnabled","actionTitle","action"],["nz-row","","class","sub-tenant-toggle",3,"nzGutter",4,"isAccessAcrossTenantEnabled"],[4,"ngIf"],["nz-row","",1,"sub-tenant-toggle",3,"nzGutter"],["nz-col","","nzSpan","8","nzOffset","16",2,"margin-top","20px","margin-bottom","20px"],["mode","SINGLE",3,"selectedSubTenant","showError","disabled","onSubTenantSelected"],[3,"course","generalEnabled","rpmEnabled","riEnabled","ccmEnabled","isEditDisabled","validationErrors","autoCompleteTags","courseChange","generalEnabledChange","rpmEnabledChange","riEnabledChange","ccmEnabledChange"],[3,"mode","interventionBluprints","groupInterventions","groupInterventionMap","selectedInterventionBlueprint","interventionGroupIds","course","careplanBlueprintDTO","modeChange","interventionBluprintsChange","groupInterventionsChange","groupInterventionMapChange","selectedInterventionBlueprintChange","interventionGroupIdsChange","courseChange","careplanBlueprintDTOChange"]],template:function(e,n){1&e&&(D.Xb(0,"app-header",0),D.ec("action",function(){return n.saveCareplan()}),D.jc(1,"translate"),D.jc(2,"translate"),D.Wb(),D.Vc(3,Xt,3,5,"div",1),D.Vc(4,kt,3,16,"ng-container",2)),2&e&&(D.sc("defaultTitle",D.kc(1,5,"MENU.TEMPLATE")),D.sc("actionTitle",D.kc(2,7,"COMMON.SAVE")),D.rc("isSearchEnabled",!1)("isActionEnabled","VIEW"!==n.mode),D.Db(4),D.rc("ngIf",!n.loadingNewTenant))},directives:[E.a,S.a,r.q,O.c,O.a,y.a,x,At],pipes:[W.a],styles:["[_nghost-%COMP%]{background-color:var(--neutral-color)}.careplan-details-container[_ngcontent-%COMP%]{padding:20px}.input-size[_ngcontent-%COMP%]{width:90%}.sub-tenant-toggle[_ngcontent-%COMP%]{background:#fff;margin:20px;padding-right:30px}"]}),e})();var Wt=t("cauy"),Rt=t("I2os");let _t=(()=>{class e{}return e.STRINGS=["COMMON.CAREPLAN","CONFIRMATION","CAREPLAN.START_END_DATE_CANT_BE_EMPTY","CAREPLAN.EXISTING_CAREPLAN_SUSPEND_CONFIRMATION","CAREPLAN.SUCCESSFULLY_ASSIGNED","CAREPLAN.SELECT_CARETAKER_ERROR"],e})();var Bt=t("Wfee"),Pt=t("ZPpM");function Lt(e,n){if(1&e){const e=D.Yb();D.Xb(0,"div",10),D.Xb(1,"div",11),D.Xb(2,"nz-date-picker",12),D.ec("ngModelChange",function(n){return D.Lc(e),D.ic().startDate=n}),D.jc(3,"translate"),D.Wb(),D.Wb(),D.Xb(4,"div",11),D.Xb(5,"nz-date-picker",12),D.ec("ngModelChange",function(n){return D.Lc(e),D.ic().endDate=n}),D.jc(6,"translate"),D.Wb(),D.Wb(),D.Wb()}if(2&e){const e=D.ic();D.Db(2),D.sc("nzPlaceHolder",D.kc(3,8,"COMMON.STARTDATE")),D.rc("nzDisabledDate",e.disabledStartDate)("ngModel",e.startDate)("nzAllowClear",!1),D.Db(3),D.sc("nzPlaceHolder",D.kc(6,10,"COMMON.ENDDATE")),D.rc("nzDisabledDate",e.disabledEndDate)("ngModel",e.endDate)("nzAllowClear",!1)}}function wt(e,n){if(1&e){const e=D.Yb();D.Xb(0,"div",10),D.Xb(1,"div",11),D.Xb(2,"nz-date-picker",12),D.ec("ngModelChange",function(n){return D.Lc(e),D.ic().startDate=n}),D.jc(3,"translate"),D.Wb(),D.Wb(),D.Xb(4,"div",11),D.Xb(5,"nz-date-picker",12),D.ec("ngModelChange",function(n){return D.Lc(e),D.ic().endDate=n}),D.jc(6,"translate"),D.Wb(),D.Wb(),D.Wb()}if(2&e){const e=D.ic();D.Db(2),D.sc("nzPlaceHolder",D.kc(3,8,"COMMON.STARTDATE")),D.rc("nzDisabledDate",e.disabledStartDate)("ngModel",e.startDate)("nzAllowClear",!1),D.Db(3),D.sc("nzPlaceHolder",D.kc(6,10,"COMMON.ENDDATE")),D.rc("nzDisabledDate",e.disabledEndDate)("ngModel",e.endDate)("nzAllowClear",!1)}}function Vt(e,n){if(1&e&&(D.Xb(0,"nz-auto-option",13),D.Sb(1,"app-full-name",14),D.Wb()),2&e){const e=n.$implicit;D.rc("nzValue",e),D.Db(1),D.sc("firstName",e.firstName),D.sc("lastName",e.lastName)}}let Ut=(()=>{class e extends h.a{constructor(e,n,t,i,r,a,s,c,o,l){super(),this._location=e,this._userService=n,this._careplansService=t,this._modalService=i,this._datePipe=r,this.translationService=a,this._notificationsService=s,this._careplanEventLogger=c,this._activatedRoute=o,this._dataSharingService=l,this.mode="ASSIGN",this.selectedCaretaker=new Wt.a,this.course=new f,this.interventionGroupIds=["DEFAULT"],this.groupInterventions=[],this.interventionBluprints=[],this.groupInterventionMap=new Map,this.caretakerAssignmentDTO=new b,this.caretakers=[],this.showCaretakerAssigner=!1,this.searchCaretakerInput="",this.today=new Date,this.disabledStartDate=e=>"ASSIGN"==this.mode?Object(re.a)(this.today,e)>0||Object(re.a)(this.endDate,e)<0:Object(re.a)(this.startDate,e)>0||Object(re.a)(this.endDate,e)<0,this.disabledEndDate=e=>"ASSIGN"==this.mode?Object(re.a)(this.today,e)>0||Object(re.a)(this.endDate,e)<0:Object(re.a)(this.startDate,e)>0||Object(re.a)(this.endDate,e)<0}dateParser(e){const n=e.split("-");return new Date(+n[0],+n[1]-1,+n[2])}ngOnInit(){this.translationService.getMultiple(..._t.STRINGS).subscribe(e=>this.translatedStrings=e),this._activatedRoute.params.forEach(e=>{this.patientId=e.patientId,this.tenantId=e.tenantId,this.episodeId=e.episodeId,this.careplanBlueprintId=e.id,this.mode=e.mode.toUpperCase()}),localStorage.setItem(M.a.REQUEST_TENANT_IDS,this.tenantId),this.loggedInUser=localStorage.getItem("loggedInUser"),this._activatedRoute.queryParams.subscribe(e=>{this.startDate=new Date((new Date).setHours(0,0,0,0)),this.endDate=Object(ae.a)(new Date),this.episodeStartDate=e.episodeStartDate,this.episodeEndDate=e.episodeEndDate||this._datePipe.transform(this.endDate,"yyyy-M-dd"),this.episodeName=e.episodeName,this.episodeBlueprintId=e.episodeBlueprintId,this.episodeStartDate&&new Date(new Date(this.episodeStartDate).setHours(0,0,0,0))>=this.startDate&&(this.startDate=this.dateParser(this.episodeStartDate.toString())),this.episodeEndDate&&(this.endDate=this.dateParser(this.episodeEndDate.toString()))}).unsubscribe(),this.careplanBlueprintId&&(this.getCareplanTemplateById(this.careplanBlueprintId),this.getInterventions(this.careplanBlueprintId))}getCareplanTemplateById(e){this._careplansService.getCourseById(e).subscribe(e=>{this.course=e})}getInterventions(e){this._careplansService.getInterventionBlueprintPerCarePlan(e).subscribe(e=>{this.interventionBluprints=e,this.groupInterventions=this.interventionBluprints.filter(e=>"GROUP"===e.type);for(const n of this.interventionBluprints)"GROUP"!==n.type&&this.appendToInterventionBlueprintGroup(null==n.parentId?"DEFAULT":n.parentId,n);this.groupInterventionMap.get("DEFAULT")||this.groupInterventionMap.set("DEFAULT",new Array),this.interventionGroupIds=Array.from(this.groupInterventionMap.keys())})}appendToInterventionBlueprintGroup(e,n){let t=this.groupInterventionMap.get(e);void 0===t&&(t=[]),t.push(n),this.groupInterventionMap.set(e,t)}validator(){return this.startDate&&this.endDate?this._careplansService.validation(this.course,this.mode,this.groupInterventionMap):(this._notificationsService.error(this.translatedStrings.get("COMMON.CAREPLAN"),this.translatedStrings.get("CAREPLAN.START_END_DATE_CANT_BE_EMPTY")),!1)}saveCareplan(){if(this.validator()&&this.initializeCaretakerDTO())switch(this.initializeCareplanAssignmentDTO(),this.mode){case"ASSIGN":this.assignCareplanToPatient();break;case"EPISODE":this.assignCareplanToEpisode();break;default:this.goBack()}}initializeCareplanAssignmentDTO(){this.careplanAssignmentDTO=new Rt.a,this.careplanAssignmentDTO.userMedicines=this.userMedicines,this.careplanAssignmentDTO.interventionBlueprintList=[],this.careplanAssignmentDTO.careplanBlueprint=this.course,this.careplanAssignmentDTO.patientId=this.patientId,this.careplanAssignmentDTO.tenantId=localStorage.getItem("loggedInTenant"),this.careplanAssignmentDTO.type=this.course.type,this.careplanAssignmentDTO.startTime=this.startDate.setHours(0,0,0,0),this.careplanAssignmentDTO.endTime=this.endDate.setHours(23,59,59,999),this.careplanAssignmentDTO.startDate=this._datePipe.transform(this.startDate,"yyyy-MM-dd"),this.careplanAssignmentDTO.endDate=this._datePipe.transform(this.endDate,"yyyy-MM-dd"),this.careplanAssignmentDTO.assignedOn=Date.now(),this.careplanAssignmentDTO.careplanBlueprint.assignerId=this.loggedInUser,this.careplanAssignmentDTO.assignerId=this.loggedInUser,this.careplanAssignmentDTO.episodeId="EPISODE"===this.mode?this.episodeId:null,this.careplanAssignmentDTO.episodeName="EPISODE"===this.mode?this.episodeName:null,this.careplanAssignmentDTO.episodeBlueprintId="EPISODE"===this.mode?this.episodeBlueprintId:null,Array.from(this.groupInterventionMap.keys()).forEach(e=>{this.groupInterventionMap.get(e).forEach(n=>{const t=this.processIntervention(n);t.parentId="DEFAULT"===e?null:e,this.careplanAssignmentDTO.interventionBlueprintList.push(t)})}),this.groupInterventions.forEach(e=>{const n=this.processIntervention(e);this.careplanAssignmentDTO.interventionBlueprintList.push(n)})}processIntervention(e){const n=Object.assign({},e);return"REMOTE_PATIENT_MONITORING"===this.course.type&&(n.reviewResponseEnabled=!0,"666"===n.permissions&&(n.permissions="464")),n}assignCareplanToPatient(){this._careplansService.getActiveCareplansForAPatient(this.patientId,this.careplanAssignmentDTO.type).subscribe(e=>{null!=e&&e.length>0?this.suspendConfirmationPopup():this._careplansService.assignCareplanToPatient(this.careplanAssignmentDTO).subscribe(e=>{this._careplanEventLogger.episodeCareplanActionEvent("",this.patientId,null==e?void 0:e.id,"careplan_assign_to_patient"),this._notificationsService.success(this.translatedStrings.get("COMMON.CAREPLAN"),this.translatedStrings.get("CAREPLAN.SUCCESSFULLY_ASSIGNED")),this._dataSharingService.triggerAlertRefresh(),this.goBack()})})}suspendConfirmationPopup(){this._modalService.confirm({nzTitle:"<i>"+this.translatedStrings.get("CONFIRMATION")+"</i>",nzContent:"<b>"+this.translatedStrings.get("CAREPLAN.EXISTING_CAREPLAN_SUSPEND_CONFIRMATION")+"</b>",nzOnOk:()=>{this._careplansService.suspendExistingcareplans(this.patientId).subscribe(()=>{this._careplansService.assignCareplanToPatient(this.careplanAssignmentDTO).subscribe(()=>{this._notificationsService.success(this.translatedStrings.get("COMMON.CAREPLAN"),this.translatedStrings.get("CAREPLAN.SUCCESSFULLY_ASSIGNED")),this.goBack()})},e=>{console.log(e)})}})}assignCareplanToEpisode(){this._careplansService.assignCareplanToPatient(this.careplanAssignmentDTO).subscribe(e=>{this.careplanId=e.id,this._careplanEventLogger.episodeCareplanActionEvent(this.episodeId,this.patientId,this.careplanId,"careplan_assign_to_episode"),this._careplansService.assignCareplanToEpisode(this.careplanId,this.episodeId).subscribe(()=>{this._notificationsService.success(this.translatedStrings.get("COMMON.CAREPLAN"),this.translatedStrings.get("CAREPLAN.SUCCESSFULLY_ASSIGNED")),this._dataSharingService.triggerAlertRefresh(),this.goBack()})})}initializeCaretakerDTO(){return this.isCaretakersAvailable?!!(this.selectedCaretaker&&this.selectedCaretaker.tenantId||!this.isCaretakersAvailable)||(this._notificationsService.error(this.translatedStrings.get("COMMON.CAREPLAN"),this.translatedStrings.get("CAREPLAN.SELECT_CARETAKER_ERROR")),!1):(this.showCaretakerAssigner=!0,!1)}setCaretakersStatus(e){this.isCaretakersAvailable=e}setCaretaker(e){this.selectedCaretaker=e,this.searchCaretakerInput=`${e.firstName} ${e.lastName}`}searchCaretaker(e){e&&this._userService.searchCaretakers(e).subscribe(e=>this.caretakers=e)}assignCaretakerToPatient(){this.caretakerAssignmentDTO.userId=this.patientId,this.caretakerAssignmentDTO.tenantId=this.selectedCaretaker.tenantId,this.caretakerAssignmentDTO.caretakerId=this.selectedCaretaker.id,this._userService.assignCareTaker(this.caretakerAssignmentDTO).subscribe(()=>{this.isCaretakersAvailable=!0,this.hideCaretakerAssigner(),this.saveCareplan()})}hideCaretakerAssigner(){this.showCaretakerAssigner=!1}setUserMedicine(e){this.userMedicines=e}goBack(){this._location.back()}}return e.\u0275fac=function(n){return new(n||e)(D.Rb(r.l),D.Rb(A.a),D.Rb(m.a),D.Rb(se.f),D.Rb(r.e),D.Rb(l.a),D.Rb(T.b),D.Rb(pn.a),D.Rb(d.a),D.Rb(I.a))},e.\u0275cmp=D.Lb({type:e,selectors:[["app-careplan-assigner"]],features:[D.Cb([r.e]),D.Ab],decls:15,vars:26,consts:[["title","careplans","defaultTitle","Careplans","prefix","Assign","actionTitle","Assign",3,"isSearchEnabled","action"],["isEditDisabled","true","showCaretakerAssigner","true",3,"course","patientId","courseChange","patientIdChange","caretakerEmitter","caretakerAvailable"],["nz-row","","nzGutter","16","class","careplan-details-container",4,"ngIf"],[3,"mode","interventionBluprints","groupInterventions","groupInterventionMap","selectedInterventionBlueprint","interventionGroupIds","course","patientId","modeChange","interventionBluprintsChange","groupInterventionsChange","groupInterventionMapChange","selectedInterventionBlueprintChange","interventionGroupIdsChange","courseChange","patientIdChange","emitUserMedicine"],[3,"nzVisible","nzTitle","nzVisibleChange","nzOnCancel","nzOnOk"],["nzType","warning","nzShowIcon","",3,"nzMessage"],["nz-input","",3,"placeholder","ngModel","nzAutocomplete","ngModelChange","input"],["nzBackfill","false"],["auto",""],[3,"nzValue",4,"ngFor","ngForOf"],["nz-row","","nzGutter","16",1,"careplan-details-container"],["nz-col","","nzSpan","8"],["nzFormat","MMM d, y",3,"nzDisabledDate","nzPlaceHolder","ngModel","nzAllowClear","ngModelChange"],[3,"nzValue"],[3,"firstName","lastName"]],template:function(e,n){if(1&e&&(D.Xb(0,"app-header",0),D.ec("action",function(){return n.saveCareplan()}),D.Wb(),D.Xb(1,"app-careplan-header",1),D.ec("courseChange",function(e){return n.course=e})("patientIdChange",function(e){return n.patientId=e})("caretakerEmitter",function(e){return n.setCaretaker(e)})("caretakerAvailable",function(e){return n.setCaretakersStatus(e)}),D.Wb(),D.Vc(2,Lt,7,12,"div",2),D.Vc(3,wt,7,12,"div",2),D.Xb(4,"app-interventions-composer",3),D.ec("modeChange",function(e){return n.mode=e})("interventionBluprintsChange",function(e){return n.interventionBluprints=e})("groupInterventionsChange",function(e){return n.groupInterventions=e})("groupInterventionMapChange",function(e){return n.groupInterventionMap=e})("selectedInterventionBlueprintChange",function(e){return n.selectedInterventionBlueprint=e})("interventionGroupIdsChange",function(e){return n.interventionGroupIds=e})("courseChange",function(e){return n.course=e})("patientIdChange",function(e){return n.patientId=e})("emitUserMedicine",function(e){return n.setUserMedicine(e)}),D.Wb(),D.Xb(5,"nz-modal",4),D.ec("nzVisibleChange",function(e){return n.showCaretakerAssigner=e})("nzOnCancel",function(){return n.hideCaretakerAssigner()})("nzOnOk",function(){return n.assignCaretakerToPatient()}),D.jc(6,"translate"),D.Sb(7,"nz-alert",5),D.jc(8,"translate"),D.Sb(9,"nz-divider"),D.Xb(10,"input",6),D.ec("ngModelChange",function(e){return n.selectedCaretaker.fullName=e})("input",function(e){return n.searchCaretaker(null==e.target?null:e.target.value)})("ngModelChange",function(e){return n.setCaretaker(e)}),D.jc(11,"translate"),D.Wb(),D.Xb(12,"nz-autocomplete",7,8),D.Vc(14,Vt,2,3,"nz-auto-option",9),D.Wb(),D.Wb()),2&e){const e=D.Ic(13);D.rc("isSearchEnabled",!1),D.Db(1),D.rc("course",n.course)("patientId",n.patientId),D.Db(1),D.rc("ngIf","EPISODE"===n.mode),D.Db(1),D.rc("ngIf","ASSIGN"===n.mode),D.Db(1),D.rc("mode",n.mode)("interventionBluprints",n.interventionBluprints)("groupInterventions",n.groupInterventions)("groupInterventionMap",n.groupInterventionMap)("selectedInterventionBlueprint",n.selectedInterventionBlueprint)("interventionGroupIds",n.interventionGroupIds)("course",n.course)("patientId",n.patientId),D.Db(1),D.sc("nzTitle",D.kc(6,20,"CAREPLAN.CARETAKER_ASSIGNER")),D.rc("nzVisible",n.showCaretakerAssigner),D.Db(2),D.sc("nzMessage",D.kc(8,22,"CAREPLAN.ASSIGN_CARETAKER_TO_PROCEED")),D.Db(3),D.sc("placeholder",D.kc(11,24,"SEARCH_CARETAKER")),D.rc("ngModel",n.selectedCaretaker.fullName)("nzAutocomplete",e),D.Db(4),D.rc("ngForOf",n.caretakers)}},directives:[E.a,x,r.q,At,se.a,Bt.a,ge.a,X.b,c.d,Hn.d,c.u,c.x,Hn.a,r.p,O.c,O.a,le.a,Hn.c,Pt.a],pipes:[W.a],styles:["[_nghost-%COMP%]{background-color:var(--neutral-color)}.careplan-details-container[_ngcontent-%COMP%]{padding:20px}nz-date-picker[_ngcontent-%COMP%]{width:100%}"]}),e})();class Ft{}class Gt{}let xt=(()=>{class e extends h.a{constructor(e,n,t,i,r){super(),this._location=e,this._careplansService=n,this._datePipe=t,this._notificationsService=i,this._activatedRoute=r,this.mode="EPISODE",this.course=new Gt,this.interventionGroupIds=["DEFAULT"],this.groupInterventions=[],this.interventionBluprints=[],this.groupInterventionMap=new Map,this.careplanBlueprintDTO=new g,this.originalInterventionsMap=new Map,this.originalUserMedicinesMap=new Map,this.isEditCareplanModalVisible=!1,this.removedUserMedicineIds=[],this.originalCareplanDays=0,this.disabledDate=e=>Object(re.a)(this.startDate,e)>0||Object(re.a)(this.episodeEndDate,e)<0}dateParser(e){const n=e.split("-");return new Date(+n[0],+n[1]-1,+n[2])}ngOnInit(){this._activatedRoute.params.forEach(e=>{this.careplanId=e.id}),this._activatedRoute.queryParams.subscribe(e=>this.episodeEndDate=e.episodeEndDate||this._datePipe.transform(this.endDate,"yyyy-MM-dd")).unsubscribe(),this.loggedInUser=localStorage.getItem("loggedInUser"),this.getCareplanById(this.careplanId),this.getInterventions(this.careplanId)}getCareplanById(e){this._careplansService.getAssignedCareplanById(e).subscribe(e=>{this.course=e,this.patientId=this.course.patientId,this.startDate=this.dateParser(this.course.startDate),this.course.endTime=this.course.endTime-1,this.endDate=this.dateParser(this.course.endDate),this.originalCareplanDays=this.course.numOfDays,this.userMedicines=this.course.userMedicines,this.userMedicines.forEach(e=>{this.originalUserMedicinesMap.set(e.id,JSON.parse(JSON.stringify(e)))})})}getInterventions(e){this._careplansService.getInterventionsForCarePlan(e).subscribe(e=>{this.originalInterventionsMap=new Map(e.map(e=>[e.id,Object.assign({},e)])),this.interventionBluprints=e,this.groupInterventions=this.interventionBluprints.filter(e=>"GROUP"===e.type);for(const n of this.interventionBluprints)"GROUP"!==n.type&&this.appendToInterventionBlueprintGroup(null==n.parentId?"DEFAULT":n.parentId,n);this.groupInterventionMap.get("DEFAULT")||this.groupInterventionMap.set("DEFAULT",new Array),this.interventionGroupIds=Array.from(this.groupInterventionMap.keys())})}appendToInterventionBlueprintGroup(e,n){if("MEDICINE"===n.type)return;let t=this.groupInterventionMap.get(e);void 0===t&&(t=[]),t.push(n),this.groupInterventionMap.set(e,t)}showEditCareplanModal(){this._careplansService.validateSchdeules(this.groupInterventionMap)&&(this.isEditCareplanModalVisible=!0)}closeEditCareplanModal(){this.isEditCareplanModalVisible=!1}saveCareplan(){this.closeEditCareplanModal(),this.initializeCareplanUpdateDTO(),this.saveEditedCareplan()}initializeCareplanUpdateDTO(){this.careplanUpdateDTO=new Ft,this.careplanUpdateDTO.addedInterventions=[],this.careplanUpdateDTO.modifiedInterventions=[],this.careplanUpdateDTO.editedUserMedicines=[],this.careplanUpdateDTO.userMedicines=[],this.careplanUpdateDTO.careplanId=this.careplanId,this.careplanUpdateDTO.patientId=this.patientId,this.careplanUpdateDTO.noOfDays=this.course.numOfDays,this.careplanUpdateDTO.reasonForChange=this.reasonForChange,this.careplanUpdateDTO.careplanStartTime=this.course.beginTime,this.careplanUpdateDTO.careplanEndTime=this.endDate.setHours(23,59,59,999),this.careplanUpdateDTO.startDate=this._datePipe.transform(this.course.beginTime,"yyyy-MM-dd"),this.careplanUpdateDTO.endDate=this._datePipe.transform(this.endDate,"yyyy-MM-dd"),this.careplanUpdateDTO.assignerId=this.loggedInUser,this.careplanUpdateDTO.assignedOn=Date.now(),this.careplanUpdateDTO.careplanTitle=this.course.name,this.careplanUpdateDTO.careplanBlueprint=this.course,this.setInterventionsInCareplanDTO(),this.setUserMedicinesInCareplanDTO()}setInterventionsInCareplanDTO(){Array.from(this.groupInterventionMap.keys()).forEach(e=>{this.groupInterventionMap.get(e).forEach(n=>{const t=Object.assign({},n);if(t.parentId="DEFAULT"===e?null:e,t.id.length<=10&&(delete t.id,this.careplanUpdateDTO.addedInterventions.push(t)),t.id&&10<t.id.length){const e=this.originalInterventionsMap.get(t.id);JSON.stringify(e)==JSON.stringify(t)&&e.schedules.length===t.schedules.length||this.careplanUpdateDTO.modifiedInterventions.push(t)}"REMOTE_PATIENT_MONITORING"===this.course.type&&(t.reviewResponseEnabled=!0,"666"===t.permissions&&(t.permissions="464"))})}),this.groupInterventions.forEach(e=>{const n=Object.assign({},e);n.id.length<=10&&("REMOTE_PATIENT_MONITORING"===this.course.type&&(n.reviewResponseEnabled=!0,"666"===n.permissions&&(n.permissions="464")),this.careplanUpdateDTO.addedInterventions.push(n))}),this.careplanUpdateDTO.removedInterventions=this.careplanBlueprintDTO.deletedInterventions}setUserMedicinesInCareplanDTO(){this.userMedicines.forEach(e=>{e.id&&JSON.stringify(e)!==JSON.stringify(this.originalUserMedicinesMap.get(e.id))?this.careplanUpdateDTO.editedUserMedicines.push(e):e.id||this.careplanUpdateDTO.userMedicines.push(e)}),this.careplanUpdateDTO.removedMedicines=this.removedUserMedicineIds}setRemovedUserMedicine(e){this.removedUserMedicineIds.push(e)}saveEditedCareplan(){this._careplansService.editExistingCareplan(this.careplanUpdateDTO).subscribe(()=>{this._notificationsService.success("Careplan","Careplan Edited Successfully!"),this.goBack()})}setUserMedicine(e){this.userMedicines=e}disableStartDate(){this._notificationsService.error("Careplan","Start date cannot be modified!"),this.startDate=new Date(this.course.beginTime)}goBack(){this._location.back()}}return e.\u0275fac=function(n){return new(n||e)(D.Rb(r.l),D.Rb(m.a),D.Rb(r.e),D.Rb(T.b),D.Rb(d.a))},e.\u0275cmp=D.Lb({type:e,selectors:[["app-assigned-careplan-edit"]],features:[D.Cb([r.e]),D.Ab],decls:19,vars:36,consts:[["title","careplans","subProperty","edit","defaultTitle","Assigned Careplans","prefix","Edit",3,"isSearchEnabled","actionTitle","action"],["nz-row","",1,"careplan-details-container"],["nz-col","","nzSpan","8"],["nz-input","",1,"input-size",3,"placeholder","ngModel","ngModelChange"],["disabled","","nz-input","",1,"input-size",3,"placeholder","ngModel","ngModelChange"],["nzFormat","MMM d, y",3,"nzDisabled","nzPlaceHolder","ngModel","nzAllowClear","ngModelChange"],["nzFormat","MMM d, y",3,"nzDisabledDate","nzPlaceHolder","ngModel","nzAllowClear","ngModelChange"],[3,"mode","interventionBluprints","groupInterventions","groupInterventionMap","selectedInterventionBlueprint","interventionGroupIds","course","patientId","careplanBlueprintDTO","medicinesAssigned","modeChange","interventionBluprintsChange","groupInterventionsChange","groupInterventionMapChange","selectedInterventionBlueprintChange","interventionGroupIdsChange","courseChange","patientIdChange","emitUserMedicine","careplanBlueprintDTOChange","medicinesAssignedChange","emitRemovedUserMedicine"],["nzTitle","Please Enter Reason For Editing Of Careplan",3,"nzVisible","nzVisibleChange","nzOnOk","nzOnCancel"],["nz-input","","placeholder","Reason For Updation",3,"ngModel","ngModelChange"]],template:function(e,n){1&e&&(D.Xb(0,"app-header",0),D.ec("action",function(){return n.showEditCareplanModal()}),D.jc(1,"translate"),D.Wb(),D.Xb(2,"div",1),D.Xb(3,"div",2),D.Xb(4,"input",3),D.ec("ngModelChange",function(e){return n.course.name=e}),D.jc(5,"translate"),D.Wb(),D.Wb(),D.Xb(6,"div",2),D.Xb(7,"input",4),D.ec("ngModelChange",function(e){return n.course.numOfDays=e}),D.jc(8,"translate"),D.Wb(),D.Wb(),D.Wb(),D.Xb(9,"div",1),D.Xb(10,"div",2),D.Xb(11,"nz-date-picker",5),D.ec("ngModelChange",function(e){return n.startDate=e})("ngModelChange",function(){return n.disableStartDate()}),D.jc(12,"translate"),D.Wb(),D.Wb(),D.Xb(13,"div",2),D.Xb(14,"nz-date-picker",6),D.ec("ngModelChange",function(e){return n.endDate=e}),D.jc(15,"translate"),D.Wb(),D.Wb(),D.Wb(),D.Xb(16,"app-interventions-composer",7),D.ec("modeChange",function(e){return n.mode=e})("interventionBluprintsChange",function(e){return n.interventionBluprints=e})("groupInterventionsChange",function(e){return n.groupInterventions=e})("groupInterventionMapChange",function(e){return n.groupInterventionMap=e})("selectedInterventionBlueprintChange",function(e){return n.selectedInterventionBlueprint=e})("interventionGroupIdsChange",function(e){return n.interventionGroupIds=e})("courseChange",function(e){return n.course=e})("patientIdChange",function(e){return n.patientId=e})("emitUserMedicine",function(e){return n.setUserMedicine(e)})("careplanBlueprintDTOChange",function(e){return n.careplanBlueprintDTO=e})("medicinesAssignedChange",function(e){return n.userMedicines=e})("emitRemovedUserMedicine",function(e){return n.setRemovedUserMedicine(e)}),D.Wb(),D.Xb(17,"nz-modal",8),D.ec("nzVisibleChange",function(e){return n.isEditCareplanModalVisible=e})("nzOnOk",function(){return n.saveCareplan()})("nzOnCancel",function(){return n.closeEditCareplanModal()}),D.Xb(18,"input",9),D.ec("ngModelChange",function(e){return n.reasonForChange=e}),D.Wb(),D.Wb()),2&e&&(D.sc("actionTitle",D.kc(1,26,"COMMON.SAVE")),D.rc("isSearchEnabled",!1),D.Db(4),D.sc("placeholder",D.kc(5,28,"COMMON.NAME")),D.rc("ngModel",n.course.name),D.Db(3),D.sc("placeholder",D.kc(8,30,"COMMON.NOOFDAYS")),D.rc("ngModel",n.course.numOfDays),D.Db(4),D.sc("nzPlaceHolder",D.kc(12,32,"COMMON.STARTDATE")),D.rc("nzDisabled",!0)("ngModel",n.startDate)("nzAllowClear",!1),D.Db(3),D.sc("nzPlaceHolder",D.kc(15,34,"COMMON.ENDDATE")),D.rc("nzDisabledDate",n.disabledDate)("ngModel",n.endDate)("nzAllowClear",!1),D.Db(2),D.rc("mode",n.mode)("interventionBluprints",n.interventionBluprints)("groupInterventions",n.groupInterventions)("groupInterventionMap",n.groupInterventionMap)("selectedInterventionBlueprint",n.selectedInterventionBlueprint)("interventionGroupIds",n.interventionGroupIds)("course",n.course)("patientId",n.patientId)("careplanBlueprintDTO",n.careplanBlueprintDTO)("medicinesAssigned",n.userMedicines),D.Db(1),D.rc("nzVisible",n.isEditCareplanModalVisible),D.Db(1),D.rc("ngModel",n.reasonForChange))},directives:[E.a,O.c,O.a,X.b,c.d,c.u,c.x,le.a,At,se.a],pipes:[W.a],styles:["[_nghost-%COMP%]{background-color:var(--neutral-color);min-height:100%}.careplan-details-container[_ngcontent-%COMP%]{padding:20px}.input-size[_ngcontent-%COMP%], nz-date-picker[_ngcontent-%COMP%]{width:90%}"]}),e})();var Yt=t("bA1+"),Ht=t("0W7X");const jt=[{path:"edit-assigned-careplan/:id",component:xt,data:{primaryAction:{feature:{feature:"careplanConfig.enabled"}},secondaryAction:{},privileges:[Ht.a.ASSIGN_CARE_PLAN,Ht.a.REASSIGN_CARE_PLAN,Ht.a.EDIT_CARE_PLAN,Ht.a.SUSPEND_CARE_PLAN],showTenantToggle:!1},canActivate:[u.a,Yt.a]},{path:":mode/:id/:patientId/:tenantId",component:Ut,data:{primaryAction:{feature:{feature:"careplanConfig.enabled"}},secondaryAction:{},privileges:[Ht.a.ASSIGN_CARE_PLAN,Ht.a.REASSIGN_CARE_PLAN,Ht.a.EDIT_CARE_PLAN,Ht.a.SUSPEND_CARE_PLAN],showTenantToggle:!1},canActivate:[u.a,Yt.a]},{path:":mode/:id/:patientId/:episodeId/:tenantId",component:Ut,data:{primaryAction:{feature:{feature:"careplanConfig.enabled"}},secondaryAction:{},privileges:[Ht.a.ASSIGN_CARE_PLAN,Ht.a.REASSIGN_CARE_PLAN,Ht.a.EDIT_CARE_PLAN,Ht.a.SUSPEND_CARE_PLAN],showTenantToggle:!1},canActivate:[u.a,Yt.a]},{path:":mode/:id",component:Nt,data:{primaryAction:{feature:{feature:"careplanConfig.enabled"}},secondaryAction:{},privileges:[Ht.a.ASSIGN_CARE_PLAN,Ht.a.REASSIGN_CARE_PLAN,Ht.a.EDIT_CARE_PLAN,Ht.a.SUSPEND_CARE_PLAN],showTenantToggle:!1},canActivate:[u.a,Yt.a]},{path:":mode",component:Nt,data:{primaryAction:{feature:{feature:"careplanConfig.enabled"}},secondaryAction:{},privileges:[Ht.a.ASSIGN_CARE_PLAN,Ht.a.REASSIGN_CARE_PLAN,Ht.a.EDIT_CARE_PLAN,Ht.a.SUSPEND_CARE_PLAN],showTenantToggle:!1},canActivate:[u.a,Yt.a]}];let $t=(()=>{class e{}return e.\u0275mod=D.Pb({type:e}),e.\u0275inj=D.Ob({factory:function(n){return new(n||e)},imports:[[d.k.forChild(jt)],d.k]}),e})(),qt=(()=>{class e{constructor(e){this.translationService=e,e.setLanguage()}}return e.\u0275mod=D.Pb({type:e}),e.\u0275inj=D.Ob({factory:function(n){return new(n||e)(D.bc(l.a))},imports:[[r.c,a.a,s.a,c.o,o.a,i.a,$t]]}),e})()},I2os:function(e,n,t){"use strict";t.d(n,"a",function(){return i});class i{}}}]);