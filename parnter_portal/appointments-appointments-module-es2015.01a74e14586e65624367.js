(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{MCT3:function(t,e,n){"use strict";n.r(e),n.d(e,"AppointmentsModule",function(){return Jn});var i=n("rbUg"),a=n("ofXK"),s=n("SHZf"),o=n("UFn0"),c=n("tyNb"),l=n("3Pt+"),r=n("KZX/"),p=n("T5gh"),d=n("1G5W"),u=n("qQcL"),b=n("VGjC"),h=n("cnAw"),m=n("w7IE"),g=n("OE57"),f=n("igu/"),S=n("FH+g"),z=n("1yiY"),A=n("74vj"),v=n("MXg9"),T=n("WIjQ"),I=n("jIYg"),D=n("Z93s"),C=n("c36b"),E=n("Dm2S"),X=n("pe0G"),O=n("bA60"),P=n("+gyu"),y=n("fXoL"),N=n("bNXi"),M=n("JA5x"),L=n("eHCX"),_=n("5vDB"),W=n("B+r4"),R=n("zAKX"),k=n("rP/m"),w=n("mUB+"),V=n("mUTz"),F=n("glKu"),x=n("nJia"),U=n("bE2y"),j=n("OzZK"),H=n("RwU8"),B=n("C2AL"),Y=n("Szod"),$=n("FwiY"),q=n("dRHE"),Q=n("vDSh"),Z=n("t2pg"),K=n("m3lz"),G=n("ncKW");function J(t,e){if(1&t&&(y.Vb(0),y.Xb(1,"span",29),y.Xb(2,"span",30),y.Xc(3),y.jc(4,"tenantName"),y.Wb(),y.Wb(),y.Ub()),2&t){const t=y.ic().$implicit;y.Db(3),y.Yc(y.kc(4,1,null==t?null:t.tenantId))}}function tt(t,e){if(1&t&&(y.Vb(0),y.Xb(1,"nz-option",25),y.jc(2,"date"),y.Xb(3,"span",26),y.Xb(4,"span",27),y.Xc(5),y.jc(6,"date"),y.Wb(),y.Vc(7,J,5,3,"ng-container",28),y.Wb(),y.Wb(),y.Ub()),2&t){const t=e.$implicit;y.Db(1),y.vc("nzLabel","",null==t?null:t.firstName," ",null==t?null:t.lastName," - ",y.lc(2,7,null==t?null:t.dateOfBirth,"mediumDate"),""),y.rc("nzValue",t),y.Db(4),y.bd(" ",null==t?null:t.firstName," ",null==t?null:t.lastName," - ",y.lc(6,10,null==t?null:t.dateOfBirth,"mediumDate")," ")}}function et(t,e){1&t&&(y.Xb(0,"nz-option",31),y.Sb(1,"app-icons",32),y.Xc(2," Loading Data... "),y.Wb())}function nt(t,e){if(1&t&&(y.Vb(0),y.Xc(1," | "),y.Xb(2,"span",30),y.Xc(3),y.jc(4,"tenantName"),y.Wb(),y.Ub()),2&t){const t=y.ic().$implicit;y.Db(3),y.Zc(" ",y.kc(4,1,null==t.nzValue?null:t.nzValue.tenantId)," ")}}function it(t,e){1&t&&(y.Xc(0),y.Vc(1,nt,5,3,"ng-container",28)),2&t&&y.Zc(" ",e.$implicit.nzLabel," ")}function at(t,e){1&t&&(y.Xb(0,"div",2),y.Xb(1,"div",3),y.Xb(2,"strong"),y.Xc(3),y.jc(4,"translate"),y.jc(5,"translate"),y.jc(6,"translate"),y.Wb(),y.Wb(),y.Wb()),2&t&&(y.rc("nzGutter",24),y.Db(1),y.rc("nzSpan",8),y.Db(2),y.bd("",y.kc(4,5,"COMMON.PHYSICIAN"),"\\",y.kc(5,7,"PATIENT.MONITORING_STAFF")," - ",y.kc(6,9,"SITE"),""))}function st(t,e){1&t&&(y.Xb(0,"span",37),y.Sb(1,"span",38),y.Xc(2," Primary "),y.Wb())}function ot(t,e){if(1&t&&(y.Vb(0),y.Xb(1,"nz-option",25),y.jc(2,"userLocations"),y.Xb(3,"span",26),y.Xb(4,"span",27),y.Xc(5),y.jc(6,"userLocations"),y.Wb(),y.Vc(7,st,3,0,"span",36),y.Wb(),y.Wb(),y.Ub()),2&t){const t=e.$implicit,n=y.ic(3);y.Db(1),y.vc("nzLabel","",null==t?null:t.firstName," ",null==t?null:t.lastName," - ",y.kc(2,8,null==t?null:t.locations),""),y.rc("nzValue",t),y.Db(4),y.bd(" ",null==t?null:t.firstName," ",null==t?null:t.lastName," - ",y.kc(6,10,null==t?null:t.locations)," "),y.Db(2),y.rc("ngIf",n.primaryStaff.has(null==t?null:t.id))}}function ct(t,e){if(1&t&&(y.Vb(0),y.Vc(1,ot,8,12,"ng-container",5),y.Ub()),2&t){const t=e.ngIf;y.Db(1),y.rc("ngForOf",t)}}function lt(t,e){1&t&&(y.Xb(0,"nz-option",31),y.Sb(1,"app-icons",32),y.Xc(2," Loading Data... "),y.Wb())}function rt(t,e){if(1&t){const t=y.Yb();y.Xb(0,"div",3),y.Xb(1,"nz-select",33),y.ec("ngModelChange",function(e){return y.Lc(t),y.ic().selectedCaretaker=e})("nzOnSearch",function(e){return y.Lc(t),y.ic().searchCaretakers(e)}),y.jc(2,"translate"),y.Vc(3,ct,2,1,"ng-container",34),y.jc(4,"async"),y.Vc(5,lt,3,0,"ng-template",null,35,y.Wc),y.Wb(),y.Wb()}if(2&t){const t=y.Ic(6),e=y.ic();y.rc("nzSpan",8),y.Db(1),y.tc("nzPlaceHolder"," ",y.kc(2,8,"COMMON.AVAILABLE_STAFFS")," "),y.rc("nzShowSearch",!0)("nzDisabled",!(null!=e.appointment&&null!=e.appointment.schedule&&e.appointment.schedule.startDate))("ngModel",e.selectedCaretaker)("nzServerSearch",!0),y.Db(2),y.rc("ngIf",y.kc(4,10,e.caretakers$))("ngIfElse",t)}}function pt(t,e){if(1&t){const t=y.Yb();y.Xb(0,"div",3),y.Xb(1,"nz-radio-group",20),y.ec("ngModelChange",function(e){return y.Lc(t),y.ic().appointment.type=e}),y.Xb(2,"label",39),y.Xc(3),y.jc(4,"translate"),y.Wb(),y.Xb(5,"label",40),y.Xc(6),y.jc(7,"translate"),y.Wb(),y.Xb(8,"label",41),y.Xc(9),y.jc(10,"translate"),y.Wb(),y.Wb(),y.Wb()}if(2&t){const t=y.ic();y.rc("nzSpan",12),y.Db(1),y.rc("ngModel",t.appointment.type),y.Db(1),y.rc("nzDisabled",t.videoAppointmentEnabled),y.Db(1),y.Zc(" ",y.kc(4,8,"EPISODE.HOMEVISIT"),""),y.Db(2),y.rc("nzDisabled",!t.videoAppointmentEnabled),y.Db(1),y.Zc(" ",y.kc(7,10,"VIDEO_CALL"),""),y.Db(2),y.rc("nzDisabled",!t.audioAppointmentEnabled),y.Db(1),y.Zc(" ",y.kc(10,12,"AUDIO_CALL"),"")}}function dt(t,e){if(1&t&&(y.Vb(0),y.Xb(1,"label",43),y.Xc(2),y.Wb(),y.Ub()),2&t){const t=e.$implicit;y.Db(1),y.rc("nzValue",null==t?null:t.id),y.Db(1),y.Yc(null==t?null:t.episodeType)}}function ut(t,e){if(1&t){const t=y.Yb();y.Xb(0,"div",2),y.Xb(1,"div",3),y.Sb(2,"br"),y.Sb(3,"br"),y.Xb(4,"h3"),y.Xc(5," This patient has some active episode(s) going on. Would you like to link this appointment with any of them? "),y.Wb(),y.Xb(6,"p"),y.Xb(7,"nz-radio-group",42),y.ec("ngModelChange",function(e){return y.Lc(t),y.ic().episodeId=e})("ngModelChange",function(){return y.Lc(t),y.ic().episodeIdUpdated()}),y.jc(8,"dateCompare"),y.Xb(9,"label",43),y.Xc(10,"None"),y.Wb(),y.Vc(11,dt,3,2,"ng-container",5),y.Wb(),y.Wb(),y.Wb(),y.Wb()}if(2&t){const t=y.ic();y.rc("nzGutter",24),y.Db(1),y.rc("nzSpan",24),y.Db(6),y.rc("ngModel",t.episodeId)("nzDisabled",!y.lc(8,7,null==t.appointment||null==t.appointment.schedule?null:t.appointment.schedule.startDate,"MONTH"))("nzDisabled",t.disableEpisodeSelection),y.Db(2),y.rc("nzValue",void 0),y.Db(2),y.rc("ngForOf",null==t.selectedPatient||null==t.selectedPatient.patientState||null==t.selectedPatient.patientState.episodeState?null:t.selectedPatient.patientState.episodeState.activeEpisodes)}}function bt(t,e){if(1&t&&(y.Vb(0),y.Sb(1,"nz-option",45),y.jc(2,"purposeLabel"),y.Ub()),2&t){const t=e.$implicit;y.Db(1),y.sc("nzLabel",y.kc(2,2,t)),y.rc("nzValue",t)}}function ht(t,e){1&t&&(y.Xb(0,"nz-option",31),y.Sb(1,"app-icons",32),y.Xc(2," Loading Data... "),y.Wb())}function mt(t,e){if(1&t){const t=y.Yb();y.Xb(0,"div",2),y.Xb(1,"div",3),y.Sb(2,"br"),y.Sb(3,"br"),y.Xb(4,"h3"),y.Xc(5," Appointment Type * "),y.Wb(),y.Xb(6,"p"),y.Xb(7,"nz-select",44),y.ec("ngModelChange",function(e){return y.Lc(t),y.ic().appointmentPurpose=e}),y.Vc(8,bt,3,4,"ng-container",5),y.Vc(9,ht,3,0,"nz-option",6),y.Wb(),y.Wb(),y.Wb(),y.Wb()}if(2&t){const t=y.ic();y.rc("nzGutter",24),y.Db(1),y.rc("nzSpan",8),y.Db(6),y.rc("nzShowSearch",!0)("ngModel",t.appointmentPurpose),y.Db(1),y.rc("ngForOf",t.appointmentPurposeList),y.Db(1),y.rc("ngIf",t.appointmentPurposeLoading)}}function gt(t,e){if(1&t&&(y.Xb(0,"nz-option",25),y.Xb(1,"strong",50),y.Xc(2),y.Wb(),y.Wb()),2&t){const t=e.$implicit;y.rc("nzLabel",null==t?null:t.title)("nzValue",t),y.Db(2),y.Yc(null==t?null:t.title)}}function ft(t,e){1&t&&(y.Xb(0,"nz-option",31),y.Sb(1,"app-icons",32),y.Xc(2," Loading Data... "),y.Wb())}function St(t,e){if(1&t){const t=y.Yb();y.Vb(0),y.Sb(1,"br"),y.Sb(2,"br"),y.Xb(3,"div",14),y.Xb(4,"div",3),y.Xb(5,"h3"),y.Xc(6,"Assessments"),y.Wb(),y.Wb(),y.Wb(),y.Xb(7,"div",14),y.Xb(8,"div",3),y.Xb(9,"div",17),y.Xb(10,"nz-select",46),y.ec("ngModelChange",function(e){return y.Lc(t),y.ic().selectedFormBlueprints=e}),y.Vc(11,gt,3,3,"nz-option",47),y.Vc(12,ft,3,0,"nz-option",6),y.Wb(),y.Xb(13,"div",48),y.Sb(14,"app-icons",49),y.Wb(),y.Wb(),y.Wb(),y.Wb(),y.Ub()}if(2&t){const t=y.ic();y.Db(4),y.rc("nzSpan",8),y.Db(4),y.rc("nzSpan",12),y.Db(2),y.rc("ngModel",t.selectedFormBlueprints),y.Db(1),y.rc("ngForOf",t.formBlueprints),y.Db(1),y.rc("ngIf",t.formBlueprintsLoading)}}let zt=(()=>{class t extends u.a{constructor(t,e,n,i,a,s,o,c,l,r,p,d,u){super(),this._location=t,this._usersService=e,this._appointmentsService=n,this._notificationsService=i,this._datePipe=a,this._dataSharingService=s,this._videoCallService=o,this._appointmentsEventLogger=c,this._activatedRoute=l,this._episodesEventLogger=r,this._formService=p,this._actionItemsService=d,this._noteTemplatesService=u,this.patients=[],this.patientsLoading=!1,this.appointmentPurposeLoading=!1,this.audioAppointmentEnabled=!1,this.primaryStaff=new Set,this.note=new D.a,this.severity="NORMAL",this.fromEpisode=!1,this.episodeType=null,this.config=C.b}ngOnInit(){this.appointment=new h.b,this.appointment.schedule=new m.a,this.appointment.serviceIds=new Array,this._activatedRoute.params.forEach(t=>{this.patientId=t.id,this.patientId&&(this.disablePatientSelection=!0)}),this.episodeId=this._activatedRoute.snapshot.queryParams.episodeId,this.episodeId&&(this.disableEpisodeSelection=!0),this.fromEpisode=this._activatedRoute.snapshot.queryParams.fromEpisode,this.episodeType=this._activatedRoute.snapshot.queryParams.episodeType,this.patientId&&this.getPatientForAppointment(),"CARE_TAKER"===localStorage.getItem("loggedInUserAccountType")&&(this.isLoggedInUserCaretaker=!0),this.getTenantConfig(),this.fetchFormBlueprints()}fetchFormBlueprints(){this.formBlueprintsLoading=!0,this._formService.getFormsWithBody({phq9:!0,gad7:!0},0,9999999,"").subscribe(t=>{var e,n,i;(null===(e=null==t?void 0:t.data)||void 0===e?void 0:e.forms)&&(this.formBlueprints=null===(i=null===(n=null==t?void 0:t.data)||void 0===n?void 0:n.forms)||void 0===i?void 0:i.obj),this.formBlueprintsLoading=!1})}getTenantConfig(){this._dataSharingService.tenantSettings.pipe(Object(d.a)(this.unsubscribed)).subscribe(t=>{t&&(t.videoCallConfig&&t.videoCallConfig.enabled&&t.appointmentConfig.videoCallAppointment&&(this.videoAppointmentEnabled=!0,this.appointment.type=h.c.VIDEO_CALL),t.audioCallConfig&&t.audioCallConfig.enabled&&t.appointmentConfig.audioCallAppointment&&(this.audioAppointmentEnabled=!0,this.appointment.type=h.c.AUDIO_CALL))})}getPatientForAppointment(){this.patientsLoading=!0,this._appointmentsService.fetchPatientForAppointment(this.patientId).pipe(Object(d.a)(this.unsubscribed)).subscribe(t=>{this.patients=[t],this.setPatientId(t),this.patientsLoading=!1,this.episodeIdUpdated()})}setPatientId(t){t&&(this.selectedPatient=t,this.patientId=t.id,this.appointment.attendeeId=t.id,t.monitoringStaffs.primaryStaff.forEach(t=>this.primaryStaff.add(t)),t.physicianStaffs.primaryStaff.forEach(t=>this.primaryStaff.add(t)),this.searchCaretakers(),this.getNoteTemplates(t.tenantId))}getUsersByQuery(t){this.patientsLoading=!0,this._usersService.searchUsersByType(t,"PATIENT",10,0,null,[v.a.ACTIVE,v.a.REGISTERED]).subscribe(t=>{this.patients=t.body,this.patientsLoading=!1})}onAppointmentScheduleChange(t){var e,n,i,a;this.caretakers$=void 0,this.selectedCaretaker=void 0,t.valid?(this.appointment.schedule.startsOn=null==t?void 0:t.startTime,this.appointment.schedule.startDate=null===(e=null==t?void 0:t.startTime)||void 0===e?void 0:e.getTime(),this.appointment.schedule.endDate=null===(n=null==t?void 0:t.endTime)||void 0===n?void 0:n.getTime(),this.appointment.dateParam=this._datePipe.transform(t.startTime,"yyyy-MM-dd"),function(t){return Object(I.a)(1,arguments),Object(T.a)(Date.now(),t)}(null===(a=null===(i=this.appointment)||void 0===i?void 0:i.schedule)||void 0===a?void 0:a.startDate)||(this.episodeId=void 0,this.appointmentPurpose=void 0),this.searchCaretakers()):(this.appointment.schedule.startsOn=void 0,this.appointment.schedule.startDate=void 0,this.appointment.schedule.endDate=void 0)}validateCreateAppointmentForm(){return this.appointment.attendeeId&&this.appointment.schedule.startDate?!(!this.episodeId||this.appointmentPurpose||(this._notificationsService.error("Appointment","Please Select Appointment Type!"),0)):(this._notificationsService.error("Appointment","Please Fill All Fields Before Proceeding!"),!0)}searchCaretakers(t){var e,n,i,a;const s=null===(n=null===(e=this.appointment)||void 0===e?void 0:e.schedule)||void 0===n?void 0:n.startDate,o=null===(a=null===(i=this.appointment)||void 0===i?void 0:i.schedule)||void 0===a?void 0:a.endDate;this.caretakers$=this._appointmentsService.fetchAvailableCaretakers(s,o,0,10,t,this.patientId)}save(){if(!this.validateCreateAppointmentForm())return this.isLoggedInUserCaretaker?(this.appointment.attenderId=localStorage.getItem("loggedInUser"),void this.create()):void(this.selectedCaretaker?(this.appointment.attenderId=this.selectedCaretaker.id,this.create()):this._notificationsService.error("Appointment","Please select a clinician before proceeding!"))}createNoteForAppointment(t){return this._appointmentsService.createNewNoteForAppointment(t)}create(){switch(this.appointment.episodeId=this.episodeId,this.appointment.appointmentPurpose=this.appointmentPurpose,this.appointment.tenantId=localStorage.getItem("loggedInTenant"),this.isLoggedInUserCaretaker&&(this.appointment.ownerType=h.a.CARE_TAKER),this.appointment.type){case h.c.VIDEO_CALL:this.createVideoAppointment();break;case h.c.HOME_VISIT:case h.c.AUDIO_CALL:case h.c.HOSPITAL_VISIT:default:this.createAppointment()}}createAppointment(){this._appointmentsEventLogger.appointmentCreateEvent(this.appointment.type,this.appointment),this._appointmentsService.createNewAppointment(this.appointment).subscribe(t=>{this._notificationsService.success("Appointment","Appointment Created Successfully!"),this.assignAssessments(t),this.addNoteToAppointment(t)})}createVideoAppointment(){const t=new z.a,e=localStorage.getItem("loggedInUser");t.createdById=e,t.tenantId=localStorage.getItem("loggedInTenant"),t.participantIds=[this.appointment.attendeeId,e],t.env="prod",t.scheduled=!0,this._videoCallService.createVideoCallSessions(t).subscribe(t=>{this.appointment.videoCallSessionId=t.id,this._appointmentsEventLogger.appointmentCreateEvent(this.appointment.type,this.appointment),this._appointmentsService.createNewAppointment(this.appointment).subscribe(t=>{this._notificationsService.success("Appointment","Appointment Created Successfully!"),this.cancel(null==t?void 0:t.id)})})}addNoteToAppointment(t){this.note.content.length>0?(this.note.type="APPOINTMENT",this.note.userId=this.appointment.attendeeId,this.note.caretakerIds=new Array,this.note.caretakerIds.push(this.appointment.attenderId),this.note.priority={level:this.severity},this.note.contextId=t.id,this.createNoteForAppointment(this.note).subscribe(e=>{t.noteId=e.id,this._appointmentsService.updateAppointment(t).subscribe(()=>this.cancel(t.id))})):this.cancel(t.id)}cancel(t){this.fromEpisode&&this._episodesEventLogger.episodeAppointmentsEvent(this.episodeId,this.patientId,t,"episode_add_appointment"),this._location.back()}episodeIdUpdated(){var t,e,n,i;if(this.appointmentPurpose=void 0,null==this.episodeId)return;const a=null===(i=null===(n=null===(e=null===(t=this.selectedPatient)||void 0===t?void 0:t.patientState)||void 0===e?void 0:e.episodeState)||void 0===n?void 0:n.activeEpisodes)||void 0===i?void 0:i.find(t=>t.id===this.episodeId);this.appointmentPurposeLoading=!0,this._appointmentsService.fetchAppointmentPurpose(a.episodeType).subscribe(t=>{this.appointmentPurposeList=t,this.appointmentPurposeLoading=!1})}setTemplate(t){this.note.content=t}getNoteTemplates(t){this.noteTemplates$=this._noteTemplatesService.fetchNoteTemplates(0,100,null,t)}selectLevel(t){this.severity=t}assignAssessments(t){var e;(null===(e=this.selectedFormBlueprints)||void 0===e?void 0:e.length)&&(null==t?void 0:t.id)&&this.selectedFormBlueprints.forEach(e=>{this._formService.assignOnDemandForm(null==e?void 0:e._id,this.patientId,t.id).subscribe(t=>{var e;this._actionItemsService.archiveActionItem(null===(e=null==t?void 0:t.data)||void 0===e?void 0:e.id).subscribe()})})}}return t.\u0275fac=function(e){return new(e||t)(y.Rb(a.l),y.Rb(b.a),y.Rb(g.a),y.Rb(N.b),y.Rb(a.e),y.Rb(f.a),y.Rb(S.a),y.Rb(A.a),y.Rb(c.a),y.Rb(E.a),y.Rb(X.a),y.Rb(O.a),y.Rb(P.a))},t.\u0275cmp=y.Lb({type:t,selectors:[["app-create"]],features:[y.Cb([a.e]),y.Ab],decls:67,vars:50,consts:[[1,"appointments-card"],["nz-typography",""],["nz-row","",3,"nzGutter"],["nz-col","",3,"nzSpan"],["nzSize","large",1,"full-width",3,"nzShowSearch","ngModel","nzPlaceHolder","nzServerSearch","nzDisabled","nzCustomTemplate","ngModelChange","nzOnSearch"],[4,"ngFor","ngForOf"],["nzDisabled","","nzCustomContent","",4,"ngIf"],["defaultTemplate",""],[3,"appointmentScheduleChange"],["nz-row","",3,"nzGutter",4,"ngIf"],["nz-col","",3,"nzSpan",4,"ngIf"],[4,"ngIf"],[3,"ngModel","config","ngModelChange"],["noteEditor",""],["nz-row",""],["nz-col","","nzSpan","8"],[3,"note","onTemplateSelected"],[1,"heading-info-icon"],[1,"info-icon"],["name","infoCircle","nzTooltipTitle","Making your note important will make it highlighted and easily accessible, ensuring that you never miss an important point again.","nzTooltipPlacement","rightBottom","nz-tooltip","",1,"infoCirle"],[3,"ngModel","ngModelChange"],["nz-radio","","nzValue","IMPORTANT"],["nz-radio","","nzValue","NORMAL"],[1,"align-right"],["nzSize","large","nz-button","","nzType","primary",3,"click"],["nzCustomContent","",3,"nzLabel","nzValue"],[2,"display","flex"],[2,"width","70%"],[4,"isAccessAcrossTenantEnabled"],[2,"width","30%"],["nz-typography","","nzType","secondary",2,"color","var(--primary-color)"],["nzDisabled","","nzCustomContent",""],["name","loading","size","12px"],["nzSize","large",1,"full-width",3,"nzShowSearch","nzDisabled","ngModel","nzServerSearch","nzPlaceHolder","ngModelChange","nzOnSearch"],[4,"ngIf","ngIfElse"],["staffLoading",""],["style","width: 30%; text-align: right; color: var(--primary-color);",4,"ngIf"],[2,"width","30%","text-align","right","color","var(--primary-color)"],["nz-icon","","nzType","crown","nzTheme","outline",2,"font-size","14px"],["nz-radio-button","","nzValue","HOME_VISIT",3,"nzDisabled"],["nz-radio-button","","nzValue","VIDEO_CALL",3,"nzDisabled"],["nz-radio-button","","nzValue","AUDIO_CALL",3,"nzDisabled"],["nzSize","large",3,"ngModel","nzDisabled","ngModelChange"],["nz-radio","",3,"nzValue"],["nzSize","large","nzPlaceHolder","Select Type","nzAllowClear","",1,"full-width",3,"nzShowSearch","ngModel","ngModelChange"],[3,"nzLabel","nzValue"],["nzMode","multiple","nzPlaceHolder","Select an assessment form","nzAllowClear","","nzSize","large",3,"ngModel","ngModelChange"],["nzCustomContent","",3,"nzLabel","nzValue",4,"ngFor","ngForOf"],[1,"info-icon",2,"margin-top","10px"],["name","infoCircle","nzTooltipTitle","If you would like to complete one or more assessments during the appointment on behalf of the patient, select them from the options below.","nzTooltipPlacement","rightBottom","nz-tooltip","",1,"infoCirle"],["nz-typography","","nzType","secondary"]],template:function(t,e){if(1&t&&(y.Xb(0,"nz-card",0),y.Xb(1,"h2",1),y.Xc(2),y.jc(3,"translate"),y.Wb(),y.Sb(4,"nz-divider"),y.Sb(5,"br"),y.Xb(6,"div",2),y.Xb(7,"div",3),y.Xb(8,"strong"),y.Xc(9),y.jc(10,"translate"),y.jc(11,"translate"),y.Wb(),y.Wb(),y.Xb(12,"div",3),y.Xb(13,"strong"),y.Xc(14),y.jc(15,"translate"),y.Wb(),y.Wb(),y.Wb(),y.Xb(16,"div",2),y.Xb(17,"div",3),y.Xb(18,"nz-select",4),y.ec("ngModelChange",function(t){return e.selectedPatient=t})("ngModelChange",function(t){return e.setPatientId(t)})("nzOnSearch",function(t){return e.getUsersByQuery(t)}),y.jc(19,"translate"),y.Vc(20,tt,8,13,"ng-container",5),y.Vc(21,et,3,0,"nz-option",6),y.Wb(),y.Vc(22,it,2,1,"ng-template",null,7,y.Wc),y.Wb(),y.Xb(24,"div",3),y.Xb(25,"app-appointment-datetimepicker",8),y.ec("appointmentScheduleChange",function(t){return e.onAppointmentScheduleChange(t)}),y.Wb(),y.Wb(),y.Wb(),y.Sb(26,"br"),y.Sb(27,"br"),y.Sb(28,"br"),y.Vc(29,at,7,11,"div",9),y.Xb(30,"div",2),y.Vc(31,rt,7,12,"div",10),y.Vc(32,pt,11,14,"div",10),y.Wb(),y.Vc(33,ut,12,10,"div",9),y.Vc(34,mt,10,6,"div",9),y.jc(35,"dateCompare"),y.Vc(36,St,15,5,"ng-container",11),y.Sb(37,"br"),y.Sb(38,"br"),y.Xb(39,"div",2),y.Xb(40,"div",3),y.Xb(41,"strong"),y.Xc(42,"Notes"),y.Wb(),y.Xb(43,"angular-editor",12,13),y.ec("ngModelChange",function(t){return e.note.content=t}),y.Wb(),y.Wb(),y.Wb(),y.Sb(45,"br"),y.Xb(46,"div",14),y.Xb(47,"div",15),y.Xb(48,"app-note-template-picker",16),y.ec("onTemplateSelected",function(t){return e.setTemplate(t)}),y.Wb(),y.Wb(),y.Wb(),y.Sb(49,"br"),y.Xb(50,"div",17),y.Xc(51),y.jc(52,"translate"),y.Xb(53,"div",18),y.Sb(54,"app-icons",19),y.Wb(),y.Wb(),y.Xb(55,"nz-radio-group",20),y.ec("ngModelChange",function(t){return e.severity=t})("ngModelChange",function(t){return e.selectLevel(t)}),y.Xb(56,"label",21),y.Xc(57,"Yes"),y.Wb(),y.Xb(58,"label",22),y.Xc(59,"No"),y.Wb(),y.Wb(),y.Sb(60,"br"),y.Sb(61,"br"),y.Xb(62,"div"),y.Xb(63,"div",23),y.Xb(64,"button",24),y.ec("click",function(){return e.save()}),y.Xc(65),y.jc(66,"translate"),y.Wb(),y.Wb(),y.Wb(),y.Wb()),2&t){const t=y.Ic(23);y.Db(2),y.Yc(y.kc(3,33,"COMMON.APPOINTMENTDETAILS")),y.Db(4),y.rc("nzGutter",24),y.Db(1),y.rc("nzSpan",8),y.Db(2),y.ad("",y.kc(10,35,"PATIENT.NAME")," - ",y.kc(11,37,"TABLEHEADER.DOB"),""),y.Db(3),y.rc("nzSpan",8),y.Db(2),y.Yc(y.kc(15,39,"COMMON.DATE_TIME")),y.Db(2),y.rc("nzGutter",24),y.Db(1),y.rc("nzSpan",8),y.Db(1),y.sc("nzPlaceHolder",y.kc(19,41,"PATIENT.SEARCH")),y.rc("nzShowSearch",!0)("ngModel",e.selectedPatient)("nzServerSearch",!0)("nzDisabled",e.disablePatientSelection)("nzCustomTemplate",t),y.Db(2),y.rc("ngForOf",e.patients),y.Db(1),y.rc("ngIf",e.patientsLoading),y.Db(3),y.rc("nzSpan",8),y.Db(5),y.rc("ngIf",!e.isLoggedInUserCaretaker),y.Db(1),y.rc("nzGutter",24),y.Db(1),y.rc("ngIf",!e.isLoggedInUserCaretaker),y.Db(1),y.rc("ngIf",!1),y.Db(1),y.rc("ngIf",!(null==e.selectedPatient||null==e.selectedPatient.patientState||null==e.selectedPatient.patientState.episodeState||null==e.selectedPatient.patientState.episodeState.activeEpisodes||!e.selectedPatient.patientState.episodeState.activeEpisodes.length)),y.Db(1),y.rc("ngIf",y.lc(35,43,e.episodeId&&(null==e.appointment||null==e.appointment.schedule?null:e.appointment.schedule.startDate),"MONTH")),y.Db(2),y.rc("ngIf",e.episodeId&&"BHI"==e.episodeType||"GENERAL"==e.episodeType||"CCM"==e.episodeType),y.Db(3),y.rc("nzGutter",16),y.Db(1),y.rc("nzSpan",24),y.Db(3),y.rc("ngModel",e.note.content)("config",e.config),y.Db(5),y.rc("note",e.note.content),y.Db(3),y.Zc(" ",y.kc(52,46,"MAKE_IMPORTANT_NOTES")," "),y.Db(4),y.rc("ngModel",e.severity),y.Db(10),y.Zc(" ",e.isLoggedInUserCaretaker?"Create":y.kc(66,48,"APPOINTMENT.APPROVE")," ")}},directives:[M.a,L.a,_.a,W.c,W.a,R.d,l.u,l.x,a.p,a.q,k.a,w.a,V.a,F.a,x.d,U.c,U.b,j.a,H.a,B.a,R.a,Y.a,$.a,U.a],pipes:[q.a,Q.a,a.e,Z.a,a.b,K.a,G.a],styles:["[_nghost-%COMP%]     .ant-picker-large .ant-picker-input>input, [_nghost-%COMP%]     .ant-select, [_nghost-%COMP%]     .ant-select-selection-placeholder{font-size:14px!important}.full-width[_ngcontent-%COMP%], [_nghost-%COMP%]     .ant-calendar-picker{width:100%!important}.appointments-card[_ngcontent-%COMP%]{margin:2%;padding:2%}.align-right[_ngcontent-%COMP%]{display:flex;justify-content:flex-start;text-align:right;margin-top:1vw}.heading-info-icon[_ngcontent-%COMP%]{display:flex}.info-icon[_ngcontent-%COMP%]{margin-left:10px}"]}),t})();var At=n("DfQf"),vt=n("Gskk"),Tt=n("M34a"),It=n("piIK"),Dt=n("9ig3"),Ct=n("jKzE"),Et=n("pLZG"),Xt=n("ix5O");function Ot(t,e){if(1&t&&y.Sb(0,"nz-option",11),2&t){const t=e.$implicit;y.uc("nzLabel","",null==t?null:t.firstName," ",null==t?null:t.lastName,""),y.rc("nzValue",t)}}function Pt(t,e){if(1&t&&(y.Vb(0),y.Vc(1,Ot,1,3,"nz-option",10),y.Ub()),2&t){const t=y.ic();y.Db(1),y.rc("ngForOf",t.caretakers)}}function yt(t,e){1&t&&(y.Xb(0,"nz-option",12),y.Sb(1,"app-icons",13),y.Xc(2," Loading Data... "),y.Wb())}let Nt=(()=>{class t{constructor(t){this._appointmentsService=t}disabledStartHours(){return Array.from(Array(24).keys()).filter(t=>{var e;return t<(null===(e=new Date(this.dateTime))||void 0===e?void 0:e.getHours())})}disabledEndHours(){return Array.from(Array(24).keys()).filter(t=>{var e;return t<(null===(e=this.startTime)||void 0===e?void 0:e.getHours())})}disabledStartMins(){return Array.from(Array(60).keys()).filter(t=>{var e;return t<(null===(e=new Date(this.dateTime))||void 0===e?void 0:e.getMinutes())})}disabledEndMins(){return Array.from(Array(60).keys()).filter(t=>{var e;return t<(null===(e=this.startTime)||void 0===e?void 0:e.getMinutes())})}ngOnInit(){this.startTime=this.dateTime,this.endTime=this.dateTime}onTimeChange(){this.selectedCaretaker=null,this.searchCaretakers("")}searchCaretakers(t){var e,n;this.loading=!0,this._appointmentsService.fetchAvailableCaretakers(null===(e=this.startTime)||void 0===e?void 0:e.getTime(),null===(n=this.endTime)||void 0===n?void 0:n.getTime(),0,10,t).subscribe(t=>{this.caretakers=t,this.loading=!1})}}return t.\u0275fac=function(e){return new(e||t)(y.Rb(g.a))},t.\u0275cmp=y.Lb({type:t,selectors:[["app-confirmation"]],inputs:{dateTime:"dateTime"},decls:14,vars:15,consts:[["nz-row","","nzGutter","16"],["nz-col","","nzSpan","6"],["nzFormat","HH:mm","nzMinuteStep","5","nzPlaceHolder","Start Time",1,"actions",3,"ngModel","nzDisabledHours","nzDisabledMinutes","ngModelChange"],["nzFormat","HH:mm","nzMinuteStep","5","nzPlaceHolder","End Time",1,"actions",3,"ngModel","nzDisabledHours","nzDisabledMinutes","ngModelChange"],["nz-col","","nzSpan","12"],[1,"actions",3,"nzShowSearch","nzPlaceHolder","ngModel","nzServerSearch","nzDisabled","ngModelChange","nzOnSearch"],[4,"ngIf"],["nzDisabled","","nzCustomContent","",4,"ngIf"],["nz-typography","","nzType","secondary"],["name","infoCircle","size","12px"],[3,"nzLabel","nzValue",4,"ngFor","ngForOf"],[3,"nzLabel","nzValue"],["nzDisabled","","nzCustomContent",""],["name","loading","size","12px"]],template:function(t,e){1&t&&(y.Xb(0,"div",0),y.Xb(1,"div",1),y.Xb(2,"nz-time-picker",2),y.ec("ngModelChange",function(t){return e.startTime=t})("ngModelChange",function(){return e.onTimeChange()}),y.Wb(),y.Wb(),y.Xb(3,"div",1),y.Xb(4,"nz-time-picker",3),y.ec("ngModelChange",function(t){return e.endTime=t})("ngModelChange",function(){return e.onTimeChange()}),y.Wb(),y.Wb(),y.Xb(5,"div",4),y.Xb(6,"nz-select",5),y.ec("ngModelChange",function(t){return e.selectedCaretaker=t})("nzOnSearch",function(t){return e.searchCaretakers(t)}),y.jc(7,"translate"),y.Vc(8,Pt,2,1,"ng-container",6),y.Vc(9,yt,3,0,"nz-option",7),y.Wb(),y.Wb(),y.Wb(),y.Sb(10,"br"),y.Xb(11,"em",8),y.Sb(12,"app-icons",9),y.Xc(13," Please choose a suitable start time and end time for the appointment to get the list of available staff members\n"),y.Wb()),2&t&&(y.Db(2),y.rc("ngModel",e.startTime)("nzDisabledHours",e.disabledStartHours)("nzDisabledMinutes",e.disabledStartMins),y.Db(2),y.rc("ngModel",e.endTime)("nzDisabledHours",e.disabledEndHours)("nzDisabledMinutes",e.disabledEndMins),y.Db(2),y.sc("nzPlaceHolder",y.kc(7,13,"COMMON.AVAILABLE_CLINICIANS")),y.rc("nzShowSearch",!0)("ngModel",e.selectedCaretaker)("nzServerSearch",!0)("nzDisabled",!e.endTime),y.Db(2),y.rc("ngIf",!e.loading),y.Db(1),y.rc("ngIf",e.loading))},directives:[W.c,W.a,Xt.a,l.u,l.x,R.d,a.q,L.a,F.a,a.p,R.a],pipes:[q.a],styles:[".actions[_ngcontent-%COMP%]{width:100%}"]}),t})();var Mt=n("dEAy"),Lt=n("PTRe");const _t=function(){return{minRows:6}};let Wt=(()=>{class t{constructor(t){this._modalRef=t}addReason(){this._modalRef.close(this.reason)}}return t.\u0275fac=function(e){return new(e||t)(y.Rb(Mt.e))},t.\u0275cmp=y.Lb({type:t,selectors:[["app-add-reason"]],inputs:{reason:"reason"},decls:11,vars:12,consts:[["nz-typography",""],["nz-input","",3,"placeholder","ngModel","nzAutosize","ngModelChange"],["nz-button","","nzType","primary",1,"add-reason-button",3,"click"]],template:function(t,e){1&t&&(y.Xb(0,"h2",0),y.Xc(1),y.jc(2,"translate"),y.Wb(),y.Sb(3,"nz-divider"),y.Xb(4,"textarea",1),y.ec("ngModelChange",function(t){return e.reason=t}),y.jc(5,"translate"),y.Wb(),y.Sb(6,"br"),y.Sb(7,"br"),y.Xb(8,"button",2),y.ec("click",function(){return e.addReason()}),y.Xc(9),y.jc(10,"translate"),y.Wb()),2&t&&(y.Db(1),y.Yc(y.kc(2,5,"COMMON.ADDREASON")),y.Db(3),y.sc("placeholder",y.kc(5,7,"APPOINTMENT.ADDREASON")),y.rc("ngModel",e.reason)("nzAutosize",y.xc(11,_t)),y.Db(5),y.Yc(y.kc(10,9,"COMMON.ADD")))},directives:[L.a,_.a,Lt.b,l.d,Lt.a,l.u,l.x,j.a,H.a,B.a],pipes:[q.a],styles:[".add-reason-button[_ngcontent-%COMP%]{margin-left:90%;width:10%}"]}),t})();class Rt{}var kt=function(t){return t.PENDING="PENDING",t.REJECTED="REJECTED",t.APPROVED="APPROVED",t.DELETED="DELETED",t.FINISHED="FINISHED",t.ALL="ALL",t.ON_HOLD="ON_HOLD",t}({}),wt=n("FWPb"),Vt=n("QBjw"),Ft=n("FVa/"),xt=n("xnfs");let Ut=(()=>{class t extends u.a{constructor(t,e,n){super(),this._smsService=t,this._notificationsService=e,this._modalRef=n}validateMessage(){return this.message||this._notificationsService.error("SMS","Message cannot be empty!"),!!this.message}sendSMS(){if(!this.validateMessage)return;const t=new xt.a;t.message=this.message,t.toUsers=[this.patientId],t.fromUser=localStorage.getItem("loggedInUser"),this._smsService.sendSms(t).subscribe(()=>{this._notificationsService.success("SMS","SMS sent successfully!"),this._modalRef.close(!0)})}}return t.\u0275fac=function(e){return new(e||t)(y.Rb(Ft.a),y.Rb(N.b),y.Rb(Mt.e))},t.\u0275cmp=y.Lb({type:t,selectors:[["app-sms-sender"]],inputs:{patientId:"patientId",message:"message"},features:[y.Ab],decls:9,vars:4,consts:[["nz-row",""],["nz-col","","nzSpan","24"],["rows","4","nz-input","",3,"ngModel","ngModelChange"],["nz-col","","nzSpan","7","nzOffset","19"],["nz-button","","nzType","primary",3,"click"]],template:function(t,e){1&t&&(y.Xb(0,"div",0),y.Xb(1,"div",1),y.Xb(2,"textarea",2),y.ec("ngModelChange",function(t){return e.message=t}),y.Wb(),y.Wb(),y.Wb(),y.Sb(3,"br"),y.Xb(4,"div",0),y.Xb(5,"div",3),y.Xb(6,"button",4),y.ec("click",function(){return e.sendSMS()}),y.Xc(7),y.jc(8,"translate"),y.Wb(),y.Wb(),y.Wb()),2&t&&(y.Db(2),y.rc("ngModel",e.message),y.Db(5),y.Zc(" ",y.kc(8,2,"SMS.SEND_SMS")," "))},directives:[W.c,W.a,Lt.b,l.d,l.u,l.x,j.a,H.a,B.a],pipes:[q.a],styles:["textarea[_ngcontent-%COMP%]{resize:none}"]}),t})();var jt=n("WoUL");let Ht=(()=>{class t{}return t.APPOINTMENT_CREATE_STRINGS=new Array("APPOINTMENT.CONFIRM_APPOINTMENT","VIDEO_CALL","EPISODE.HOMEVISIT","AUDIO_CALL","FORM.APPOINTMENT","APPOINTMENT.NO_CLINICIAN_SELECTED","APPOINTMENT.CLINICIAN_ADDED_APPOINTMENT_APPROVED","APPOINTMENT.REJECT_APPOINTMENT","APPOINTMENT.REJECT_APPOINTMENT_POPUP","APPOINTMENT.MARKED_REJECTED","APPOINTMENT.DELETE_APPOINTMENT","APPOINTMENT.REMOVE_APPOINTMENT","APPOINTMENT.APPOINTMENT_DELETE","APPOINTMENT.REASON_ADDED_SUCCESSFULLY","VIDEOCALL.ERROR.APPOINTMENT_FUTURE_SCHEDULE","VIDEOCALL.ERROR.ALREADY_IN_CALL","VIDEOCALL.ERROR.ALREADY_ANOTHER_CALL","VIDEOCALL.ERROR.POPUP_BLOCKED","VIDEOCALL.ERROR.POPUP_BLOCKER_MESSAGE","COMMON.INVALID_SESSION","COMMON.SESSION_EXPIRED"),t})();var Bt=n("gssi"),Yt=n("HZ0a"),$t=n("7t9/"),qt=n("2lmJ"),Qt=n("nLCl"),Zt=n("KC2T"),Kt=n("4RGM");function Gt(t,e){if(1&t&&(y.Xb(0,"span"),y.Xc(1),y.Wb()),2&t){const t=y.ic();y.Db(1),y.ad(" between ",t.dateRange[0].toISOString().slice(0,10)," and ",t.dateRange[1].toISOString().slice(0,10)," ")}}let Jt=(()=>{class t{constructor(t,e,n){this._modalRef=t,this._appointmentsService=e,this._notificationsService=n,this.dateRange=null,this.loadingDelete=!1}ngOnInit(){}cancel(){this._modalRef.destroy(!1)}deleteAppointments(){var t,e,n,i;let a,s;this.loadingDelete=!0,this.activeRoleName=localStorage.getItem("loggedInUserRoleName"),this.dateRange&&this.dateRange[0]&&(a=this.datePreset?null===(t=this.dateRange[0])||void 0===t?void 0:t.getTime():null===(e=Object(Tt.a)(this.dateRange[0]))||void 0===e?void 0:e.getTime()),this.dateRange&&this.dateRange[1]&&(s=this.datePreset?null===(n=this.dateRange[1])||void 0===n?void 0:n.getTime():null===(i=Object(It.a)(this.dateRange[1]))||void 0===i?void 0:i.getTime()),this._appointmentsService.deleteAppointments(0,1e3,null,null,a,s,null,null,this.requestTenantIds).subscribe(()=>{this.loadingDelete=!1,this._modalRef.destroy(!0),this._notificationsService.success("Clear Appointments","Appointments deleted successfully!")},t=>{this._notificationsService.error("Clear Appointments","Error while deleting appointments."),this._modalRef.destroy(!1)})}}return t.\u0275fac=function(e){return new(e||t)(y.Rb(Mt.e),y.Rb(g.a),y.Rb(N.b))},t.\u0275cmp=y.Lb({type:t,selectors:[["app-delete-appointments"]],inputs:{dateRange:"dateRange",datePreset:"datePreset",requestTenantIds:"requestTenantIds"},decls:12,vars:2,consts:[[4,"ngIf"],[1,"btn-container"],["nz-button","","nzType","primary",3,"nzLoading","click"],["nz-button","","nzType","default",2,"margin-left","10px",3,"click"]],template:function(t,e){1&t&&(y.Vb(0),y.Xb(1,"h3"),y.Xc(2," Clear Appointments"),y.Wb(),y.Xb(3,"p"),y.Xc(4,"Are you sure you want to clear all un-attended appointments"),y.Vc(5,Gt,2,2,"span",0),y.Xc(6,"? This action cannot be reversed. "),y.Wb(),y.Xb(7,"div",1),y.Xb(8,"button",2),y.ec("click",function(){return e.deleteAppointments()}),y.Xc(9," Yes "),y.Wb(),y.Xb(10,"button",3),y.ec("click",function(){return e.cancel()}),y.Xc(11," No "),y.Wb(),y.Wb(),y.Ub()),2&t&&(y.Db(5),y.rc("ngIf",e.dateRange[0]&&e.dateRange[1]),y.Db(3),y.rc("nzLoading",e.loadingDelete))},directives:[a.q,j.a,H.a,B.a],styles:[".btn-container[_ngcontent-%COMP%]{margin-top:30px;display:flex;justify-content:flex-end}"]}),t})();var te=n("BoNt"),ee=n("oyxB"),ne=n("0lU3"),ie=n("rMZv"),ae=n("ZKr6"),se=n("ALyH"),oe=n("wjar"),ce=n("0zwC"),le=n("Ujc4"),re=n("QlLE");function pe(t,e){if(1&t&&y.Sb(0,"app-staff-sub-tenants",38),2&t){const t=y.ic(3);y.rc("staffName",t.selectedStaffDetail.fullName)("assignedTenantIds",t.selectedStaffDetail.assignedTenantIds)}}function de(t,e){if(1&t&&(y.Vb(0),y.Vc(1,pe,1,2,"app-staff-sub-tenants",37),y.Ub()),2&t){const t=y.ic(2);y.Db(1),y.rc("ngIf",t.selectedStaffDetail)}}function ue(t,e){1&t&&(y.Vb(0),y.Vc(1,de,2,1,"ng-container",16),y.Ub())}function be(t,e){if(1&t&&y.Sb(0,"nz-option",40),2&t){const t=e.$implicit;y.rc("nzValue",null==t?null:t.id)("nzLabel",null==t?null:t.name)}}function he(t,e){if(1&t&&(y.Vb(0),y.Vc(1,be,1,2,"nz-option",39),y.Ub()),2&t){const t=y.ic();y.Db(1),y.rc("ngForOf",t.siteList)}}function me(t,e){1&t&&(y.Xb(0,"nz-option",41),y.Sb(1,"span",42),y.Xc(2," Loading Data... "),y.Wb())}function ge(t,e){if(1&t&&y.Sb(0,"nz-option",40),2&t){const t=e.$implicit;y.rc("nzValue",null==t?null:t.id)("nzLabel",null==t?null:t.fullName)}}function fe(t,e){if(1&t&&(y.Vb(0),y.Vc(1,ge,1,2,"nz-option",39),y.Ub()),2&t){const t=y.ic();y.Db(1),y.rc("ngForOf",t.staffList)}}function Se(t,e){1&t&&(y.Xb(0,"nz-option",41),y.Sb(1,"span",42),y.Xc(2," Loading Data... "),y.Wb())}function ze(t,e){1&t&&(y.Xb(0,"th"),y.Xc(1," Sub Tenant "),y.Wb())}function Ae(t,e){if(1&t&&y.Sb(0,"app-icons",58),2&t){const t=y.ic(3);y.rc("nzTooltipTitle",t.timerRunning?"End Appointment Timer":"Start Appointment Timer")}}function ve(t,e){if(1&t){const t=y.Yb();y.Xb(0,"span"),y.Xb(1,"a",56),y.ec("click",function(){y.Lc(t);const e=y.ic().$implicit;return y.ic().startTimer(e)}),y.Vc(2,Ae,1,1,"app-icons",57),y.Wb(),y.Wb()}if(2&t){const t=y.ic().$implicit,e=y.ic();y.Db(1),y.rc("disabled",!(null!=t&&t.enabled)),y.Db(1),y.rc("ngIf",!(e.timerRunning||null!=e.timedAppointment&&e.timedAppointment.attendeeId))}}function Te(t,e){1&t&&y.Sb(0,"app-icons",62)}function Ie(t,e){if(1&t&&(y.Xb(0,"span",59),y.Xb(1,"a",60),y.Vc(2,Te,1,0,"app-icons",61),y.Wb(),y.Wb()),2&t){const t=y.ic(2);y.rc("nzTooltipTitle","Timer will be enabled on the day of the appointment"),y.Db(1),y.rc("disabled",!0),y.Db(1),y.rc("ngIf",!(t.timerRunning||null!=t.timedAppointment&&t.timedAppointment.attendeeId))}}function De(t,e){if(1&t){const t=y.Yb();y.Vb(0),y.Xb(1,"app-audio-call-widget",63),y.ec("click",function(){y.Lc(t);const e=y.ic().$implicit;return y.ic().logAction("audio_call",null==e?null:e.attendeeId)}),y.Wb(),y.Ub()}if(2&t){const t=y.ic().$implicit;y.Db(1),y.rc("userId",null==t?null:t.attendeeId)("phoneNumbers",null==t?null:t.phoneNumbers)("disabled",!1)("renderVital",!1)("appointmentId",null==t?null:t.id)}}function Ce(t,e){if(1&t&&(y.Xb(0,"td"),y.Xc(1),y.jc(2,"tenantName"),y.Wb()),2&t){const t=y.ic().$implicit;y.Db(1),y.Zc(" ",y.kc(2,1,t.tenantId)," ")}}function Ee(t,e){if(1&t){const t=y.Yb();y.Xb(0,"app-icons",65),y.ec("click",function(){y.Lc(t);const e=y.ic(2).$implicit;return y.ic().initiateVideoCall(null==e?null:e.attendeeId,e)}),y.Wb()}}const Xe=function(){return["VIDEO_CALL"]};function Oe(t,e){1&t&&(y.Vb(0),y.Vc(1,Ee,1,0,"app-icons",64),y.Sb(2,"nz-divider",50),y.Ub()),2&t&&(y.Db(1),y.rc("isFeaturePermitted",y.xc(1,Xe)))}function Pe(t,e){if(1&t){const t=y.Yb();y.Xb(0,"app-icons",66),y.ec("click",function(){y.Lc(t);const e=y.ic().$implicit;return y.ic().viewAppointmentDetails(null==e?null:e.id)}),y.Wb()}}function ye(t,e){if(1&t){const t=y.Yb();y.Xb(0,"app-icons",67),y.ec("click",function(){y.Lc(t);const e=y.ic().$implicit;return y.ic().rescheduleAppointment(e)}),y.Wb()}}function Ne(t,e){if(1&t){const t=y.Yb();y.Xb(0,"app-icons",68),y.ec("click",function(){y.Lc(t);const e=y.ic().$implicit;return y.ic().deleteAppointment(null==e?null:e.id)}),y.Wb()}}const Me=function(){return["VIEW_APPOINTMENT"]},Le=function(){return["RESCHEDULE_APPOINTMENT"]},_e=function(){return["DELETE_APPOINTMENT"]};function We(t,e){if(1&t){const t=y.Yb();y.Xb(0,"tr"),y.Xb(1,"td"),y.Vb(2),y.Vc(3,ve,3,2,"span",5),y.jc(4,"dateCompare"),y.Vc(5,Ie,3,3,"span",43),y.jc(6,"dateCompare"),y.Ub(),y.Wb(),y.Xb(7,"td"),y.Xc(8),y.Wb(),y.Xb(9,"td",44),y.Xb(10,"span",45),y.Xc(11),y.Wb(),y.Wb(),y.Xb(12,"td"),y.Sb(13,"app-patient-status-tag",46),y.Wb(),y.Xb(14,"td"),y.Vc(15,De,2,5,"ng-container",5),y.Xb(16,"app-icons",47),y.ec("click",function(){y.Lc(t);const n=e.$implicit;return y.ic().sendSMS(null==n?null:n.attendeeId,null==n?null:n.attenderName,null==n||null==n.schedule?null:n.schedule.startDate,null==n?null:n.type,null==n?null:n.id)}),y.Wb(),y.Wb(),y.Vc(17,Ce,3,3,"td",16),y.Xb(18,"td",48),y.Xb(19,"span",45),y.Xc(20),y.Wb(),y.Wb(),y.Xb(21,"td"),y.Xc(22),y.jc(23,"date"),y.Wb(),y.Xb(24,"td"),y.Xb(25,"span",45),y.jc(26,"purposeLabel"),y.Xc(27),y.jc(28,"purposeLabel"),y.Wb(),y.Wb(),y.Xb(29,"td"),y.Xc(30),y.Wb(),y.Xb(31,"td",19),y.Vb(32),y.Xb(33,"app-icons",49),y.ec("click",function(){y.Lc(t);const n=e.$implicit;return y.ic().showHistory("NON_COMPLEX_TMS",n)}),y.Wb(),y.Sb(34,"nz-divider",50),y.Ub(),y.Vc(35,Oe,3,2,"ng-container",5),y.Vc(36,Pe,1,0,"app-icons",51),y.Sb(37,"nz-divider",50),y.Vc(38,ye,1,0,"app-icons",52),y.Sb(39,"nz-divider",50),y.Vc(40,Ne,1,0,"app-icons",53),y.Sb(41,"nz-divider",50),y.Xb(42,"app-icons",54),y.ec("click",function(){y.Lc(t);const n=e.$implicit;return y.ic().showNotesHistory(n)}),y.Wb(),y.Sb(43,"nz-divider",50),y.Xb(44,"app-icons",55),y.ec("click",function(){y.Lc(t);const n=e.$implicit;return y.ic().gotoManageEpisodes(null==n?null:n.episodeId,null==n?null:n.attendeeId)}),y.Wb(),y.Wb(),y.Wb()}if(2&t){const t=e.$implicit,n=y.ic();y.Db(3),y.rc("ngIf",y.lc(4,18,null==t||null==t.schedule?null:t.schedule.startDate,"TODAY")),y.Db(2),y.rc("ngIf",!y.lc(6,21,null==t||null==t.schedule?null:t.schedule.startDate,"TODAY")),y.Db(3),y.Yc((null==t?null:t.episodeType)||"N/A"),y.Db(1),y.tc("routerLink","/patient/view/",null==t?null:t.attendeeId,""),y.Db(1),y.sc("nzTooltipTitle",(null==t?null:t.attendeeName)||"N/A"),y.Db(1),y.Zc(" ",(null==t?null:t.attendeeName)||"N/A"," "),y.Db(2),y.rc("patientStatus",null==t?null:t.patientStatus),y.Db(2),y.rc("ngIf","AUDIO_CALL"===(null==t?null:t.type)&&n.isCallButtonEnabled),y.Db(4),y.sc("nzTooltipTitle",(null==t?null:t.attenderName)||"N/A"),y.Db(1),y.Zc(" ",(null==t?null:t.attenderName)||"N/A"," "),y.Db(2),y.Yc(y.lc(23,24,null==t||null==t.schedule?null:t.schedule.startDate,"MMM dd, hh:mm a")),y.Db(3),y.sc("nzTooltipTitle",y.kc(26,27,null==t?null:t.appointmentPurpose)),y.Db(2),y.Zc(" ",y.kc(28,29,null==t?null:t.appointmentPurpose)," "),y.Db(3),y.Yc(null==t?null:t.attemptCount),y.Db(5),y.rc("ngIf","VIDEO_CALL"===(null==t?null:t.type)&&n.isCallButtonEnabled),y.Db(1),y.rc("isFeaturePermitted",y.xc(31,Me)),y.Db(2),y.rc("isFeaturePermitted",y.xc(32,Le)),y.Db(2),y.rc("isFeaturePermitted",y.xc(33,_e))}}function Re(t,e){1&t&&(y.Xb(0,"th"),y.Xc(1," Sub Tenant "),y.Wb())}function ke(t,e){if(1&t&&(y.Xb(0,"td"),y.Xc(1),y.jc(2,"tenantName"),y.Wb()),2&t){const t=y.ic().$implicit;y.Db(1),y.Zc(" ",y.kc(2,1,t.tenantId)," ")}}function we(t,e){if(1&t){const t=y.Yb();y.Xb(0,"app-icons",70),y.ec("click",function(){y.Lc(t);const e=y.ic().$implicit;return y.ic().viewAppointmentDetails(null==e?null:e.id)}),y.Wb()}}function Ve(t,e){if(1&t&&(y.Xb(0,"tr"),y.Xb(1,"td"),y.Xc(2),y.Wb(),y.Xb(3,"td"),y.Xc(4),y.Wb(),y.Xb(5,"td"),y.Sb(6,"app-patient-status-tag",46),y.Wb(),y.Vc(7,ke,3,3,"td",16),y.Xb(8,"td",48),y.Xc(9),y.Wb(),y.Xb(10,"td"),y.Xc(11),y.jc(12,"date"),y.Wb(),y.Xb(13,"td"),y.Xc(14),y.jc(15,"purposeLabel"),y.Wb(),y.Xb(16,"td"),y.Xc(17),y.Wb(),y.Xb(18,"td",19),y.Vc(19,we,1,0,"app-icons",69),y.Wb(),y.Wb()),2&t){const t=e.$implicit;y.Db(2),y.Yc(null==t?null:t.episodeType),y.Db(2),y.Yc((null==t?null:t.attendeeName)||"N/A"),y.Db(2),y.rc("patientStatus",null==t?null:t.patientStatus),y.Db(3),y.Yc((null==t?null:t.attenderName)||"N/A"),y.Db(2),y.Yc(y.lc(12,8,null==t||null==t.schedule?null:t.schedule.startDate,"MMM dd yyyy, hh:mm a")),y.Db(3),y.Yc(y.kc(15,11,null==t?null:t.appointmentPurpose)),y.Db(3),y.Yc(null==t?null:t.attemptCount),y.Db(2),y.rc("isFeaturePermitted",y.xc(13,Me))}}function Fe(t,e){if(1&t){const t=y.Yb();y.Xb(0,"div",71),y.Xb(1,"button",72),y.ec("click",function(){return y.Lc(t),y.ic().clearUnattendedAppointments()}),y.Xc(2," Clear Appointments "),y.Wb(),y.Wb()}if(2&t){const t=y.ic();y.Db(1),y.rc("disabled",0===t.unattendedAppointments.result.length)}}function xe(t,e){1&t&&(y.Xb(0,"th"),y.Xc(1," Sub Tenant "),y.Wb())}function Ue(t,e){if(1&t&&(y.Xb(0,"td"),y.Xc(1),y.jc(2,"tenantName"),y.Wb()),2&t){const t=y.ic().$implicit;y.Db(1),y.Zc(" ",y.kc(2,1,t.tenantId)," ")}}function je(t,e){if(1&t){const t=y.Yb();y.Xb(0,"app-icons",70),y.ec("click",function(){y.Lc(t);const e=y.ic().$implicit;return y.ic().viewAppointmentDetails(null==e?null:e.id)}),y.Wb()}}function He(t,e){if(1&t){const t=y.Yb();y.Xb(0,"app-icons",74),y.ec("click",function(){y.Lc(t);const e=y.ic().$implicit;return y.ic().editReasonForUnattendedAppointment(e)}),y.Wb()}}function Be(t,e){if(1&t){const t=y.Yb();y.Xb(0,"app-icons",67),y.ec("click",function(){y.Lc(t);const e=y.ic(2).$implicit;return y.ic().rescheduleAppointment(e)}),y.Wb()}}function Ye(t,e){1&t&&(y.Vb(0),y.Sb(1,"nz-divider",50),y.Vc(2,Be,1,0,"app-icons",52),y.Ub()),2&t&&(y.Db(2),y.rc("isFeaturePermitted",y.xc(1,Le)))}const $e=function(){return["EDIT_APPOINTMENT"]};function qe(t,e){if(1&t&&(y.Xb(0,"tr"),y.Xb(1,"td"),y.Xc(2),y.Wb(),y.Xb(3,"td"),y.Xc(4),y.Wb(),y.Xb(5,"td"),y.Sb(6,"app-patient-status-tag",46),y.Wb(),y.Vc(7,Ue,3,3,"td",16),y.Xb(8,"td",48),y.Xc(9),y.Wb(),y.Xb(10,"td"),y.Xc(11),y.jc(12,"date"),y.Wb(),y.Xb(13,"td"),y.Xc(14),y.jc(15,"purposeLabel"),y.Wb(),y.Xb(16,"td"),y.Xc(17),y.Wb(),y.Xb(18,"td"),y.Xc(19),y.Wb(),y.Xb(20,"td",19),y.Vc(21,je,1,0,"app-icons",69),y.Sb(22,"nz-divider",50),y.Vc(23,He,1,0,"app-icons",73),y.Vc(24,Ye,3,2,"ng-container",5),y.jc(25,"dateCompare"),y.Wb(),y.Wb()),2&t){const t=e.$implicit;y.Db(2),y.Yc(null==t?null:t.episodeType),y.Db(2),y.Yc((null==t?null:t.attendeeName)||"N/A"),y.Db(2),y.rc("patientStatus",null==t?null:t.patientStatus),y.Db(3),y.Yc((null==t?null:t.attenderName)||"N/A"),y.Db(2),y.Yc(y.lc(12,11,null==t||null==t.schedule?null:t.schedule.startDate,"MMM dd yyyy, hh:mm a")),y.Db(3),y.Yc(y.kc(15,14,null==t?null:t.appointmentPurpose)),y.Db(3),y.Yc(null==t?null:t.attemptCount),y.Db(2),y.Yc((null==t?null:t.reason)||"N/A"),y.Db(2),y.rc("isFeaturePermitted",y.xc(19,Me)),y.Db(2),y.rc("isFeaturePermitted",y.xc(20,$e)),y.Db(1),y.rc("ngIf",y.lc(25,16,null==t||null==t.schedule?null:t.schedule.startDate,"MONTH_OR_FUTURE"))}}function Qe(t,e){if(1&t&&y.Sb(0,"nz-option",40),2&t){const t=e.$implicit;y.rc("nzValue",null==t?null:t.id)("nzLabel",null==t?null:t.fullName)}}function Ze(t,e){if(1&t&&(y.Vb(0),y.Vc(1,Qe,1,2,"nz-option",39),y.Ub()),2&t){const t=y.ic(2);y.Db(1),y.rc("ngForOf",t.staffList)}}function Ke(t,e){1&t&&(y.Xb(0,"nz-option",41),y.Sb(1,"span",42),y.Xc(2," Loading Data... "),y.Wb())}function Ge(t,e){if(1&t){const t=y.Yb();y.Xb(0,"div",6),y.Xb(1,"nz-select",10),y.ec("ngModelChange",function(e){return y.Lc(t),y.ic().selectedStaff=e})("ngModelChange",function(){return y.Lc(t),y.ic().getPatientsWithoutAppointments()}),y.Vc(2,Ze,2,1,"ng-container",8),y.Vc(3,Ke,3,0,"ng-template",null,11,y.Wc),y.Wb(),y.Wb()}if(2&t){const t=y.Ic(4),e=y.ic();y.Db(1),y.rc("ngModel",e.selectedStaff),y.Db(1),y.rc("ngIf",null==e.staffList?null:e.staffList.length)("ngIfElse",t)}}function Je(t,e){1&t&&(y.Xb(0,"th"),y.Xc(1," Sub Tenant "),y.Wb())}function tn(t,e){if(1&t&&(y.Xb(0,"td"),y.Xc(1),y.jc(2,"tenantName"),y.Wb()),2&t){const t=y.ic().$implicit;y.Db(1),y.Zc(" ",y.kc(2,1,t.tenantId)," ")}}const en=function(t){return{episodeId:t}};function nn(t,e){if(1&t&&(y.Xb(0,"tr"),y.Xb(1,"td"),y.Xc(2),y.Wb(),y.Xb(3,"td",44),y.Xc(4),y.Wb(),y.Xb(5,"td"),y.Xc(6),y.Wb(),y.Xb(7,"td"),y.Vb(8),y.Xb(9,"div",75),y.Xb(10,"span",59),y.jc(11,"userLocations"),y.Xc(12),y.jc(13,"titlecase"),y.jc(14,"userLocations"),y.Wb(),y.Wb(),y.Ub(),y.Wb(),y.Vc(15,tn,3,3,"td",16),y.Xb(16,"td",76),y.Xb(17,"a",77),y.Xc(18,"Create Appointment"),y.Wb(),y.Wb(),y.Wb()),2&t){const t=e.$implicit,n=y.ic();y.Db(2),y.Yc((null==t||null==t.patientState||null==t.patientState.episodeState||null==t.patientState.episodeState.activeEpisodes[0]?null:t.patientState.episodeState.activeEpisodes[0].episodeType)||"N/A"),y.Db(1),y.tc("routerLink","/patient/view/",null==t?null:t.id,""),y.Db(1),y.bd(" ",null==t?null:t.firstName," ",null==t?null:t.middleName," ",null==t?null:t.lastName," "),y.Db(2),y.Zc(" ",(null==t||null==t.patientState||null==t.patientState.lastServiceDates?null:t.patientState.lastServiceDates.COMPLEX_CCM)||(null==t||null==t.patientState||null==t.patientState.lastServiceDates?null:t.patientState.lastServiceDates.CCM)||"N/A"," "),y.Db(4),y.rc("nzTooltipTitle",y.kc(11,11,null==t?null:t.locations)||"-"),y.Db(2),y.Zc(" ",y.kc(13,13,y.kc(14,15,null==t?null:t.locations))," "),y.Db(4),y.tc("routerLink","/appointments/create/",null==t?null:t.id,""),y.rc("queryParams",y.yc(17,en,(null==t||null==t.patientState||null==t.patientState.episodeState||null==t.patientState.episodeState.activeEpisodes[0]?null:t.patientState.episodeState.activeEpisodes[0].id)||"")),y.Db(1),y.rc("nzSize",n.size)}}function an(t,e){1&t&&(y.Xb(0,"span"),y.Xc(1),y.jc(2,"translate"),y.Wb()),2&t&&(y.Db(1),y.Zc(" ",y.kc(2,1,"COMMON.NODATA")," "))}function sn(t,e){if(1&t&&(y.Xb(0,"nz-empty",78),y.Vc(1,an,3,3,"ng-template",null,79,y.Wc),y.Wb()),2&t){const t=y.Ic(2);y.rc("nzNotFoundImage","https://gw.alipayobjects.com/mdn/miniapp_social/afts/img/A*pevERLJC9v0AAAAAAAAAAABjAQAAAQ/original")("nzNotFoundContent",t)}}const on=function(){return[10,50,100,150,200]},cn=function(){return["ascend","descend"]},ln=function(){return["CLEAR_UNATTENDED_APPOINTMENT"]},rn=function(){return[5,50,100,150,200]};let pn=(()=>{class t extends u.a{constructor(t,e,n,i,a,s,o,c,l,r,p,u,b,h,m){super(),this._appointmentsService=t,this._appointmentModalService=e,this._router=n,this._episodeService=i,this._activatedRoute=a,this._notificationsService=s,this._modalService=o,this._videoCallService=c,this._dataSharingService=l,this._staffService=r,this.translationService=p,this._datePipe=u,this._appointmentsEventLogger=b,this._patientsEventLogger=h,this._siteService=m,this.appointmentsRequests=new Rt,this.upcomingAppointments=new Vt.a,this.completedAppointments=new Vt.a,this.unattendedAppointments=new Vt.a,this.rejectedAppointments=new Rt,this.noAppointmentPatients=[],this.filteredNoAppointmentPatients=[],this.isCallButtonEnabled=!0,this.pageSize=10,this.pageIndex=1,this.dateRange=[],this.appointmentLoading={},this.appointmentFetchQuery={startTime:null,endTime:null,staffId:null,searchTerm:null,tab:"upcoming"},this.selectedTabIndex=0,this.tabIndex=new Map([[0,"upcoming"],[1,"completed"],[2,"unattended"],[3,"no-appointment"],[4,"rejected"]]),this.filterAttempt=[],this.MAX_ATTEMPT_COUNT=10,this.notesMap=new Map,this.expandSet=new Set,this.editCache={},this.queryParamInitialised=!1,this.staffIdMap=new Map,this.onSelectedTabIndexChange=t=>{this.pageIndex=1,this.clearSearch(),this.changeTab(t)},this.appointmentsRequests.result=[],this.upcomingAppointments.result=[],this.completedAppointments.result=[],this.unattendedAppointments.result=[],this.rejectedAppointments.result=[];for(let d=0;d<=this.MAX_ATTEMPT_COUNT;d++){const t={text:d.toString(),value:d.toString()};this.filterAttempt.push(t)}this._routeHelperService.isPrimaryActionTriggered().pipe(Object(Et.a)(t=>!!t),Object(d.a)(this.unsubscribed)).subscribe(()=>this.gotoAddAppointments()),this._routeHelperService.getMultiActionTriggered().pipe(Object(Et.a)(t=>!!t),Object(d.a)(this.unsubscribed)).subscribe(t=>{"BULK_UPLOAD"===t?this.gotoBulkUploadAppointments():"BULK_REASSIGN"===t&&this.gotoBulkReassignAppointments()}),this._routeHelperService.getSearch().pipe(Object(Et.a)(t=>null!==t),Object(d.a)(this.unsubscribed)).subscribe(t=>{this.searchKey!=t&&(this.searchKey=t,this.fetchAppointmentsData())}),this._dataSharingService.getTimer().pipe(Object(d.a)(this.unsubscribed)).subscribe(t=>{t&&("COMPLETED"===(null==t?void 0:t.state)||"END"===(null==t?void 0:t.state)?(this.timerRunning=!1,this.timedAppointment=void 0,this.queryParamInitialised&&this.getUpcomingAppointments()):this.timerRunning=!0)})}ngOnInit(){this.activeRoleType=localStorage.getItem("loggedInUserRole"),this.getStaff(null,!0),this._activatedRoute.queryParams.subscribe(t=>{var e,n;if(t.requestTenantIds&&(this.selectedTenantIds=t.requestTenantIds.split(","),localStorage.setItem(Kt.a.REQUEST_TENANT_IDS,t.requestTenantIds)),(null==t?void 0:t.startTime)||(null==t?void 0:t.endTime)||(null==t?void 0:t.tab))(null==t?void 0:t.startTime)&&(null==t?void 0:t.endTime)&&(this.dateRange=[],this.dateRange[0]=new Date(Number(null==t?void 0:t.startTime)),this.dateRange[1]=new Date(Number(null==t?void 0:t.endTime)),this.datePreset=!0,this.appointmentFetchQuery.startTime=null==t?void 0:t.startTime,this.appointmentFetchQuery.endTime=null==t?void 0:t.endTime),(null==t?void 0:t.tab)&&(this.appointmentFetchQuery.tab=null==t?void 0:t.tab),localStorage.setItem("appointmentFetchQuery",JSON.stringify(this.appointmentFetchQuery));else{let t=localStorage.getItem("appointmentFetchQuery");null!=t&&(this.appointmentFetchQuery=JSON.parse(t),this.dateRange[0]=new Date(Number(null===(e=this.appointmentFetchQuery)||void 0===e?void 0:e.startTime)),this.dateRange[1]=new Date(Number(null===(n=this.appointmentFetchQuery)||void 0===n?void 0:n.endTime)),this.datePreset=!0,this.searchKey=this.appointmentFetchQuery.searchTerm)}this.queryParamInitialised=!0,this.changeTab(Array.from(this.tabIndex.values()).findIndex(t=>{var e;return t===(null===(e=this.appointmentFetchQuery)||void 0===e?void 0:e.tab)}))}),this._dataSharingService.onSubTenantChange().pipe(Object(d.a)(this.unsubscribed)).subscribe(t=>{this.onSubTenantChange(t)}),this.getSites()}onSubTenantChange(t){"object"!=typeof t||0==t.length||""==t||null==t||null==t?(this.requestTenantIds=void 0,this.fetchAppointmentsData(1)):(this.requestTenantIds=t.join(),this.selectedTenantIds=t,this.fetchAppointmentsData(1)),this.staffList=[],this.siteList=[],this.getStaff(),this.getSites()}clearSearch(){this.searchKey="",this._routeHelperService.setSearch("")}changeTab(t){this.selectedTabIndex=t,this._router.navigate([],{queryParams:{tab:this.tabIndex.get(t)},queryParamsHandling:"merge",relativeTo:this._activatedRoute,replaceUrl:!0}).then(()=>this.fetchAppointmentsData())}ngAfterViewInit(){this.translationService.getMultiple(...Ht.APPOINTMENT_CREATE_STRINGS).subscribe(t=>{this.translatedStrings=t,this.appointmentTypes=new Map([["VIDEO_CALL",this.translatedStrings.get("VIDEO_CALL")],["HOME_VISIT",this.translatedStrings.get("EPISODE.HOMEVISIT")],["AUDIO_CALL",this.translatedStrings.get("AUDIO_CALL")]])}),this.getTenantConfig(),"CARE_TAKER"===localStorage.getItem("loggedInUserAccountType")&&(this.isCaretakerLogin=!0,this.selectedStaff=localStorage.getItem("loggedInUser"))}onExpandChange(t,e){e?this.expandSet.add(t):this.expandSet.delete(t)}getSites(){this.loadingSites=!0,this._siteService.getAllSites().subscribe(t=>{this.siteList=t.result,this.loadingSites=!1})}getStaff(t=null,e=!1){this._staffService.fetchStaffMembers(Qt.a.MONITORING_STAFF,this.getOffset(this.pageIndex),10,null,null,"ALL",!1,t,!0).subscribe(t=>{var n;this.staffList=null===(n=null==t?void 0:t.result)||void 0===n?void 0:n.map(t=>{var e;return this.staffIdMap.set(null===(e=null==t?void 0:t.user)||void 0===e?void 0:e.id,null==t?void 0:t.user),null==t?void 0:t.user}),console.log("Staff : ",this.staffList),e&&"CARE_TAKER"===localStorage.getItem("loggedInUserAccountType")&&(this.isCaretakerLogin=!0,this.selectedStaff=localStorage.getItem("loggedInUser"))})}logAction(t,e){this._patientsEventLogger.patientActionEvent(e,t)}getTenantConfig(){this._dataSharingService.tenantSettings.pipe(Object(d.a)(this.unsubscribed)).subscribe(t=>{t&&(this.isCallButtonEnabled=!!(t.videoCallConfig&&t.appointmentConfig.videoCallAppointment&&t.appointmentConfig.videoCallAppointment))})}clear(){this.searchKey=null,this.fetchAppointmentsData()}onSiteSelect(t){this.staffList=[],this.selectedSite=t,this.getStaff(t),this.fetchAppointmentsData(1,null,null,t)}fetchAppointmentsData(t=1,e=null,n=null,i=null){switch(this._activatedRoute.snapshot.queryParamMap.get("tab")||"upcoming"){case"request":this.getAppointmentRequests(t,e);break;case"upcoming":this.getUpcomingAppointments(t,e,n);break;case"completed":this.getCompletedAppointments(t,e,n);break;case"unattended":this.getUnattendedAppointments(t,e,n);break;case"rejected":this.getRejectedAppointments(t,e);break;case"on-hold":this.getOnHoldAppointments(t,e);break;case"no-appointment":this.getPatientsWithoutAppointments()}}changePageSize(t){this.pageSize=t,1==this.pageIndex&&this.fetchAppointmentsData()}onQueryParamsChange(t){const{pageSize:e,pageIndex:n,sort:i,filter:a}=t,s=i.find(t=>null!==t.value),o="ascend"==(s&&s.value||"ascend")?"ASC":"DESC";this.pageSize=e,this.fetchAppointmentsData(n,o,a)}getOffset(t){return Math.max(0,(t-1)*this.pageSize)}getAppointmentRequests(t=1,e=null){this.appointmentLoading.appointmentsRequests=!0,this._appointmentsEventLogger.tabEvent("Requests","appointments"),this._appointmentsService.fetchAppointmentsRequests(this.getOffset(t),this.pageSize,this.searchKey,this.requestTenantIds).subscribe(t=>{this.appointmentsRequests=t,this.appointmentLoading.appointmentsRequests=!1})}getUpcomingAppointments(t=1,e=null,n=null,i=null){var a,s,o,c;if(this.selectedStaffDetail=this.selectedStaff?this.staffIdMap.get(this.selectedStaff):void 0,this.appointmentLoading.upcomingAppointments)return;let l,r;this._appointmentsEventLogger.tabEvent("Upcoming","appointments"),this.appointmentLoading.upcomingAppointments=!0,this.dateRange&&this.dateRange[0]&&(l=this.datePreset?null===(a=this.dateRange[0])||void 0===a?void 0:a.getTime():null===(s=Object(Tt.a)(this.dateRange[0]))||void 0===s?void 0:s.getTime()),this.dateRange&&this.dateRange[1]&&(r=this.datePreset?null===(o=this.dateRange[1])||void 0===o?void 0:o.getTime():null===(c=Object(It.a)(this.dateRange[1]))||void 0===c?void 0:c.getTime()),console.log("Selected Staff ",this.selectedStaff),this._appointmentsService.fetchUpcomingAppointments(this.getOffset(t),l,r,void 0,this.selectedStaff,this.searchKey,null,this.pageSize,e,n,null,this.requestTenantIds,this.selectedSite).subscribe(t=>{this.upcomingAppointments=t,this.updateEnabled(),this.updateEpisodeType(this.upcomingAppointments,()=>{this.appointmentLoading.upcomingAppointments=!1})})}updateEpisodeType(t,e){const n=t.result.map(t=>t.episodeId).filter(t=>null!=t).filter((t,e,n)=>n.indexOf(t)==e);0!=n.length?this._episodeService.getEpisodeByIds(n).subscribe(n=>{t.result.forEach(t=>t.episodeType=n[t.episodeId]),e()}):e()}updateEnabled(){this.upcomingAppointments.result.forEach(t=>{t.enabled=t.schedule.startDate>=Object(Dt.a)(new Date).getTime()&&t.schedule.endDate<=Object(Ct.a)(new Date).getTime()})}getCompletedAppointments(t=1,e=null,n=null){var i,a,s,o;if(this.appointmentLoading.completedAppointments)return;let c,l;this.appointmentLoading.completedAppointments=!0,this.dateRange&&this.dateRange[0]&&(c=this.datePreset?null===(i=this.dateRange[0])||void 0===i?void 0:i.getTime():null===(a=Object(Tt.a)(this.dateRange[0]))||void 0===a?void 0:a.getTime()),this.dateRange&&this.dateRange[1]&&(l=this.datePreset?null===(s=this.dateRange[1])||void 0===s?void 0:s.getTime():null===(o=Object(It.a)(this.dateRange[1]))||void 0===o?void 0:o.getTime()),this._appointmentsEventLogger.tabEvent("Completed","appointments"),this._appointmentsService.fetchCompletedAppointments(this.getOffset(t),this.pageSize,null,this.searchKey,e,c,l,n,this.requestTenantIds).subscribe(t=>{this.completedAppointments=t,this.updateEpisodeType(this.completedAppointments,()=>{this.appointmentLoading.completedAppointments=!1})})}getUnattendedAppointments(t=1,e=null,n=null){var i,a,s,o;if(this.activeRoleName=localStorage.getItem("loggedInUserRoleName"),this.appointmentLoading.unattendedAppointments)return;let c,l;this.appointmentLoading.unattendedAppointments=!0,this.dateRange&&this.dateRange[0]&&(c=this.datePreset?null===(i=this.dateRange[0])||void 0===i?void 0:i.getTime():null===(a=Object(Tt.a)(this.dateRange[0]))||void 0===a?void 0:a.getTime()),this.dateRange&&this.dateRange[1]&&(l=this.datePreset?null===(s=this.dateRange[1])||void 0===s?void 0:s.getTime():null===(o=Object(It.a)(this.dateRange[1]))||void 0===o?void 0:o.getTime()),this._appointmentsEventLogger.tabEvent("Unattended","appointments"),this._appointmentsService.fetchUnattendedAppointments(this.getOffset(t),this.pageSize,null,this.searchKey,c,l,e,n,this.requestTenantIds).subscribe(t=>{this.unattendedAppointments=t,this.updateEpisodeType(this.unattendedAppointments,()=>{this.appointmentLoading.unattendedAppointments=!1})})}getRejectedAppointments(t=1,e=null){this.appointmentLoading.rejectedAppointments=!0,this._appointmentsEventLogger.tabEvent("Rejected","appointments"),this._appointmentsService.fetchRejectedAppointments(this.getOffset(t),this.pageSize,this.searchKey).subscribe(t=>{this.rejectedAppointments=t,this.appointmentLoading.rejectedAppointments=!1})}getOnHoldAppointments(t=1,e=null){this.appointmentLoading.rejectedAppointments=!0,this._appointmentsEventLogger.tabEvent("On-Hold","appointments"),this._appointmentsService.fetchOnHoldAppointments(this.getOffset(t),this.pageSize,this.searchKey).subscribe(t=>{this.rejectedAppointments=t,this.appointmentLoading.rejectedAppointments=!1})}getPatientsWithoutAppointments(){this.appointmentLoading.noAppointmentPatients||(this._appointmentsEventLogger.tabEvent("No-Appointments","appointments"),this.appointmentLoading.noAppointmentPatients=!0,this._appointmentsService.fetchPatientWihoutAppointment(this.selectedStaff,this.searchKey).subscribe(t=>{this.noAppointmentPatients=t,this.filteredNoAppointmentPatients=JSON.parse(JSON.stringify(t)),this.appointmentLoading.noAppointmentPatients=!1}))}clearUnattendedAppointments(){this._modalService.create({nzContent:Jt,nzComponentParams:{dateRange:this.dateRange,datePreset:this.datePreset,requestTenantIds:this.requestTenantIds},nzClosable:!0,nzMaskClosable:!1,nzFooter:null}).afterClose.subscribe(t=>{t&&(this.dateRange=[],this.getUnattendedAppointments())})}filterByLastServiceDate(){if(this.noAppointmentPatients=JSON.parse(JSON.stringify(this.filteredNoAppointmentPatients)),!this.dateRange[0]||!this.dateRange[1])return;const t=JSON.parse(JSON.stringify(this.dateRange)),e=new Date(t[0]).setHours(0,0,0,0),n=new Date(t[1]).setHours(23,59,59,999);this.noAppointmentPatients=this.noAppointmentPatients.filter(t=>{var i,a;const s=null===(i=null==t?void 0:t.patientState)||void 0===i?void 0:i.lastServiceDates.COMPLEX_CCM,o=null===(a=null==t?void 0:t.patientState)||void 0===a?void 0:a.lastServiceDates.CCM;return s&&e<new Date(s).getTime()&&n>new Date(s).getTime()||o&&e<new Date(o).getTime()&&n>new Date(o).getTime()?t:void 0})}viewAppointmentDetails(t){this._appointmentsEventLogger.appointmentActionEvent(t,Bt.a.ACTION_VIEW),this._router.navigate(["appointments/details/",t])}confirmAppointment(t){const e=new Date(t.startTime),n=this._modalService.create({nzTitle:this.translatedStrings.get("APPOINTMENT.CONFIRM_APPOINTMENT"),nzContent:Nt,nzComponentParams:{dateTime:e},nzOnOk:()=>{var e,i;const a=n.getContentComponent().selectedCaretaker,s=null===(e=n.getContentComponent().startTime)||void 0===e?void 0:e.getTime(),o=null===(i=n.getContentComponent().endTime)||void 0===i?void 0:i.getTime();a?this.approveAppointment(t.id,a.id,s,o):this._notificationsService.error(this.translatedStrings.get("FORM.APPOINTMENT"),this.translatedStrings.get("APPOINTMENT.NO_CLINICIAN_SELECTED"))}})}approveAppointment(t,e,n,i){this._appointmentsService.setAppointmentAsApproved(t,e,n,i).subscribe(()=>{this._notificationsService.success(this.translatedStrings.get("FORM.APPOINTMENT"),this.translatedStrings.get("APPOINTMENT.CLINICIAN_ADDED_APPOINTMENT_APPROVED")),this.getAppointmentRequests()})}rejectAppointment(t){this._modalService.create({nzTitle:this.translatedStrings.get("APPOINTMENT.REJECT_APPOINTMENT"),nzContent:this.translatedStrings.get("APPOINTMENT.REJECT_APPOINTMENT_POPUP"),nzClosable:!0,nzOnCancel:()=>{},nzOnOk:()=>{t.status=kt.REJECTED,this._appointmentsService.setAppointmentAsRejected(t).subscribe(()=>{this._appointmentsEventLogger.appointmentActionEvent(t.id,Bt.a.ACTION_REJECT),this._notificationsService.success(this.translatedStrings.get("FORM.APPOINTMENT"),this.translatedStrings.get("APPOINTMENT.MARKED_REJECTED")),this.getAppointmentRequests()})}})}deleteAppointment(t){this._modalService.create({nzTitle:this.translatedStrings.get("APPOINTMENT.DELETE_APPOINTMENT"),nzContent:this.translatedStrings.get("APPOINTMENT.REMOVE_APPOINTMENT"),nzClosable:!0,nzOnCancel:()=>{},nzOnOk:()=>{this._appointmentsService.setAppointmentAsDeleted(t).subscribe(()=>{this._appointmentsEventLogger.appointmentActionEvent(t,Bt.a.ACTION_DELETE),this._notificationsService.success(this.translatedStrings.get("FORM.APPOINTMENT"),this.translatedStrings.get("APPOINTMENT.APPOINTMENT_DELETE")),this.getUpcomingAppointments()})}})}editReasonForUnattendedAppointment(t){this._modalService.create({nzContent:Wt,nzComponentParams:{reason:t.reason},nzWidth:"850px",nzFooter:null}).afterClose.subscribe(e=>{e&&(t.reason=e,this._appointmentsEventLogger.appointmentUnattendedReason(e,t.id),this._appointmentsService.updateAppointment(t).subscribe(()=>{this._notificationsService.success(this.translatedStrings.get("FORM.APPOINTMENT"),this.translatedStrings.get("APPOINTMENT.REASON_ADDED_SUCCESSFULLY"))}))})}rescheduleAppointment(t){t.schedule||(t.schedule=new m.a,t.schedule.startDate=(new Date).getTime()),this._appointmentsEventLogger.appointmentActionEvent(t.id,Bt.a.ACTION_RESCHEDULE),this._modalService.create({nzContent:wt.a,nzComponentParams:{appointment:t},nzWidth:850,nzFooter:null}).afterClose.subscribe(()=>{this.getUpcomingAppointments(),this.getUnattendedAppointments()})}gotoAddAppointments(){this._router.navigate(["appointments/create"])}gotoManageEpisodes(t,e){t?this._episodeService.getEpisodeById(t).subscribe(t=>{this._router.navigate([`episodes/details/${null==t?void 0:t.patientId}/${null==t?void 0:t.id}`],{queryParams:{blueprintId:null==t?void 0:t.blueprintId}})}):this._router.navigate([`patient/view/${e}`],{queryParams:{tab:"episodes"}})}gotoCalendarView(){this._router.navigate(["appointments/calendar"])}showHistory(t,e){this._modalService.create({nzContent:$t.a,nzComponentParams:{patientId:null==e?void 0:e.attendeeId,patientName:null==e?void 0:e.attendeeName},nzWidth:800,nzStyle:{top:"50px"},nzBodyStyle:{height:"700px",overflowY:"scroll"},nzFooter:null})}initiateVideoCall(t,e){if(e.schedule.startDate-Date.now()>6e5)return void this._notificationsService.warning(this.translatedStrings.get("FORM.APPOINTMENT"),this.translatedStrings.get("VIDEOCALL.ERROR.APPOINTMENT_FUTURE_SCHEDULE"));this.isCallButtonEnabled=!1;const n=localStorage.getItem("loggedInUser");this._videoCallService.videocallSessionCheck(n).subscribe(n=>{this._videoCallService.videocallSessionCheck(t).subscribe(()=>{this._appointmentsEventLogger.appointmentActionEvent(e.id,Bt.a.ACTION_VIDEOCALL),this.openCallWindow(t,e.id,e.videoCallSessionId)},t=>{this.callError(t,this.translatedStrings.get("VIDEOCALL.ERROR.ALREADY_IN_CALL"))})},t=>{this.callError(t,this.translatedStrings.get("VIDEOCALL.ERROR.ALREADY_ANOTHER_CALL"))})}openCallWindow(t,e,n){const i=this._router.serializeUrl(this._router.createUrlTree(["/video-call/"+t],{queryParams:{env:"prod",appointmentId:e,appointmentSessionId:n}}));this.isCallButtonEnabled=!0,null==window.open(i,"_blank")&&this._notificationsService.create("error",this.translatedStrings.get("VIDEOCALL.ERROR.POPUP_BLOCKED"),this.translatedStrings.get("VIDEOCALL.ERROR.POPUP_BLOCKER_MESSAGE"))}callError(t,e){403==t.status?this._notificationsService.create("error",this.translatedStrings.get("VIDEOCALL.VIDEOCALL"),e):401==t.status&&(this._notificationsService.create("error",this.translatedStrings.get("COMMON.INVALID_SESSION"),this.translatedStrings.get("COMMON.SESSION_EXPIRED")),this._router.navigate(["logout"])),this.isCallButtonEnabled=!0}sendSMS(t,e,n,i,a){this._appointmentsEventLogger.appointmentActionEvent(a,Bt.a.ACTION_SMS),this._modalService.create({nzContent:Ut,nzTitle:this.translatedStrings.get("FORM.APPOINTMENT"),nzComponentParams:{patientId:t,message:`An appointment has been created for you with ${e} on ${this._datePipe.transform(n,"medium")} via ${this.appointmentTypes.get(i)}`},nzFooter:null})}startTimer(t){this.timerRunning=!0,this.timedAppointment=t,this._dataSharingService.setTimer({state:"START",data:t,showStickyNote:!0})}updateNotesMap(t){t.result.forEach(t=>{const e=[];t.notesHistory&&e.push(...t.notesHistory.filter(t=>null!=t)),e.push(t.noteId),this.fetchAppointmentNotes(e,t)})}fetchAppointmentNotes(t,e){null!=t&&0!=t.length?this._appointmentsService.fetchNotesByIds(t).subscribe(t=>{t.forEach(t=>this.notesMap.set(t.id,t)),e.notes=t}):e.notes=[]}showNotesHistory(t){this._appointmentModalService.showNotesHistory(t,t.attendeeId).afterClose.subscribe(e=>{e&&(t.noteId&&(t.notesHistory||(t.notesHistory=[]),t.notesHistory.push(t.noteId)),t.noteId=e.id,this._appointmentsService.updateAppointment(t).subscribe(t=>this.fetchAppointmentsData()))})}gotoBulkUploadAppointments(){this._router.navigate(["appointments/bulk-upload"])}gotoBulkReassignAppointments(){this._router.navigate(["appointments/bulk-reassign"])}}return t.\u0275fac=function(e){return new(e||t)(y.Rb(g.a),y.Rb(Zt.a),y.Rb(c.g),y.Rb(vt.a),y.Rb(c.a),y.Rb(N.b),y.Rb(Mt.f),y.Rb(S.a),y.Rb(f.a),y.Rb(qt.a),y.Rb(jt.a),y.Rb(a.e),y.Rb(A.a),y.Rb(Yt.a),y.Rb(te.a))},t.\u0275cmp=y.Lb({type:t,selectors:[["app-appointments"]],features:[y.Cb([a.e]),y.Ab],decls:148,vars:133,consts:[[3,"nzSelectedIndex","nzSelectedIndexChange"],[3,"nzTitle"],[1,"appointments-card"],["nz-row","","nzGutter","16","nzJustify","end"],["nz-col","","nzSpan","10",2,"padding-left","10px !important"],[4,"ngIf"],["nz-col","","nzSpan","4"],["nzPlaceHolder","Filter by sites","nzAllowClear","",3,"ngModel","ngModelChange"],[4,"ngIf","ngIfElse"],["siteLoading",""],["nzPlaceHolder","Filter by staff","nzAllowClear","",3,"ngModel","ngModelChange"],["staffLoading",""],["nz-col","","nzSpan","6"],[3,"ngModel","ngModelChange"],[3,"nzData","nzFrontPagination","nzNoResult","nzShowPagination","nzShowSizeChanger","nzPageSizeOptions","nzLoading","nzTotal","nzPageIndex","nzPageSize","nzQueryParams"],["upcoming",""],[4,"isAccessAcrossTenantEnabled"],["nzColumnKey","date",3,"nzSortFn","nzSortDirections","nzSortOrder"],["nzColumnKey","attempt","nzWidth","100px",3,"nzFilters","nzFilterFn"],["id","actions-container"],["ngFor","",3,"ngForOf"],["nz-col","","nzSpan","8"],[3,"nzData","nzFrontPagination","nzNoResult","nzShowPagination","nzShowSizeChanger","nzPageSizeOptions","nzLoading","nzTotal","nzQueryParams"],["completed",""],[4,"ngFor","ngForOf"],["nz-row",""],["nz-col","","nzFlex","3",4,"isFeaturePermitted"],["nz-col","","nzFlex","5"],[3,"nzData","nzFrontPagination","nzNoResult","nzShowPagination","nzShowSizeChanger","nzPageSizeOptions","nzPageIndex","nzPageSize","nzLoading","nzTotal","nzQueryParams"],["unattended",""],["nzTitle","Patients Without Appointment"],["nz-col","","nzSpan","4",4,"ngIf"],[3,"nzData","nzNoResult","nzShowPagination","nzShowSizeChanger","nzPageSizeOptions","nzLoading","nzPageSize"],["noAppointment",""],["nzWidth","200px"],["nzWidth","200px","id","actions-container"],["noData",""],[3,"staffName","assignedTenantIds",4,"ngIf"],[3,"staffName","assignedTenantIds"],[3,"nzValue","nzLabel",4,"ngFor","ngForOf"],[3,"nzValue","nzLabel"],["nzDisabled","","nzCustomContent",""],["nz-icon","","nzType","loading",1,"loading-icon"],["nz-tooltip","",3,"nzTooltipTitle",4,"ngIf"],["actionable","",3,"routerLink"],["nz-typography","","nzEllipsis","","nz-tooltip","",3,"nzTooltipTitle"],["isToolTipEnabled","true",3,"patientStatus"],["name","sms",3,"click"],[1,"char-bound-field"],["nz-tooltip","","nzTooltipTitle","Communication History","name","history",3,"click"],["nzType","vertical"],["nz-tooltip","","nzTooltipTitle","Appointment Details","name","view",3,"click",4,"isFeaturePermitted"],["nz-tooltip","","nzTooltipTitle","Reschedule Appointment","name","reschedule",3,"click",4,"isFeaturePermitted"],["nz-tooltip","","nzTooltipTitle","Delete Appointment","name","delete",3,"click",4,"isFeaturePermitted"],["nz-tooltip","","nzTooltipTitle","Show Notes","name","file",3,"click"],["nz-tooltip","","nzTooltipTitle","Manage Episode","name","edit",3,"click"],["nz-button","","nzType","text",3,"disabled","click"],["nz-tooltip","","name","play",3,"nzTooltipTitle",4,"ngIf"],["nz-tooltip","","name","play",3,"nzTooltipTitle"],["nz-tooltip","",3,"nzTooltipTitle"],["nz-button","","nzType","text",3,"disabled"],["color","lightgray","name","play",4,"ngIf"],["color","lightgray","name","play"],[3,"userId","phoneNumbers","disabled","renderVital","appointmentId","click"],["name","videoCall",3,"click",4,"isFeaturePermitted"],["name","videoCall",3,"click"],["nz-tooltip","","nzTooltipTitle","Appointment Details","name","view",3,"click"],["nz-tooltip","","nzTooltipTitle","Reschedule Appointment","name","reschedule",3,"click"],["nz-tooltip","","nzTooltipTitle","Delete Appointment","name","delete",3,"click"],["name","view",3,"click",4,"isFeaturePermitted"],["name","view",3,"click"],["nz-col","","nzFlex","3"],["nz-button","","nzType","primary",3,"disabled","click"],["name","edit",3,"click",4,"isFeaturePermitted"],["name","edit",3,"click"],[1,"ellipsis-text"],["actionable","",2,"text-align","center !important",3,"routerLink","queryParams"],["nz-button","","nzType","link",1,"create-link",3,"nzSize"],[2,"flex","1","overflow","auto",3,"nzNotFoundImage","nzNotFoundContent"],["contentTpl",""]],template:function(t,e){if(1&t&&(y.Xb(0,"nz-tabset",0),y.ec("nzSelectedIndexChange",function(t){return e.onSelectedTabIndexChange(t)}),y.Xb(1,"nz-tab",1),y.jc(2,"translate"),y.Xb(3,"div",2),y.Xb(4,"div",3),y.Xb(5,"div",4),y.Vc(6,ue,2,0,"ng-container",5),y.Wb(),y.Xb(7,"div",6),y.Xb(8,"nz-select",7),y.ec("ngModelChange",function(t){return e.selectedSite=t})("ngModelChange",function(t){return e.onSiteSelect(t)}),y.Vc(9,he,2,1,"ng-container",8),y.Vc(10,me,3,0,"ng-template",null,9,y.Wc),y.Wb(),y.Wb(),y.Xb(12,"div",6),y.Xb(13,"nz-select",10),y.ec("ngModelChange",function(t){return e.selectedStaff=t})("ngModelChange",function(){return e.getUpcomingAppointments()}),y.Vc(14,fe,2,1,"ng-container",8),y.Vc(15,Se,3,0,"ng-template",null,11,y.Wc),y.Wb(),y.Wb(),y.Xb(17,"div",12),y.Xb(18,"nz-range-picker",13),y.ec("ngModelChange",function(t){return e.dateRange=t})("ngModelChange",function(){return e.getUpcomingAppointments()}),y.Wb(),y.Wb(),y.Wb(),y.Xb(19,"nz-table",14,15),y.ec("nzQueryParams",function(t){return e.onQueryParamsChange(t)}),y.Xb(21,"thead"),y.Xb(22,"tr"),y.Sb(23,"th"),y.Xb(24,"th"),y.Xc(25,"Episode"),y.Wb(),y.Xb(26,"th"),y.Xc(27),y.jc(28,"translate"),y.Wb(),y.Sb(29,"th"),y.Sb(30,"th"),y.Vc(31,ze,2,0,"th",16),y.Xb(32,"th"),y.Xc(33),y.jc(34,"translate"),y.Wb(),y.Xb(35,"th",17),y.Xc(36),y.jc(37,"translate"),y.Wb(),y.Xb(38,"th"),y.Xc(39,"Type"),y.Wb(),y.Xb(40,"th",18),y.Xc(41," Attempt "),y.Wb(),y.Xb(42,"th",19),y.Xc(43),y.jc(44,"translate"),y.Wb(),y.Wb(),y.Wb(),y.Xb(45,"tbody"),y.Vc(46,We,45,34,"ng-template",20),y.Wb(),y.Wb(),y.Wb(),y.Wb(),y.Xb(47,"nz-tab",1),y.jc(48,"translate"),y.Xb(49,"div",2),y.Xb(50,"div",3),y.Sb(51,"div",21),y.Xb(52,"div",12),y.Xb(53,"nz-range-picker",13),y.ec("ngModelChange",function(t){return e.dateRange=t})("ngModelChange",function(){return e.getCompletedAppointments()}),y.Wb(),y.Wb(),y.Wb(),y.Xb(54,"nz-table",22,23),y.ec("nzQueryParams",function(t){return e.onQueryParamsChange(t)}),y.Xb(56,"thead"),y.Xb(57,"tr"),y.Xb(58,"th"),y.Xc(59,"Episode"),y.Wb(),y.Xb(60,"th"),y.Xc(61),y.jc(62,"translate"),y.Wb(),y.Sb(63,"th"),y.Vc(64,Re,2,0,"th",16),y.Xb(65,"th"),y.Xc(66),y.jc(67,"translate"),y.Wb(),y.Xb(68,"th",17),y.Xc(69),y.jc(70,"translate"),y.Wb(),y.Xb(71,"th"),y.Xc(72,"Type"),y.Wb(),y.Xb(73,"th",18),y.Xc(74," Attempt "),y.Wb(),y.Xb(75,"th",19),y.Xc(76),y.jc(77,"translate"),y.Wb(),y.Wb(),y.Wb(),y.Xb(78,"tbody"),y.Vc(79,Ve,20,14,"tr",24),y.Wb(),y.Wb(),y.Wb(),y.Wb(),y.Xb(80,"nz-tab",1),y.jc(81,"translate"),y.Xb(82,"div",2),y.Xb(83,"div",3),y.Sb(84,"div",21),y.Xb(85,"div",21),y.Xb(86,"div",25),y.Vc(87,Fe,3,1,"div",26),y.Xb(88,"div",27),y.Xb(89,"nz-range-picker",13),y.ec("ngModelChange",function(t){return e.dateRange=t})("ngModelChange",function(){return e.getUnattendedAppointments()}),y.Wb(),y.Wb(),y.Wb(),y.Wb(),y.Wb(),y.Xb(90,"nz-table",28,29),y.ec("nzQueryParams",function(t){return e.onQueryParamsChange(t)}),y.Xb(92,"thead"),y.Xb(93,"tr"),y.Xb(94,"th"),y.Xc(95,"Episode"),y.Wb(),y.Xb(96,"th"),y.Xc(97),y.jc(98,"translate"),y.Wb(),y.Sb(99,"th"),y.Vc(100,xe,2,0,"th",16),y.Xb(101,"th"),y.Xc(102),y.jc(103,"translate"),y.Wb(),y.Xb(104,"th",17),y.Xc(105),y.jc(106,"translate"),y.Wb(),y.Xb(107,"th"),y.Xc(108,"Type"),y.Wb(),y.Xb(109,"th",18),y.Xc(110," Attempt "),y.Wb(),y.Xb(111,"th"),y.Xc(112),y.jc(113,"translate"),y.Wb(),y.Xb(114,"th",19),y.Xc(115),y.jc(116,"translate"),y.Wb(),y.Wb(),y.Wb(),y.Xb(117,"tbody"),y.Vc(118,qe,26,21,"tr",24),y.Wb(),y.Wb(),y.Wb(),y.Wb(),y.Xb(119,"nz-tab",30),y.Xb(120,"div",2),y.Xb(121,"div",3),y.Sb(122,"div",21),y.Xb(123,"div",12),y.Xb(124,"nz-range-picker",13),y.ec("ngModelChange",function(t){return e.dateRange=t})("ngModelChange",function(){return e.filterByLastServiceDate()}),y.Wb(),y.Wb(),y.Vc(125,Ge,5,3,"div",31),y.Wb(),y.Xb(126,"nz-table",32,33),y.Xb(128,"thead"),y.Xb(129,"tr"),y.Xb(130,"th",34),y.Xc(131,"Episode"),y.Wb(),y.Xb(132,"th"),y.Xc(133),y.jc(134,"translate"),y.Wb(),y.Xb(135,"th"),y.Xc(136,"Last Service Date"),y.Wb(),y.Xb(137,"th"),y.Xc(138),y.jc(139,"translate"),y.Wb(),y.Vc(140,Je,2,0,"th",16),y.Xb(141,"th",35),y.Xc(142),y.jc(143,"translate"),y.Wb(),y.Wb(),y.Wb(),y.Xb(144,"tbody"),y.Vc(145,nn,19,19,"ng-template",20),y.Wb(),y.Wb(),y.Wb(),y.Wb(),y.Wb(),y.Vc(146,sn,3,2,"ng-template",null,36,y.Wc)),2&t){const t=y.Ic(11),n=y.Ic(16),i=y.Ic(20),a=y.Ic(55),s=y.Ic(91),o=y.Ic(127),c=y.Ic(147);y.rc("nzSelectedIndex",e.selectedTabIndex),y.Db(1),y.sc("nzTitle",y.kc(2,87,"APPOINTMENTS.UPCOMING")),y.Db(5),y.rc("ngIf",!e.appointmentLoading.upcomingAppointments),y.Db(2),y.rc("ngModel",e.selectedSite),y.Db(1),y.rc("ngIf",null==e.siteList?null:e.siteList.length)("ngIfElse",t),y.Db(4),y.rc("ngModel",e.selectedStaff),y.Db(1),y.rc("ngIf",null==e.staffList?null:e.staffList.length)("ngIfElse",n),y.Db(4),y.rc("ngModel",e.dateRange),y.Db(1),y.rc("nzData",e.upcomingAppointments.result)("nzFrontPagination",!1)("nzNoResult",c)("nzShowPagination",!0)("nzShowSizeChanger",!0)("nzPageSizeOptions",y.xc(125,on))("nzLoading",e.appointmentLoading.upcomingAppointments)("nzTotal",e.upcomingAppointments.totalCount)("nzPageIndex",e.pageIndex)("nzPageSize",e.pageSize),y.Db(8),y.Yc(y.kc(28,89,"HEADER.PATIENTS")),y.Db(6),y.Yc(y.kc(34,91,"TABLEHEADER.ASSIGNEDTO")),y.Db(2),y.rc("nzSortFn",!0)("nzSortDirections",y.xc(126,cn))("nzSortOrder","ascend"),y.Db(1),y.Zc(" ",y.kc(37,93,"COMMON.DATE_TIME")," "),y.Db(4),y.rc("nzFilters",e.filterAttempt)("nzFilterFn",!0),y.Db(3),y.Yc(y.kc(44,95,"TABLEHEADER.ACTIONS")),y.Db(3),y.rc("ngForOf",i.data),y.Db(1),y.sc("nzTitle",y.kc(48,97,"APPOINTMENTS.COMPLETED")),y.Db(6),y.rc("ngModel",e.dateRange),y.Db(1),y.rc("nzData",e.completedAppointments.result)("nzFrontPagination",!1)("nzNoResult",c)("nzShowPagination",!0)("nzShowSizeChanger",!0)("nzPageSizeOptions",y.xc(127,on))("nzLoading",e.appointmentLoading.completedAppointments)("nzTotal",e.completedAppointments.totalCount),y.Db(7),y.Yc(y.kc(62,99,"HEADER.PATIENTS")),y.Db(5),y.Yc(y.kc(67,101,"TABLEHEADER.ASSIGNEDTO")),y.Db(2),y.rc("nzSortFn",!0)("nzSortDirections",y.xc(128,cn))("nzSortOrder","descend"),y.Db(1),y.Zc(" ",y.kc(70,103,"COMMON.DATE_TIME")," "),y.Db(4),y.rc("nzFilters",e.filterAttempt)("nzFilterFn",!0),y.Db(3),y.Yc(y.kc(77,105,"TABLEHEADER.ACTIONS")),y.Db(3),y.rc("ngForOf",a.data),y.Db(1),y.sc("nzTitle",y.kc(81,107,"APPOINTMENTS.UNATTENDED")),y.Db(7),y.rc("isFeaturePermitted",y.xc(129,ln)),y.Db(2),y.rc("ngModel",e.dateRange),y.Db(1),y.rc("nzData",e.unattendedAppointments.result)("nzFrontPagination",!1)("nzNoResult",c)("nzShowPagination",!0)("nzShowSizeChanger",!0)("nzPageSizeOptions",y.xc(130,on))("nzPageIndex",e.pageIndex)("nzPageSize",e.pageSize)("nzLoading",e.appointmentLoading.unattendedAppointments)("nzTotal",e.unattendedAppointments.totalCount),y.Db(7),y.Yc(y.kc(98,109,"HEADER.PATIENTS")),y.Db(5),y.Yc(y.kc(103,111,"TABLEHEADER.ASSIGNEDTO")),y.Db(2),y.rc("nzSortFn",!0)("nzSortDirections",y.xc(131,cn))("nzSortOrder","descend"),y.Db(1),y.Zc(" ",y.kc(106,113,"COMMON.DATE_TIME")," "),y.Db(4),y.rc("nzFilters",e.filterAttempt)("nzFilterFn",!0),y.Db(3),y.Yc(y.kc(113,115,"COMMON.REASON")),y.Db(3),y.Yc(y.kc(116,117,"TABLEHEADER.ACTIONS")),y.Db(3),y.rc("ngForOf",s.data),y.Db(6),y.rc("ngModel",e.dateRange),y.Db(1),y.rc("ngIf",!e.isCaretakerLogin),y.Db(1),y.rc("nzData",e.noAppointmentPatients)("nzNoResult",c)("nzShowPagination",!0)("nzShowSizeChanger",!0)("nzPageSizeOptions",y.xc(132,rn))("nzLoading",e.appointmentLoading.noAppointmentPatients)("nzPageSize",e.pageSize),y.Db(7),y.Yc(y.kc(134,119,"COMMON.NAME")),y.Db(5),y.Yc(y.kc(139,121,"SITE")),y.Db(4),y.Yc(y.kc(143,123,"TABLEHEADER.ACTIONS")),y.Db(3),y.rc("ngForOf",o.data)}},directives:[ee.d,ee.a,W.c,W.a,a.q,R.d,l.u,l.x,ne.a,ne.c,ie.f,ie.n,ie.o,ie.e,ie.l,Y.a,ie.k,ie.i,a.p,ae.a,se.a,R.a,B.a,$.a,oe.a,c.h,L.a,x.d,ce.a,F.a,_.a,j.a,le.a,H.a,re.b],pipes:[q.a,Q.a,a.e,G.a,Z.a,K.a,a.A],styles:["[_nghost-%COMP%]     .ant-tabs-tab{padding:12px}.appointments-card[_ngcontent-%COMP%]{margin:0 2%}.actions[_ngcontent-%COMP%]{font-size:20px;cursor:pointer}tr[_ngcontent-%COMP%]{cursor:default!important}.search-box[_ngcontent-%COMP%]{width:15%;margin-left:85%;margin-bottom:1%}.search-input[_ngcontent-%COMP%]{border-radius:5px!important}#actions-container[_ngcontent-%COMP%]{text-align:center!important}[_nghost-%COMP%]     .ant-pagination{float:right;margin-bottom:20px}.char-bound-field[_ngcontent-%COMP%]{max-width:18ch;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}label[_ngcontent-%COMP%]{display:inline-flex;padding:12px 0 0 5px}strong[_ngcontent-%COMP%]{font-weight:800}nz-tag[_ngcontent-%COMP%]{margin:5px 0 0 5px}a[_ngcontent-%COMP%]   [_ngcontent-%COMP%]:not(.create-link){color:#0f2015d9}.inner-table[_ngcontent-%COMP%]   .ant-table-small[_ngcontent-%COMP%]   .ant-table-thead[_ngcontent-%COMP%] > tr[_ngcontent-%COMP%] > th[_ngcontent-%COMP%],   .inner-table .ant-table-thead>tr>th{background:var(--grey)}[_nghost-%COMP%]     .ant-table-tbody>tr>td>.ant-table-wrapper:only-child .ant-table{margin:-36px 0}[_nghost-%COMP%]     .ant-table-column-sorter-down, [_nghost-%COMP%]     .ant-table-column-sorter-up{color:var(--grey)}[_nghost-%COMP%]     .ant-table-column-sorter-down.active, [_nghost-%COMP%]     .ant-table-column-sorter-up.active{color:var(--black)!important}[_nghost-%COMP%]     .ant-table-filter-trigger .anticon{color:var(--black)!important}.row-align[_ngcontent-%COMP%]{display:flex;align-items:flex-end}"]}),t})();var dn=n("bA1+"),un=n("OS4Q"),bn=n("tk/3"),hn=n("AytR"),mn=n("Ifg2");let gn=(()=>{class t{constructor(){this.headersMap=new Map([["ID","id"],["FIRST NAME","firstName"],["LAST NAME","lastName"],["MRN#","mrn"],["DATE OF BIRTH","dateOfBirth"],["DATE","dateOfAppointment"],["START TIME","startTime"],["END TIME","endTime"],["TIMEZONE","timeZone"],["CLINICIAN NAME","staffName"]])}validateHeaders(t){return t.forEach((t,e)=>{Object.keys(t).forEach(e=>{Object.defineProperty(t,this.headersMap.get(e),Object.getOwnPropertyDescriptor(t,e)),delete t[e]}),t.rowId=e}),t}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=y.Nb({token:t,factory:t.\u0275fac}),t})();var fn=n("D9mS");function Sn(t,e){if(1&t){const t=y.Yb();y.Xb(0,"h5"),y.Xb(1,"span",6),y.Sb(2,"i",7),y.Xc(3),y.Wb(),y.Xc(4," \xa0 "),y.Xb(5,"span",8),y.ec("click",function(e){return y.Lc(t),y.ic().removeFile(e)}),y.Sb(6,"i",9),y.Xc(7," Delete"),y.Wb(),y.Wb()}if(2&t){const t=y.ic();y.Db(3),y.Zc(" File Seleted: ",t.uploadedFileName,"")}}function zn(t,e){if(1&t&&(y.Xb(0,"li"),y.Xc(1),y.Wb()),2&t){const t=e.$implicit;y.Db(1),y.Zc(" ",t," ")}}function An(t,e){if(1&t&&(y.Xb(0,"div"),y.Xb(1,"nz-card",13),y.Xb(2,"ul"),y.Vc(3,zn,2,1,"li",12),y.Wb(),y.Wb(),y.Wb()),2&t){const t=e.$implicit,n=y.ic(2);y.Db(1),y.sc("nzTitle",t.key),y.rc("nzExtra",n.extraTemplate),y.Db(2),y.rc("ngForOf",t.value)}}function vn(t,e){if(1&t&&(y.Xb(0,"div",10),y.Xb(1,"nz-card",11),y.Vc(2,An,4,3,"div",12),y.jc(3,"keyvalue"),y.Wb(),y.Wb()),2&t){const t=y.ic(),e=y.Ic(13);y.Db(1),y.rc("nzTitle",e),y.Db(1),y.rc("ngForOf",y.kc(3,2,t.errors))}}function Tn(t,e){1&t&&(y.Xb(0,"span",14),y.Xb(1,"strong"),y.Xc(2,"Validation Errors"),y.Wb(),y.Wb())}let In=(()=>{class t extends u.a{constructor(t,e,n,i,a,s,o){super(),this._router=t,this._http=e,this._appointmentsService=n,this._notificationsService=i,this._xlsxParserService=a,this._appointmentXlsxValidator=s,this._datePipe=o,this.mrnAndDobList=[],this.handleUpload=t=>{this.item=t,this.loading=!0,this.loadingText="Reading File...";const e=new FileReader;new bn.g({bypass:"yes"}),e.onload=()=>{const n=this._xlsxParserService.parse(e);try{this.data=this._appointmentXlsxValidator.validateHeaders(n[Object.keys(n)[0]]),this.mrnAndDobList=[];var i=this.data.map(t=>this.xlsxDataToAppointment(t));const e=[];this.errors=new Map,i.forEach((n,i)=>{var a,s,o,c;null==n&&[].push("Invalid Appointment Data"),this.isAppointment(n)?e.push(n):this.errors.set("Row : "+i,n),this.loading=!1,this.appointments=e,this.uploadedFileName=t.file.name,0===(null===(a=this.errors)||void 0===a?void 0:a.size)&&0===(null===(s=this.appointments)||void 0===s?void 0:s.length)&&(null===(o=this.errors)||void 0===o||o.set("Invalid File",["Invalid File - no appointment data found"])),(null===(c=this.errors)||void 0===c?void 0:c.size)||(this.errors=null,this._routeHelperService.setPrimaryEnableAction(!1))})}catch(a){return this.loading=!1,void this._notificationsService.error("Bulk Upload","Error while reading file headers!")}},e.readAsBinaryString(t.file)},this.uploadURL=hn.g.url+"/v2/media/upload/"+Math.random().toString(10).substring(7)+".xlsx"}ngOnInit(){this._routeHelperService.isPrimaryActionTriggered().pipe(Object(Et.a)(t=>!!t),Object(d.a)(this.unsubscribed)).subscribe(()=>this.validateAndSave()),this._routeHelperService.isSecondaryActionTriggered().pipe(Object(Et.a)(t=>!!t),Object(d.a)(this.unsubscribed)).subscribe(()=>this.downloadTemplate()),this._routeHelperService.setPrimaryEnableAction(!0)}xlsxDataToAppointment(t){var e;(null===(e=null==t?void 0:t.dateOfBirth)||void 0===e?void 0:e.length)&&(t.dateOfBirth=this._datePipe.transform(null==t?void 0:t.dateOfBirth,"yyyy-MM-dd"));const n=[];let i=/^\d{4}-\d{2}-\d{2}$/,a=/^\d{2}:\d{2}:\d{2}$/;if(null!=t.firstName&&""!==t.firstName||n.push("Firstname of patient is missing"),null!=t.lastName&&""!=t.lastName||n.push("Lastname of patient is missing"),null==t.dateOfAppointment||""===t.dateOfAppointment?n.push("Appointment date is missing"):i.test(t.dateOfAppointment.trim())||n.push('Appointment date format is incorrect - use "yyyy-mm-dd" '),null!=t.staffName&&""!==t.staffName||n.push("Staff name is missing"),null!=t.mrn&&""!==t.mrn||n.push("MRN(Patient ID) is missing"),null==t.dateOfBirth||""===t.dateOfBirth?n.push("Date of Birth is missing"):i.test(t.dateOfBirth.trim())||n.push('Date of Birth format is incorrect - use "yyyy-mm-dd" '),null==t.startTime||""===t.startTime?n.push("Start Time is Missing"):a.test(t.startTime.trim())||n.push('Appointment start time format is incorrect - use "HH:MM:SS" '),null==t.endTime||""===t.endTime?n.push("Appointment end time is missing"):a.test(t.endTime.trim())||n.push('Appointment end time format is incorrect - use "HH:MM:SS" '),n.length>0)return n;function s(t,e){let n=new Date(`1970-01-01T${t}`);return{hour:n.getHours(),minute:n.getMinutes(),second:n.getSeconds()}}let o=new Date(t.dateOfAppointment.trim()),c=new Date(t.dateOfAppointment.trim()),l=s(t.startTime.trim()),r=s(t.endTime.trim());o.setHours(l.hour),o.setMinutes(l.minute),c.setHours(r.hour),c.setMinutes(r.minute);let p=new Intl.DateTimeFormat("en-US",{timeZone:t.timeZone,year:"numeric",month:"numeric",day:"numeric",hour:"numeric",minute:"numeric",second:"numeric"}),d=p.format(o),u=p.format(c);const b={startDate:Date.parse(d),endDate:Date.parse(u)};return this.mrn=t.mrn.trim(),this.dateOfBirth=t.dateOfBirth.trim(),this.mrnAndDobList.push({mrn:this.mrn,dateOfBirth:this.dateOfBirth}),{id:t.id,attendeeName:t.firstName.trim()+" "+t.lastName.trim(),attenderName:t.staffName.trim(),title:"",description:"",overallStatus:"APPROVED",attenderId:"",attendeeId:"",noteId:"",notesHistory:[],requestedBy:"",lastUpdatedBy:"",schedules:{},schedule:b,scheduleHistory:[],serviceIds:[],completionFormUrl:"",reason:"",episodeId:"",tenantId:"",dateParam:"",type:t.type,appointmentPurpose:"PATIENT_FOLLOW_UP",ownerType:h.a.USER,videoCallSessionId:""}}isAppointment(t){return t.hasOwnProperty("id")}removeFile(t){return this.uploadedFileName=null,this.appointments=null,this._routeHelperService.setPrimaryEnableAction(!1),t.stopPropagation(),!1}downloadTemplate(){window.open("https://api.cooeyhealth.com/v1/assets/download/?filename=bulk-upload-appointments-template.xlsx","_blank")}validateAndSave(){const t=new bn.g({bypass:"yes"});this.errors=null,this.loading=!0,this.loadingText="Uploading file to server ...",this._appointmentsService.validateUploadAppointments(this.appointments,this.mrnAndDobList).subscribe(e=>{this.errors=e,Object.keys(this.errors).length?this.loading=!1:this._http.post(this.uploadURL,this.item.file,{headers:t,observe:"response",responseType:"text"}).subscribe(t=>{200==t.status?this._appointmentsService.bulkUploadAppointments(t.body).subscribe(()=>{this._notificationsService.success("Appointments","Appointments uploaded successfully!"),this._router.navigate(["appointments"],{queryParams:{tab:"upcoming"}})}):this._notificationsService.error("Bulk Upload","Something went wrong, please try again!")})},t=>{var e;this.loading=!1,(null===(e=null==t?void 0:t.error)||void 0===e?void 0:e.message)&&this._notificationsService.error("Validation Bulk Upload","Error in validating document!")})}}return t.\u0275fac=function(e){return new(e||t)(y.Rb(c.g),y.Rb(bn.c),y.Rb(g.a),y.Rb(N.b),y.Rb(mn.a),y.Rb(gn),y.Rb(a.e))},t.\u0275cmp=y.Lb({type:t,selectors:[["app-bulk-upload"]],features:[y.Cb([gn,mn.a]),y.Ab],decls:14,vars:10,consts:[[1,"container"],["nzType","drag","nzAccept",".xlsx",3,"nzCustomRequest","nzShowButton","nzShowUploadList","nzDisabled"],[4,"ngIf"],["nz-button","","nzType","primary","nzSize","large",3,"disabled"],["style","margin-top:10px",4,"ngIf"],["errorTitle",""],[2,"color","#8BC34A"],["nz-icon","","nzType","paper-clip","nzTheme","outline"],[2,"color","#FF0000","cursor","pointer",3,"click"],["nz-icon","","nzType","delete","nzTheme","outline"],[2,"margin-top","10px"],[3,"nzTitle"],[4,"ngFor","ngForOf"],["nzType","inner",2,"margin-top","16px",3,"nzTitle","nzExtra"],["nz-typography","","nzType","danger"]],template:function(t,e){1&t&&(y.Xb(0,"div",0),y.Xb(1,"nz-card"),y.Xb(2,"nz-upload",1),y.Vc(3,Sn,8,1,"h5",2),y.Xb(4,"button",3),y.Xc(5," BROWSE / DRAG "),y.Wb(),y.Xb(6,"p"),y.Sb(7,"br"),y.Xc(8),y.jc(9,"translate"),y.Wb(),y.Wb(),y.Sb(10,"br"),y.Wb(),y.Vc(11,vn,4,4,"div",4),y.Vc(12,Tn,3,0,"ng-template",null,5,y.Wc),y.Wb()),2&t&&(y.Db(2),y.rc("nzCustomRequest",e.handleUpload)("nzShowButton",!0)("nzShowUploadList",!1)("nzDisabled",e.uploadedFileName),y.Db(1),y.rc("ngIf",e.uploadedFileName),y.Db(1),y.rc("disabled",e.uploadedFileName),y.Db(4),y.Zc(" ",y.kc(9,8,"COMMON.DRAG_AND_UPLOAD")," "),y.Db(3),y.rc("ngIf",e.errors))},directives:[M.a,fn.a,a.q,j.a,H.a,B.a,$.a,a.p,L.a],pipes:[q.a,a.j],styles:[""]}),t})();var Dn=n("Kj3r"),Cn=n("eIep"),En=n("XNiG"),Xn=n("LRne"),On=n("ZyQt"),Pn=n("ZO2R"),yn=n("UpsY");function Nn(t,e){if(1&t&&(y.Vb(0),y.Xb(1,"span",17),y.Xb(2,"span",18),y.Xc(3),y.jc(4,"tenantName"),y.Wb(),y.Wb(),y.Ub()),2&t){const t=y.ic().$implicit;y.Db(3),y.Yc(y.kc(4,1,null==t?null:t.tenantId))}}function Mn(t,e){if(1&t&&(y.Vb(0),y.Xb(1,"nz-option",13),y.jc(2,"userLocation"),y.Xb(3,"span",14),y.Xb(4,"span",15),y.Xc(5),y.Wb(),y.Vc(6,Nn,5,3,"ng-container",16),y.Wb(),y.Wb(),y.Ub()),2&t){const t=e.$implicit;y.Db(1),y.rc("nzLabel",y.kc(2,3,null==t?null:t.id))("nzValue",null==t?null:t.id),y.Db(4),y.Zc(" ",null==t?null:t.name," ")}}function Ln(t,e){if(1&t&&(y.Vb(0),y.Vc(1,Mn,7,5,"ng-container",12),y.Ub()),2&t){const t=y.ic();y.Db(1),y.rc("ngForOf",t.siteList)}}function _n(t,e){1&t&&(y.Xb(0,"div",19),y.Xb(1,"span"),y.Xc(2,"Select Staff : "),y.Wb(),y.Wb())}function Wn(t,e){if(1&t&&y.Sb(0,"nz-option",22),2&t){const t=e.$implicit;y.rc("nzValue",null==t?null:t.id)("nzLabel",null==t?null:t.fullName)}}function Rn(t,e){if(1&t&&(y.Vb(0),y.Vc(1,Wn,1,2,"nz-option",21),y.Ub()),2&t){const t=y.ic(2);y.Db(1),y.rc("ngForOf",t.staffList)}}function kn(t,e){if(1&t){const t=y.Yb();y.Xb(0,"div",4),y.Xb(1,"nz-select",20),y.ec("ngModelChange",function(e){return y.Lc(t),y.ic().selectedStaff=e})("ngModelChange",function(){return y.Lc(t),y.ic().staffChanged()}),y.Vc(2,Rn,2,1,"ng-container",6),y.Wb(),y.Wb()}if(2&t){const t=y.ic(),e=y.Ic(27);y.Db(1),y.rc("ngModel",t.selectedStaff),y.Db(1),y.rc("ngIf",null==t.staffList?null:t.staffList.length)("ngIfElse",e)}}function wn(t,e){1&t&&(y.Xb(0,"div",19),y.Xb(1,"span"),y.Xc(2,"Select Date : "),y.Wb(),y.Wb())}function Vn(t,e){if(1&t){const t=y.Yb();y.Xb(0,"div",4),y.Xb(1,"nz-date-picker",23),y.ec("ngModelChange",function(e){return y.Lc(t),y.ic().date=e})("ngModelChange",function(){return y.Lc(t),y.ic().getUpcomingAppointments()}),y.Wb(),y.Wb()}if(2&t){const t=y.ic();y.Db(1),y.rc("ngModel",t.date)}}function Fn(t,e){if(1&t){const t=y.Yb();y.Vb(0),y.Xb(1,"app-audio-call-widget",37),y.ec("click",function(){y.Lc(t);const e=y.ic().$implicit;return y.ic(2).logAction("audio_call",null==e?null:e.attendeeId)}),y.Wb(),y.Ub()}if(2&t){const t=y.ic().$implicit;y.Db(1),y.rc("userId",null==t?null:t.attendeeId)("phoneNumbers",null==t?null:t.phoneNumbers)("disabled",!1)("renderVital",!1)("appointmentId",null==t?null:t.id)}}function xn(t,e){if(1&t){const t=y.Yb();y.Xb(0,"tr"),y.Xb(1,"td",31),y.ec("nzCheckedChange",function(n){y.Lc(t);const i=e.$implicit;return y.ic(2).onItemChecked(i.id,n)}),y.Wb(),y.Xb(2,"td"),y.Xc(3),y.Wb(),y.Xb(4,"td",32),y.Xb(5,"span",33),y.Xc(6),y.Wb(),y.Wb(),y.Xb(7,"td"),y.Sb(8,"app-patient-status-tag",34),y.Wb(),y.Xb(9,"td"),y.Vc(10,Fn,2,5,"ng-container",10),y.Xb(11,"app-icons",35),y.ec("click",function(){y.Lc(t);const n=e.$implicit;return y.ic(2).sendSMS(null==n?null:n.attendeeId,null==n?null:n.attenderName,null==n||null==n.schedule?null:n.schedule.startDate,null==n?null:n.type,null==n?null:n.id)}),y.Wb(),y.Wb(),y.Xb(12,"td",36),y.Xb(13,"span",33),y.Xc(14),y.Wb(),y.Wb(),y.Xb(15,"td"),y.Xc(16),y.jc(17,"date"),y.Wb(),y.Xb(18,"td"),y.Xb(19,"span",33),y.jc(20,"purposeLabel"),y.Xc(21),y.jc(22,"purposeLabel"),y.Wb(),y.Wb(),y.Xb(23,"td"),y.Xc(24),y.Wb(),y.Wb()}if(2&t){const t=e.$implicit,n=y.ic(2);y.Db(1),y.rc("nzChecked",n.setOfCheckedId.has(t.id)),y.Db(2),y.Yc((null==t?null:t.episodeType)||"N/A"),y.Db(1),y.tc("routerLink","/patient/view/",null==t?null:t.attendeeId,""),y.Db(1),y.sc("nzTooltipTitle",(null==t?null:t.attendeeName)||"N/A"),y.Db(1),y.Zc(" ",(null==t?null:t.attendeeName)||"N/A"," "),y.Db(2),y.rc("patientStatus",null==t?null:t.patientStatus),y.Db(2),y.rc("ngIf","AUDIO_CALL"===(null==t?null:t.type)&&n.isCallButtonEnabled),y.Db(3),y.sc("nzTooltipTitle",(null==t?null:t.attenderName)||"N/A"),y.Db(1),y.Zc(" ",(null==t?null:t.attenderName)||"N/A"," "),y.Db(2),y.Yc(y.lc(17,13,null==t||null==t.schedule?null:t.schedule.startDate,"MMM dd, hh:mm a")),y.Db(3),y.sc("nzTooltipTitle",y.kc(20,16,null==t?null:t.appointmentPurpose)),y.Db(2),y.Zc(" ",y.kc(22,18,null==t?null:t.appointmentPurpose)," "),y.Db(3),y.Yc(null==t?null:t.attemptCount)}}function Un(t,e){1&t&&(y.Xb(0,"nz-tag",41),y.Sb(1,"i",42),y.Xb(2,"span"),y.Xc(3,"Please select a staff to continue"),y.Wb(),y.Wb())}function jn(t,e){if(1&t&&(y.Xb(0,"span"),y.Xc(1),y.jc(2,"translate"),y.Wb(),y.Xb(3,"p"),y.Xb(4,"span"),y.Vc(5,Un,4,0,"nz-tag",40),y.Wb(),y.Wb()),2&t){const t=y.ic(3);y.Db(1),y.Zc(" ",y.kc(2,2,"COMMON.NODATA")," "),y.Db(4),y.rc("ngIf",!t.selectedStaff)}}function Hn(t,e){if(1&t&&(y.Xb(0,"nz-empty",38),y.Vc(1,jn,6,4,"ng-template",null,39,y.Wc),y.Wb()),2&t){const t=y.Ic(2);y.rc("nzNotFoundImage","https://gw.alipayobjects.com/mdn/miniapp_social/afts/img/A*pevERLJC9v0AAAAAAAAAAABjAQAAAQ/original")("nzNotFoundContent",t)}}const Bn=function(){return[10,50,100,150,200]},Yn=function(){return["ascend","descend"]};function $n(t,e){if(1&t){const t=y.Yb();y.Xb(0,"nz-table",24,25),y.ec("nzQueryParams",function(e){return y.Lc(t),y.ic().onQueryParamsChange(e)}),y.Xb(2,"thead"),y.Xb(3,"tr"),y.Xb(4,"th",26),y.ec("nzCheckedChange",function(e){return y.Lc(t),y.ic().checked=e})("nzCheckedChange",function(e){return y.Lc(t),y.ic().onAllChecked(e)}),y.Wb(),y.Xb(5,"th"),y.Xc(6,"Episode"),y.Wb(),y.Xb(7,"th"),y.Xc(8),y.jc(9,"translate"),y.Wb(),y.Sb(10,"th"),y.Sb(11,"th"),y.Xb(12,"th"),y.Xc(13),y.jc(14,"translate"),y.Wb(),y.Xb(15,"th",27),y.Xc(16),y.jc(17,"translate"),y.Wb(),y.Xb(18,"th"),y.Xc(19,"Type"),y.Wb(),y.Xb(20,"th",28),y.Xc(21,"Attempt"),y.Wb(),y.Wb(),y.Wb(),y.Xb(22,"tbody"),y.Vc(23,xn,25,20,"ng-template",29),y.Wb(),y.Vc(24,Hn,3,2,"ng-template",null,30,y.Wc),y.Wb()}if(2&t){const t=y.Ic(1),e=y.Ic(25),n=y.ic();y.rc("nzData",n.upcomingAppointments.result)("nzFrontPagination",!1)("nzNoResult",e)("nzShowPagination",!0)("nzShowSizeChanger",!0)("nzPageSizeOptions",y.xc(28,Bn))("nzLoading",n.upcomingAppointmentsLoading)("nzTotal",n.upcomingAppointments.totalCount)("nzPageIndex",n.pageIndex)("nzPageSize",n.pageSize),y.Db(4),y.rc("nzSelections",n.listOfSelection)("nzChecked",n.checked)("nzIndeterminate",n.indeterminate),y.Db(4),y.Yc(y.kc(9,22,"HEADER.PATIENTS")),y.Db(5),y.Yc(y.kc(14,24,"TABLEHEADER.ASSIGNEDTO")),y.Db(2),y.rc("nzSortFn",!0)("nzSortDirections",y.xc(29,Yn))("nzSortOrder","ascend"),y.Db(1),y.Zc(" ",y.kc(17,26,"COMMON.DATE_TIME"),""),y.Db(4),y.rc("nzFilters",n.filterAttempt)("nzFilterFn",!0),y.Db(3),y.rc("ngForOf",t.data)}}function qn(t,e){if(1&t){const t=y.Yb();y.Vb(0),y.Xb(1,"selected-patient-action",43),y.ec("onPrimaryActionButtonClicked",function(){return y.Lc(t),y.ic().primaryButtonClick()})("onSecondaryActionButtonClicked",function(){return y.Lc(t),y.ic().reset()}),y.Wb(),y.Ub()}if(2&t){const t=y.ic();y.Db(1),y.rc("primaryActionText",t.primaryActionText)("primaryButtonLoading",t.primaryButttonloading)("secondaryActionText",t.secondaryActionText)("totalPatientsSelected",t.setOfCheckedId.size)("totalCount",t.upcomingAppointments.totalCount)}}function Qn(t,e){1&t&&(y.Xb(0,"nz-option",44),y.Sb(1,"span",45),y.Xc(2," Loading Data... "),y.Wb())}const Zn=[{path:"",component:pn,pathMatch:"full",data:un.a.Listing,canActivate:[p.a,dn.a]},{path:"details/:id",component:At.a,data:un.a.Detail,canActivate:[p.a,dn.a]},{path:"create",component:zt,data:un.a.Form,canActivate:[p.a,dn.a]},{path:"create/:id",component:zt,data:un.a.Form,canActivate:[p.a,dn.a]},{path:"bulk-upload",component:In,data:un.a.BulkUpload,canActivate:[p.a,dn.a]},{path:"bulk-reassign",component:(()=>{class t extends u.a{constructor(t,e,n,i,a){super(),this._appointmentsService=t,this._staffService=e,this._episodeService=n,this._dataSharingService=i,this._appointmentModalService=a,this.dateRange=[],this.upcomingAppointments=new Vt.a,this.upcomingAppointmentsLoading=!1,this.pageSize=10,this.pageIndex=1,this.showTable=!1,this.checked=!1,this.indeterminate=!1,this.setOfCheckedId=new Set,this.primaryActionText="Reassign",this.secondaryActionText="Cancel",this.primaryButttonloading=!1,this.ignoreTableQueryChange=!1,this.fetchAppointments$=new En.a,this.upcomingAppointments.result=[]}ngOnInit(){this.initializeFetchAppointment(),this.getSite(),this._dataSharingService.onSubTenantChange().pipe(Object(d.a)(this.unsubscribed)).subscribe(t=>{this.initializeFetchAppointment(),this.getSite()})}ngAfterViewInit(){"CARE_TAKER"===localStorage.getItem("loggedInUserAccountType")&&(this.isCaretakerLogin=!0,this.selectedStaff=localStorage.getItem("loggedInUser"))}getSite(){this._staffService.fetchSitesForStaff().subscribe(t=>{this.siteList=t})}getStaff(){this.date=null,this.selectedStaff=null,this.showTable=!1,this.ignoreTableQueryChange=!0,this.selectedSite?this._staffService.fetchStaffList(Qt.a.MONITORING_STAFF,null,null,this.selectedSite).subscribe(t=>{this.staffList=t||[]}):this.staffList=[]}initializeFetchAppointment(){this.fetchAppointments$.pipe(Object(Dn.a)(500)).pipe(Object(Cn.a)(()=>this.getUpcomingAppointmentsObservable())).pipe(Object(d.a)(this.unsubscribed)).subscribe(t=>{this.upcomingAppointments=t,this.updateEpisodeType(this.upcomingAppointments,()=>{this.upcomingAppointmentsLoading=!1})})}staffChanged(){this.date&&this.getUpcomingAppointments()}getUpcomingAppointments(){this.fetchAppointments$.next()}getUpcomingAppointmentsObservable(){var t,e;if(this.showTable=!0,!this.selectedSite||!this.selectedStaff||!this.date)return Object(Xn.a)(new Vt.a);this.upcomingAppointmentsLoading=!0,this.upcomingAppointments=new Vt.a;const n=null===(t=Object(Tt.a)(this.date))||void 0===t?void 0:t.getTime(),i=null===(e=Object(It.a)(this.date))||void 0===e?void 0:e.getTime();return this._appointmentsService.fetchUpcomingAppointments(this.getOffset(this.pageIndex),n,i,null,this.selectedStaff,null,null,this.pageSize,null,null,!0)}onQueryParamsChange(t){const{pageSize:e,pageIndex:n}=t;this.pageSize=e,this.pageIndex=n,this.ignoreTableQueryChange?this.ignoreTableQueryChange=!1:this.getUpcomingAppointments()}getOffset(t){return Math.max(0,(t-1)*this.pageSize)}updateEpisodeType(t,e){var n;const i=null===(n=t.result)||void 0===n?void 0:n.map(t=>t.episodeId).filter(t=>null!=t).filter((t,e,n)=>n.indexOf(t)==e);i&&0!=i.length?this._episodeService.getEpisodeByIds(i).subscribe(n=>{t.result.forEach(t=>t.episodeType=n[t.episodeId]),e()}):e()}updateCheckedSet(t,e){e?this.setOfCheckedId.add(t):this.setOfCheckedId.delete(t)}onItemChecked(t,e){this.updateCheckedSet(t,e),this.refreshCheckedStatus()}onAllChecked(t){var e;null===(e=this.upcomingAppointments)||void 0===e||e.result.forEach(e=>this.updateCheckedSet(e.id,t)),this.refreshCheckedStatus()}refreshCheckedStatus(){var t,e;this.checked=null===(t=this.upcomingAppointments)||void 0===t?void 0:t.result.every(t=>this.setOfCheckedId.has(t.id)),this.indeterminate=(null===(e=this.upcomingAppointments)||void 0===e?void 0:e.result.some(t=>this.setOfCheckedId.has(t.id)))&&!this.checked}primaryButtonClick(){const t=this.staffList.filter(t=>t.id!=this.selectedStaff);this._appointmentModalService.showReassignModal(Array.from(this.setOfCheckedId),t).afterClose.subscribe(()=>{this.reset(null),this.getUpcomingAppointments()})}reset(t){this.onAllChecked(!1)}}return t.\u0275fac=function(e){return new(e||t)(y.Rb(g.a),y.Rb(qt.a),y.Rb(vt.a),y.Rb(f.a),y.Rb(Zt.a))},t.\u0275cmp=y.Lb({type:t,selectors:[["app-appointment-bulk-reschedule"]],features:[y.Ab],decls:28,vars:9,consts:[[1,"container"],["nz-row","","nzGutter","16"],["nz-col",""],["nz-col","",1,"select-label"],["nz-col","","nzSpan","4"],["nzPlaceHolder","Select a site","nzAllowClear","","nzShowSearch","",3,"ngModel","ngModelChange"],[4,"ngIf","ngIfElse"],["nz-col","","class","select-label","nzOffset","1",4,"ngIf"],["nz-col","","nzSpan","4",4,"ngIf"],[3,"nzData","nzFrontPagination","nzNoResult","nzShowPagination","nzShowSizeChanger","nzPageSizeOptions","nzLoading","nzTotal","nzPageIndex","nzPageSize","nzQueryParams",4,"ngIf"],[4,"ngIf"],["staffLoading",""],[4,"ngFor","ngForOf"],["nzCustomContent","",3,"nzLabel","nzValue"],[2,"display","flex"],[2,"width","70%"],[4,"isAccessAcrossTenantEnabled"],[2,"width","30%"],["nz-typography","","nzType","secondary",2,"color","var(--primary-color)"],["nz-col","","nzOffset","1",1,"select-label"],["nzPlaceHolder","Select a staff","nzAllowClear","","nzShowSearch","",3,"ngModel","ngModelChange"],[3,"nzValue","nzLabel",4,"ngFor","ngForOf"],[3,"nzValue","nzLabel"],[3,"ngModel","ngModelChange"],[3,"nzData","nzFrontPagination","nzNoResult","nzShowPagination","nzShowSizeChanger","nzPageSizeOptions","nzLoading","nzTotal","nzPageIndex","nzPageSize","nzQueryParams"],["upcoming",""],[3,"nzSelections","nzChecked","nzIndeterminate","nzCheckedChange"],["nzColumnKey","date",3,"nzSortFn","nzSortDirections","nzSortOrder"],["nzColumnKey","attempt","nzWidth","100px",3,"nzFilters","nzFilterFn"],["ngFor","",3,"ngForOf"],["noData",""],[3,"nzChecked","nzCheckedChange"],["actionable","",3,"routerLink"],["nz-typography","","nzEllipsis","","nz-tooltip","",3,"nzTooltipTitle"],["isToolTipEnabled","true",3,"patientStatus"],["name","sms",3,"click"],[1,"char-bound-field"],[3,"userId","phoneNumbers","disabled","renderVital","appointmentId","click"],[2,"flex","1","overflow","auto",3,"nzNotFoundImage","nzNotFoundContent"],["contentTpl",""],["nzColor","processing",4,"ngIf"],["nzColor","processing"],["nz-icon","","nzType","exclamation-circle"],["userType","APPOINTMENT",3,"primaryActionText","primaryButtonLoading","secondaryActionText","totalPatientsSelected","totalCount","onPrimaryActionButtonClicked","onSecondaryActionButtonClicked"],["nzDisabled","","nzCustomContent",""],["nz-icon","","nzType","loading",1,"loading-icon"]],template:function(t,e){if(1&t&&(y.Xb(0,"div",0),y.Xb(1,"div",1),y.Xb(2,"div",2),y.Xb(3,"h3"),y.Xc(4,"Reassign Appointments Guide"),y.Wb(),y.Xb(5,"ul"),y.Xb(6,"li"),y.Xc(7,"Use these filters to re-assign one or multiple appointments any staff member has on a specific day. You can start by choosing a site, any staff member on that site, and a date."),y.Wb(),y.Xb(8,"li"),y.Xc(9,"Appointments can be re-assigned only to other staff members in the same site."),y.Wb(),y.Xb(10,"li"),y.Xc(11,"If all appointments aren't re-assigned at once, try re-assigning them individually. If there are no staff available, please try rescheduling the appointment."),y.Wb(),y.Wb(),y.Wb(),y.Wb(),y.Sb(12,"br"),y.Xb(13,"div",1),y.Xb(14,"div",3),y.Xb(15,"span"),y.Xc(16,"Select Site : "),y.Wb(),y.Wb(),y.Xb(17,"div",4),y.Xb(18,"nz-select",5),y.ec("ngModelChange",function(t){return e.selectedSite=t})("ngModelChange",function(){return e.getStaff()}),y.Vc(19,Ln,2,1,"ng-container",6),y.Wb(),y.Wb(),y.Vc(20,_n,3,0,"div",7),y.Vc(21,kn,3,3,"div",8),y.Vc(22,wn,3,0,"div",7),y.Vc(23,Vn,2,1,"div",8),y.Wb(),y.Vc(24,$n,26,30,"nz-table",9),y.Vc(25,qn,2,5,"ng-container",10),y.Wb(),y.Vc(26,Qn,3,0,"ng-template",null,11,y.Wc)),2&t){const t=y.Ic(27);y.Db(18),y.rc("ngModel",e.selectedSite),y.Db(1),y.rc("ngIf",null==e.siteList?null:e.siteList.length)("ngIfElse",t),y.Db(1),y.rc("ngIf",e.selectedSite),y.Db(1),y.rc("ngIf",e.selectedSite),y.Db(1),y.rc("ngIf",e.selectedSite&&e.selectedStaff),y.Db(1),y.rc("ngIf",e.selectedSite&&e.selectedStaff),y.Db(1),y.rc("ngIf",e.showTable),y.Db(1),y.rc("ngIf",e.setOfCheckedId.size>0)}},directives:[W.c,W.a,R.d,l.u,l.x,a.q,a.p,R.a,Y.a,L.a,ne.a,ie.f,ie.n,ie.o,ie.e,ie.l,ie.m,ie.k,ie.i,ie.j,oe.a,c.h,x.d,ce.a,F.a,le.a,re.b,On.a,B.a,$.a,Pn.a],pipes:[yn.a,Z.a,q.a,a.e,G.a],styles:["[_nghost-%COMP%]     .ant-checkbox-wrapper{padding-left:16px;padding-right:8px;border-spacing:0!important}[_nghost-%COMP%]     .ant-checkbox-inner:after{border-color:var(--primary-color)}[_nghost-%COMP%]     .ant-checkbox-disabled .ant-checkbox-inner{background:gray 0 0 no-repeat padding-box;opacity:.5}[_nghost-%COMP%]     .ant-checkbox-disabled .ant-checkbox-inner:after{border-color:var(--neutral-color)!important}[_nghost-%COMP%]     .ant-checkbox-indeterminate .ant-checkbox-inner:after{border-color:var(--primary-color);background-color:var(--primary-color)}.select-label[_ngcontent-%COMP%]{margin-top:6px}"]}),t})(),data:un.a.BulkReschedule,canActivate:[p.a,dn.a]}];let Kn=(()=>{class t{}return t.\u0275mod=y.Pb({type:t}),t.\u0275inj=y.Ob({factory:function(e){return new(e||t)},imports:[[c.k.forChild(Zn)],c.k]}),t})();var Gn=n("bKRa");let Jn=(()=>{class t{constructor(t){this.translationService=t,t.setLanguage()}}return t.\u0275mod=y.Pb({type:t}),t.\u0275inj=y.Ob({factory:function(e){return new(e||t)(y.bc(jt.a))},imports:[[Kn,o.a,a.c,r.a,c.k,l.o,i.a,s.a.forRoot(),Gn.a,w.b]]}),t})()}}]);